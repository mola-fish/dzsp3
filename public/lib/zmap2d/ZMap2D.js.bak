var globeMap={};var ZMap2D=ZMap2D||{};(function(){var c=ZMap2D.Map=function b(d,k,f){ol.DEFAULT_TILE_CACHE_HIGH_WATER_MARK=100;var h=null;var g;if(f&&f.extent){g=f.extent}else{if(k&&k.extent){g=k.extent}else{g=[-180,-90,180,90]}}if(k){h=new ol.tilegrid.TileZMap({minZoom:k.minZoom?k.minZoom:2,maxZoom:k.maxZoom?k.maxZoom:18,topGrid:k.topGrid?k.topGrid:[1,1],tileSize:k.tileSize?k.tileSize:256,extent:g?g:ol.proj.get("EPSG:4326").getExtent()})}else{h=new ol.tilegrid.TileZMap({minZoom:2,maxZoom:18,topGrid:[1,1],tileSize:256,extent:g?g:ol.proj.get("EPSG:4326").getExtent()})}var e=null;if(f){e=new ol.View({center:f.center?f.center:[113.23333,23.16667],zoom:f.zoom?f.zoom:4,minZoom:f.minZoom?f.minZoom:2,maxZoom:f.maxZoom?f.maxZoom:21,extent:g?g:[-180,-90,180,90],minZoom:f.minZoom?f.minZoom:2,maxZoom:f.maxZoom?f.maxZoom:21,projection:f.projection?f.projection:"EPSG:4326"})}else{e=new ol.View({center:[113.23333,23.16667],zoom:2,extent:g?g:[-180,-90,180,90],minZoom:2,maxZoom:21,projection:"EPSG:4326"})}var j=new ol.Map({logo:false,target:d,controls:ol.control.defaults({zoom:false,attributionOptions:({collapsible:false})}),view:e});this.olMap=j;this.olTileGrid=h;this.olDiv=d;this.rClickArray=[];this.zoomListenerArray=[];globeMap[d]=this};c.prototype.getScale=function(z){var d=parseInt(this.GetZoom()==null?15:this.GetZoom())-15;return Math.pow(z||1,d)};c.prototype.GetMap=function(){return this.olMap};c.prototype.GetView=function(){return this.olMap.getView()};c.prototype.GetProjectCode=function(){var d=this.olMap.getView().getProjection().getCode();return d};c.prototype.JW2MapCoord=function(d){if(d==undefined){return undefined}var e;var f=this.GetProjectCode();if(f=="EPSG:900913"){e=ZMap2D.Convert("EPSG:4326","EPSG:900913",d)}else{e=d}return e};c.prototype.MapCoord2JW=function(d){if(d==undefined){return undefined}var e;var f=this.GetProjectCode();if(f=="EPSG:900913"){e=ZMap2D.Convert("EPSG:900913","EPSG:4326",d)}else{e=d}return e};c.prototype.Mkt2MapCoord=function(d){if(d==undefined){return undefined}var e;var f=this.GetProjectCode();if(f=="EPSG:900913"){e=d}else{e=ZMap2D.Convert("EPSG:900913","EPSG:4326",d)}return e};c.prototype.MapCoord2Mkt=function(d){if(d==undefined){return undefined}var e;var f=this.GetProjectCode();if(f=="EPSG:900913"){e=d}else{e=ZMap2D.Convert("EPSG:4326","EPSG:900913",d)}return e};c.prototype.JW2MapExtent=function(h){var e=h;var g=this.GetProjectCode();if(g=="EPSG:900913"){var f=ZMap2D.Convert("EPSG:4326","EPSG:900913",[h[0],h[1]]);var d=ZMap2D.Convert("EPSG:4326","EPSG:900913",[h[2],h[3]]);e=[f[0],f[1],d[0],d[1]]}return e};c.prototype.CenterAndZoom=function(d,e){this.SetViewCenter(d[0],d[1]);this.SetZoom(e)};c.prototype.AddTileLayer=function(d){this.olMap.addLayer(d)};c.prototype.RemoveTileLayer=function(d){this.olMap.removeLayer(d)};c.prototype.AddLayer=function(d){this.olMap.addLayer(d)};c.prototype.AddOverlay=function(e){var d=e.get("name");this.olMap.addOverlay(e)};c.prototype.SetOverlayPostion=function(d,f){var e=[];if(this.GetProjectCode()=="EPSG:900913"){e=ZMap2D.Convert("EPSG:4326","EPSG:900913",f)}else{e=f}d.setPosition(e);return};c.prototype.RemoveOverlay=function(j){var g;if(typeof(j)=="string"){var f=this.olMap.getOverlays();for(var h=0;h<f.getLength();h++){var d=f.array_[h];var e=d.get("name");if(e==j){g=d;break}}}else{g=j}if(g!=undefined){this.olMap.removeOverlay(g);var k=document.getElementById(e);if(k!=undefined){k.parentNode.removeChild(k)}}return true};c.prototype.RemoveLayer=function(e){if(typeof e!="string"){this.olMap.removeLayer(e)}else{var f=this.GetUnkLayer(e);var d;if(f!=undefined){this.olMap.removeLayer(f)}}};c.prototype.RefreshLayer=function(g){var e,f;var j=this.olMap.getLayers();var h=typeof(g)=="string"?true:false;for(f=0;f<j.getLength();f++){var k=j.array_[f];if(h){var d=k.values_.name;if(d==g){e=k;break}}else{if(k==g){e=k;break}}}if(e){e.getSource().tileCache.clear();e.getSource().updateTimeMask();g.changed()}};c.prototype.InsertLayer=function(f,d){var e=this.olMap.getLayers();if(f<0&&f>d.getLength()){return -1}e.insertAt(f,d)};c.prototype.GetAtLayer=function(e){var d=this.olMap.getLayers();if(e<0&&e>layer.getLength()){return null}return d.item(e)};c.prototype.RemoveAtLayer=function(e){var d=this.olMap.getLayers();if(e<0&&e>layer.getLength()){return -1}d.removeAt(e)};c.prototype.RemoveAllLayer=function(){var e=this.olMap.getLayers();for(;e.array_.length>0;){var d=e.array_[0];this.olMap.removeLayer(d);e=this.olMap.getLayers()}};c.prototype.GetUnkLayer=function(e){var g;var h=this.olMap.getLayers();for(var f=0;f<h.getLength();f++){var j=h.array_[f];var d=j.values_.name;if(d==e){g=j;break}}return g};c.prototype.GetIndexLayer=function(d){var f;var g=this.olMap.getLayers();for(var e=0;e<g.getLength();e++){var h=g.array_[e];if(e==d){f=h;break}}return f};c.prototype.GetOutLayer=function(){var e=null;var f=this.olMap.getLayers();var d=f.getLength();if(d>0){e=f.array_[d-1]}return e};c.prototype.SetVisible=function(d,f){var e=this.GetUnkLayer(d);if(e==undefined){return}e.setVisible(f)};c.prototype.IsVisible=function(d){var e=this.GetUnkLayer(d);if(e==undefined){return}return e.getVisible()};c.prototype.AddTileMapLayer=function(g){if(g==undefined){return}var d=this.GetUnkLayer(g);if(d!=undefined){return}var e=this.olMap.getView().getProjection().getCode();var f=new ol.layer.Tile({name:g,source:new ol.source.TileZMap({projection:e,url:GetGISServerAddress()+"zs/catalogws/data"+g+"/tile/map",catalog:g,tileGrid:this.olTileGrid,attributions:[]})});f.set("name",g);f.setVisible(false);this.olMap.addLayer(f)};c.prototype.AddVecLayer=function(d){if(catalogName==undefined){return}var e=this.GetUnkLayer(d);if(e!=undefined){return}var f=this.olMap.getView().getProjection().getCode();var g=new ol.layer.Tile({name:d,source:new ol.source.TileZMap({projection:f,url:GetGISServerAddress()+"zs/catalogws/data"+d+"/tile/map",catalog:d,tileGrid:this.olTileGrid,topGrid:[8,4]})});g.set("name",d);g.setVisible(false);this.olMap.addLayer(g)};c.prototype.AddGeometrys=function(h,k,e,f,l){var j;var g=this.GetUnkLayer(h);if(g==undefined){j=new ol.source.Vector();g=new ol.layer.Image({name:h,source:new ol.source.ImageVector({source:j})});this.olMap.addLayer(g)}else{j=g.getSource().getSource()}if(f){j.clear()}var m=new ol.Feature({geometry:k,name:"default"});var d=e?e:ZMap2D.DefaultStyle;m.setStyle(d);j.addFeature(m);return h};c.prototype.RemoveGeometrys=function(d){var e=this.GetUnkLayer(d);if(e!=undefined){this.olMap.removeLayer(e)}};c.prototype.AddBatchTextLayer=function(t){function r(v,u){return new ol.style.Text({font:t.font?t.font:"normal 12px Arial",text:v.get("name"),fill:new ol.style.Fill({color:t.fillColor?t.fillColor:"#aa3300"}),stroke:new ol.style.Stroke({color:t.outlineColor?t.outlineColor:"#ffffff",width:t.outlineWidth?t.outlineWidth:3}),offsetX:t.offsetX?t.offsetX:0,offsetY:t.offsetY?t.offsetY:0,rotation:t.rotation?t.rotation:0})}function j(x,w){var v=null;if(t.showGeometry){var u=t.pointColor?t.pointColor:"rgba(255, 0, 0, 1)";if(t.icons.length>0){u=x.get("icon")}if(t.imageStyle){if(typeof t.imageStyle==="string"){v=new ol.style.Icon(({anchor:[0.5,0.5],scale:t.scale||globeMap[p].getScale(t.scaleBase)||1,anchorXUnits:"fraction",anchorYUnits:"fraction",src:t.imageStyle,imgSize:[t.width||x.get('size')[0]||30,t.height||x.get('size')[1]||30],rotation:Math.PI/180*(t.rotation||x.get("rotation")||0)}))}else{v=t.imageStyle}}else{if(t.iconpoints>2){v=new ol.style.RegularShape({points:t.iconpoints,radius1:t.radius1,radius2:t.radius2,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:u,width:1}),rotation:Math.PI/180*(t.rotation||x.get("rotation")||0)})}else{v=new ol.style.Circle({radius:t.radius?t.radius:10,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:u,width:1})})}}}else{v=new ol.style.Icon(({anchor:[0.5,0.5],scale:t.scale||globeMap[p].getScale(t.scaleBase)||1,anchorXUnits:"fraction",anchorYUnits:"fraction",src:x.get("icon"),imgSize:[t.width||x.get('size')[0]||30,t.height||x.get('size')[1]||30],rotation:Math.PI/180*(t.rotation||x.get("rotation")||0)}))}return new ol.style.Style({image:v,text:r(x,w)})}var m;var p=this.olDiv;var l=this.GetUnkLayer(t.name);if(l==undefined){m=new ol.source.Vector();l=new ol.layer.Image({name:t.name,source:new ol.source.ImageVector({source:m,style:j})});this.olMap.addLayer(l)}else{m=l.getSource().getSource()}if(t.bClear){m.clear()}var k=function(u){return Object.prototype.toString.call(u)==="[object Array]"};var d=[];var f=t.points||[];var e=t.texts||[];var q=t.icons||[];var o=t.attrs||[];var h=t.rotations||[];var ss=t.sizes||[];for(var g=0;g<f.length;g++){var n=new ZMap2D.Point(f[g]);var s=new ol.Feature({geometry:n,name:e[g],icon:q[g],attr:o[g],rotation:h[g],size:ss[g]});d.push(s)}m.addFeatures(d);return l};c.prototype.AddAnimatedclusterLayer=function(q){var e={};function m(s,r){var t=new ol.style.Style({image:new ol.style.Icon(({anchor:[0.5,0.5],src:q.url,imgSize:[q.width||30,q.height||30],rotation:Math.PI/180*(q.rotation||0)}))});return t}var f=new ol.source.Cluster({distance:40,source:new ol.source.Vector()});var k=new ol.layer.Vector({name:q.name,source:f,style:m});this.olMap.addLayer(k);var l=function(r){return Object.prototype.toString.call(r)==="[object Array]"};var d=[];var h=q.points;var g=q.texts;var o=q.attrs;for(var j=0;j<h.length;j++){var n=new ZMap2D.Point(h[j]);var p=new ol.Feature({geometry:n,name:g[j],attr:o[j]});d.push(p)}f.getSource().addFeatures(d)};c.prototype.AddTextLabel=function(e,d,k,h){var g=this.JW2MapCoord([d,k]);var j=document.getElementById(e);if(j==undefined){j=document.createElement("div")}if(j==undefined){return}j.className="zmap-tooltip zmap-text-static";j.innerHTML=h;var f=new ol.Overlay({element:j,offset:[0,0]});f.set("name",e);f.setPosition(g);this.olMap.addOverlay(f)};c.prototype.AddImageLabel=function(e,d,l,h,j){var g=this.JW2MapCoord([d,l]);var k=document.getElementById(e);if(k==undefined){k=document.createElement("div")}if(k==undefined){return}k.className="zmap-image-static";k.id=e;k.innerHTML=h;var f=new ol.Overlay({element:k,positioning:j?j:"bottom-center"});f.set("name",e);this.olMap.addOverlay(f);f.setPosition(g);return f};c.prototype.RemoveLabel=function(e){var g=null;if(typeof(e)=="object"){g=e}else{g=this.olMap.getOverlays();for(var h=0;h<g.getLength();h++){var d=g.array_[h];var f=d.get("name");if(f==e){g=d;break}}}var f=g.get("name");this.olMap.removeOverlay(g);var j=document.getElementById(f);if(j!=undefined){j.parentNode.removeChild(j)}};c.prototype.RemoveAllOverlay=function(){var d=this.olMap.getOverlays();for(var e=0;e<d.getLength();e++){var f=d.array_[e];this.olMap.removeControl(f)}};c.prototype.OpenInfoWindow=function(d){this.olMap.addOverlay(d)};c.prototype.UpdatePosition=function(e,d){if(e){e.setPosition(d)}};c.prototype.CloseInfoWindow=function(d){this.olMap.removeOverlay(d)};c.prototype.GetViewCenter=function(){var d=this.olMap.getView();if(d==undefined){return null}var e;if(this.GetProjectCode()=="EPSG:900913"){e=ZMap2D.Convert("EPSG:900913","EPSG:4326",d.getCenter())}else{e=d.getCenter()}return e};c.prototype.SetViewCenter=function(d,g){var f=this.JW2MapCoord([d,g]);var e=this.olMap.getView();if(e==undefined){return null}e.setCenter(f)};c.prototype.MapFitView=function(){var g=this.GetMap();if(g==undefined){return}var d=g.getView();if(d==undefined){return}var f=d.getProjection().getExtent();var e=g.getSize();d.fit(f,e)};c.prototype.GetViewRect=function(){var j=this.GetMap();if(j==undefined){return}var e=j.getView();if(e==undefined){return}var h=j.getSize();var g=e.calculateExtent(h);if(this.GetProjectCode()=="EPSG:900913"){var f=this.MapCoord2JW([g[0],g[1]]);var d=this.MapCoord2JW([g[2],g[3]]);g=f.concat(d)}return g};c.prototype.SetViewRect=function(k,h,f,d){var l=this.GetMap();if(l==undefined){return}var e=l.getView();if(e==undefined){return}var j=[k,h,f,d];var g=l.getSize();e.fit(j,g);return};c.prototype.GetPixelFromCoordinate=function(d,g){var f=this.GetMap();if(f==undefined){return}var e=this.JW2MapCoord([d,g]);return f.getPixelFromCoordinate(e)};c.prototype.GetMapSize=function(){var d=this.GetMap();if(d==undefined){return}return d.getSize()};c.prototype.SetZoom=function(e){var d=this.olMap.getView();if(d==undefined){return null}d.setZoom(e)};c.prototype.GetZoom=function(){var d=this.olMap.getView();if(d==undefined){return null}return d.getZoom()};c.prototype.GetResolution=function(){var d=this.olMap.getView();if(d==undefined){return null}var e=d.getResolution();return e};c.prototype.GetScaleText=function(){var g="1km";var o=this.olMap.getView();if(o==undefined){return null}var f=o.getProjection();if(f==undefined){return null}var m=this.GetResolution();var l=this.GetViewCen();var j=f.getPointResolution(m,l);cosLatitude=Math.cos(l[1]*Math.PI/180);j*=Math.PI*cosLatitude*ol.sphere.NORMAL.radius/180;var d=64;var q=d*j;var p="";if(q<1){p="mm";j*=1000}else{if(q<1000){p="m"}else{p="km";j/=1000}}var h=3*Math.floor(Math.log(d*j)/Math.log(10));var k,e;var n=[1,2,5];while(true){k=n[h%3]*Math.pow(10,Math.floor(h/3));e=Math.round(k/j);if(isNaN(e)){return g}else{if(e>=d){break}}++h}g=k+" "+p;return g};c.prototype.GetScale=function(){var f=1;var d=this.olMap.getView();if(d==undefined){return null}var g=d.getProjection();if(g==undefined){return null}var e=this.GetResolution();var h=this.GetResolution()*420263251.3;return h};c.prototype.AddControl=function(d){this.olMap.addControl(d)};c.prototype.RemoveControl=function(d){if(d){this.olMap.removeControl(d)}};c.prototype.RemoveAllControl=function(){var f=this.olMap.getControls();for(var e=0;e<f.getLength();e++){var d=f.array_[e];this.olMap.removeControl(d)}};c.prototype.AddCustomControl=function(d,p,q,o,m,r,k,e,n,l,f){var h=null;var j=document.getElementById(d);if(j==null){j=document.createElement("button")}j.id=d;j.innerHTML=l;j.title=p;j.addEventListener("click",f,false);j.addEventListener("touchstart",f,false);if(q){j.style.backgroundColor=q}j.style.width="calc(100% - 0.1em)";j.style.height="calc(100% - 0.1em)";var g=document.createElement("div");if(g){g.className="zmap-custom-control";if(o!=""){g.style.left=o+"px"}if(m!=""){g.style.top=m+"px"}if(r!=""){g.style.right=r+"px"}if(k!=""){g.style.bottom=k+"px"}g.style.width=e+"px";g.style.height=n+"px";g.appendChild(j);h=new ol.control.Control({element:g});h.set("name",d);this.olMap.addControl(h)}return h};c.prototype.AddCommonControl=function(d,j,o,l,p,k,e,n,m){var g=null;var h=j;var f=document.createElement("div");if(f){f.className="zmap-custom-control";if(o!=""){f.style.left=o+"px"}if(l!=""){f.style.top=l+"px"}if(p!=""){f.style.right=p+"px"}if(k!=""){f.style.bottom=k+"px"}f.style.width=e==undefined?"auto":(e+"px");f.style.height=n==undefined?"auto":(n+"px");f.style.zIndex=m;f.innerHTML=j;g=new ol.control.Control({element:f});g.set("name",d);this.olMap.addControl(g)}return g};c.prototype.RemoveCustomControl=function(e){var d=false;var j=this.olMap.getControls();for(var h=0;h<j.getLength();h++){var f=j.array_[h];var g=f.get("name");if(g==e){this.olMap.removeControl(f);d=true;break}}return d};c.prototype.AddEventListener=function(e,f){if(e=="rclick"){$(this.olMap.getViewport()).on("contextmenu",f);this.rClickArray.push(f)}else{if(e=="zoom"){this.zoomListenerArray.push(f);var g;function d(h){var k=this.olMap.getView().getZoom();if(k!=g){g=k;for(var j=0;j<this.zoomListenerArray.length;j++){this.zoomListenerArray[j]()}}}this.olMap.on("moveend",d,this)}else{this.olMap.on(e,f,this)}}};c.prototype.RemoveEventListener=function(d,e){if(d=="rclick"){for(var f=0;f<this.rClickArray.length;f++){if(e===this.rClickArray[f]){$(this.olMap.getViewport()).off("contextmenu",e);this.rClickArray.splice(f,1);break}}}else{if(d=="zoom"){var f=this.zoomListenerArray.indexOf(e);if(f>=0&&f<this.zoomListenerArray.length){this.zoomListenerArray.splice(f,1)}}else{this.olMap.un(d,e,this)}}};c.prototype.IsEnableDragging=function(){var g=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(g),"interactions should be defined");var f=g.getArray();for(var e=0;e<f.length;e++){var d=f[e].get("name");if(d=="InputDragStamp"){return false}}return true};c.prototype.EnableDragging=function(e){if(!e){function j(l){if(l.dragging){return false}return true}var g=new ol.interaction.Interaction({handleEvent:j});g.set("name","InputDragStamp");this.olMap.addInteraction(g)}else{var k=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(k),"interactions should be defined");var h=k.getArray();for(var f=0;f<h.length;f++){var d=h[f].get("name");if(d=="InputDragStamp"){this.olMap.removeInteraction(h[f]);break}}}};c.prototype.IsEnableWheel=function(){var g=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(g),"interactions should be defined");var f=g.getArray();for(var e=0;e<f.length;e++){var d=f[e].get("name");if(d=="InputWheelStamp"){return false}}return true};c.prototype.EnableWheel=function(e){if(!e){function j(l){if(l.browserEvent.type!="mousewheel"){return true}return false}var g=new ol.interaction.Interaction({handleEvent:j});g.set("name","InputWheelStamp");this.olMap.addInteraction(g)}else{var k=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(k),"interactions should be defined");var h=k.getArray();for(var f=0;f<h.length;f++){var d=h[f].get("name");if(d=="InputWheelStamp"){this.olMap.removeInteraction(h[f]);break}}}};c.prototype.IsEnableInput=function(){var g=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(g),"interactions should be defined");var f=g.getArray();for(var e=0;e<f.length;e++){var d=f[e].get("name");if(d=="InputStamp"){return false}}return true};c.prototype.EnableInput=function(e){if(!e){function j(l){return false}var g=new ol.interaction.Interaction({handleEvent:j});g.set("name","InputStamp");this.olMap.addInteraction(g)}else{var k=this.olMap.getInteractions();goog.asserts.assert(goog.isDef(k),"interactions should be defined");var h=k.getArray();for(var f=0;f<h.length;f++){var d=h[f].get("name");if(d=="InputStamp"){this.olMap.removeInteraction(h[f]);break}}}};ZMap2D.LayerDefaultParam=function(){var d={minZoom:2,maxZoom:18,texWidth:256,texHeight:256,maxResolution:360/(256*Math.pow(2,0)),minResolution:360/(256*Math.pow(2,18))};return d}();ZMap2D.CalcResolution=function(e,d){return e/(256*Math.pow(2,d))};c.prototype.Convert2Map=function(g,e){var d=this.olMap.getView().getProjection();var f=ol.proj.transform(g,e,d);return f};c.prototype.Convert=function(e,d,g){var f=ol.proj.transform(g,e,desProj);return f};c.prototype.Screen2MapCoord=function(d){var e=this.olMap.getCoordinateFromPixel(d);if(this.GetProjectCode()=="EPSG:900913"){e=ol.proj.transform(e,"EPSG:900913","EPSG:4326")}else{e=e}return e};c.prototype.MapCoord2Screen=function(d){return this.olMap.getPixelFromCoordinate(this.JW2MapCoord(d))};c.prototype.SetCursorStyle=function(d){$("#zmap").css("cursor",d)};ZMap2D.TileLayer=function(d){var g=new ol.layer.Tile({name:d.name,source:new ol.source.TileZMap({projection:d.projection?d.projection:"EPSG:4326",url:d.url,catalog:d.name,topGrid:d.topGrid?d.topGrid:[8,4],extent:d.extent?d.extent:[-180,-90,180,90],attributions:[]})});try{GetServerInfo(d.url)}catch(f){}g.set("name",d.name);g.SetVisible=function(e){this.setVisible(e)};g.IsVisible=function(){return this.getVisible()};return g};ZMap2D.CustomLayer=function(f){if(f==undefined){return}var d=new ol.layer.Image({extent:f.extent,source:new ol.source.ImageWMSZMap({url:f.url,callback:f.callback,params:f.params,serverType:"ZMapServer"})});d.set("name",f.name);try{GetServerInfo(f.url)}catch(g){}return d};ZMap2D.Image=function(e){var d=new ol.layer.Image(e);d.set("name",e.name);return d};ZMap2D.SingleImageLayer=function(d){var e=new ol.layer.Image({source:new ol.source.ImageStatic({url:d.url,projection:d.projection?d.projection:ol.proj.get("EPSG:4326"),imageExtent:d.extent?d.extent:[-180,-90,180,90]}),opacity:d.opacity?d.opacity:1});e.set("name",d.name);e.SetVisible=function(f){this.setVisible(f)};e.IsVisible=function(){return this.getVisible()};return e};ZMap2D.HeatMapLayer=function(e){var d=new ol.layer.Heatmap({source:e.source,blur:parseInt(e.blur,10),radius:parseInt(e.radius,10)});return d};ZMap2D.ClusterLayer=function(f){console.log(parseFloat(f.distance,1));var d=new ol.source.Cluster({distance:parseFloat(f.distance,1),source:f.source});var g={};var e=new ol.layer.Vector({source:d,style:function(j){var h=j.get("features").length;var k=g[h];if(!k){k=new ol.style.Style({image:new ol.style.Circle({radius:parseFloat(f.radius,10),stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({text:h.toString(),fill:new ol.style.Fill({color:"#fff"})})});g[h]=k}return k}});return e};ZMap2D.WMSLayer=function(f){if(f==undefined){return}var d=new ol.layer.Tile({extent:f.extent,source:new ol.source.TileWMS({url:f.url,params:f.params,serverType:"ZMapServer"})});try{GetServerInfo(f.url)}catch(g){}d.set("name",f.name);d.SetVisible=function(e){this.setVisible(e)};d.IsVisible=function(){return this.getVisible()};return d};ZMap2D.WMTSLayer=function(r){if(r==undefined){return}var k=r.projection;var p=k.getExtent();var m=r.topGrid;var f=m?m[0]:1;if(!f){f=1}var q=ol.extent.getWidth(p)/f/256;var g=r.minZoom?r.minZoom:0;var n=r.maxZoom?r.maxZoom:18;var h=new Array(n);var j=new Array(n);for(var o=g;o<n;++o){h[o]=q/Math.pow(2,o);j[o]=o}var d=new ol.layer.Tile({opacity:1,source:new ol.source.WMTS({url:r.url,layer:"0",matrixSet:"default028mm",format:"image/png",projection:k,center:[0,0],tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(p),extent:r.extent,resolutions:h,matrixIds:j,size:[256,256]}),style:"default",wrapX:true})});try{GetServerInfo(r.url)}catch(l){}d.set("name",r.name);d.SetVisible=function(e){this.setVisible(e)};d.IsVisible=function(){return this.getVisible()};return d};ZMap2D.WFSLayer=function(e){var f=new ol.source.Vector({loader:function(j,h,g){$.ajax({url:e.url,dataType:"jsonp",jsonp:false})},strategy:ol.loadingstrategy.tile(ol.tilegrid.createXYZ({minZoom:e.minZoom,maxZoom:e.maxZoom}))});var d=new ol.layer.Vector({source:f,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0, 0, 255, 1.0)",width:2})})});d.set("name",e.name);return d};ZMap2D.DefaultStyle=function(){var d="rgba(255, 255, 128, 0.25)";var g="rgba(0, 255, 0, 0.75)";var e=1;var f=new ol.style.Style({fill:new ol.style.Fill({color:d}),stroke:new ol.style.Stroke({color:g,width:e,lineDash:[0]}),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:d}),stroke:new ol.style.Stroke({color:g,width:e})}),text:new ol.style.Text({font:"12px Calibri,sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})});return f}();ZMap2D.Style=function(e){var d=new ol.style.Style({fill:new ol.style.Fill({color:e&&e.fill?e.fill:ZMap2D.DefaultStyle.fill_.color_}),stroke:new ol.style.Stroke({color:e&&e.stroke?e.stroke:ZMap2D.DefaultStyle.stroke_.color_,width:e&&e.width?e.width:ZMap2D.DefaultStyle.stroke_.width_,lineDash:e&&e.lineDash?e.lineDash:ZMap2D.DefaultStyle.stroke_.lineDash}),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:e&&e.fill?e.fill:ZMap2D.DefaultStyle.fill_.color_}),stroke:new ol.style.Stroke({color:e&&e.stroke?e.stroke:ZMap2D.DefaultStyle.stroke_.color_,width:ZMap2D.DefaultStyle.stroke_.width_})}),text:new ol.style.Text({font:"12px Calibri, sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})});return d};ZMap2D.IconStyle=function(e){var d=new ol.style.Style({image:e.image?e.image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:e&&e.fill?e.fill:ZMap2D.DefaultStyle.fill_.color_}),stroke:new ol.style.Stroke({color:e&&e.stroke?e.stroke:ZMap2D.DefaultStyle.stroke_.color_,width:ZMap2D.DefaultStyle.stroke_.width_})})});return d};ZMap2D.GeomStyle=function(e){var d=new ol.style.Style({fill:new ol.style.Fill({color:e.color?e.color:ZMap2D.DefaultStyle.fill_.color_}),stroke:new ol.style.Stroke({color:e.bordercolor?e.bordercolor:ZMap2D.DefaultStyle.stroke_.color_,width:e.width?e.width:ZMap2D.DefaultStyle.stroke_.width_}),image:new ol.style.Circle({radius:e.radius?e.radius:5,fill:new ol.style.Fill({color:e.color?e.color:ZMap2D.DefaultStyle.fill_.color_}),stroke:new ol.style.Stroke({color:e.bordercolor?e.bordercolor:ZMap2D.DefaultStyle.stroke_.color_,width:e.width?e.width:ZMap2D.DefaultStyle.stroke_.width_})})});return d};ZMap2D.TextStyle=function(e){var d=new ol.style.Style({text:new ol.style.Text({font:"12px Calibri, sans-serif",fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#fff",width:3})})});return d};ZMap2D.Icon=function(d){return new ol.style.Icon(d)};function a(){var e=null;for(var d in globeMap){e=globeMap[d];break}return e}ZMap2D.Point=function(d,g){var e;var f=a();if(f){if(d instanceof Array){e=f.JW2MapCoord(d)}else{e=f.JW2MapCoord([d,g])}}else{if(d instanceof Array){e=d}else{e=[d,g]}}return new ol.geom.Point(e,"XY")};ZMap2D.MultiPoint=function(f){var e;var g=a();if(g){e=[];for(var d=0;d<f.length;d++){e.push(g.JW2MapCoord(f[d]))}}else{e=f}return new ol.geom.MultiPoint(e,"XY")};ZMap2D.Line=function(e){var f;var g=a();if(g){f=[];for(var d=0;d<e.length;d++){f.push(g.JW2MapCoord(e[d]))}}else{f=e}return new ol.geom.LineString(f,"XY")};ZMap2D.MultiLine=function(h){var d;var k=a();if(k){d=[];for(var g=0;g<h.length;g++){var e=[];for(var f=0;f<h[g].length;f++){e.push(k.JW2MapCoord(h[g][f]))}d.push(e)}}else{d=h}return new ol.geom.MultiLineString(d,"XY")};ZMap2D.Polygon=function(h){var d;var k=a();if(k){d=[];for(var g=0;g<h.length;g++){var f=[];for(var e=0;e<h[g].length;e++){f.push(k.JW2MapCoord(h[g][e]))}d.push(f)}}else{d=h}return new ol.geom.Polygon(d,"XY")};ZMap2D.MultiPolygon=function(d){var l;var n=a();if(n){l=[];for(var h=0;h<d.length;h++){var m=[];for(var g=0;g<d[h].length;g++){var f=[];for(var e=0;e<d[h][g].length;e++){f.push(n.JW2MapCoord(d[h][g][e]))}m.push(f)}l.push(m)}}else{l=d}return new ol.geom.MultiPolygon(l,"XY")};ZMap2D.Circle=function(e,d){var f,h;var g=a();if(g){f=g.JW2MapCoord(e);R=d}else{f=e;R=d}return new ol.geom.Circle(f,R,"XY");return new ol.geom.Circle(f,d,"XY")};ZMap2D.Feature=function(d){return new ol.Feature({name:d.name,geometry:d.geometry,population:d.population,rainfall:d.rainfall,weight:d.weight})};ZMap2D.SourceVector=function(d){return new ol.source.Vector(d)};ZMap2D.SourceImageVector=function(d){return new ol.source.ImageVector(d)};ZMap2D.SourceTile=function(d){return new ol.source.TileZMap(d)};ZMap2D.Overlay=function(h){var e=h.name;var j=document.createElement("div");if(j==undefined){return}var f;var g=a();if(g){f=g.JW2MapCoord(h.position)}else{f=h.position}j.className="zmap-overlay";j.id=h.name;if(typeof(h.divContent)=="string"){j.innerHTML=h?h.divContent:""}else{j.addElement(h.divElement)}var d=new ol.Overlay({element:j,positioning:h.positioning?h.positioning:"bottom-center"});d.set("name",e);d.setPosition(f);return d};ZMap2D.InfoWindow=function(k,e){var f;var g=a();if(g){f=g.JW2MapCoord(k)}else{f=k}ZMap2D.CloseCallBack=function(l){$(l).parent().css("display","none")};var j=document.createElement("div");j.className="zmap-infowindow";var h='<a href="#" class="zmap-infowindow-closer" onclick="ZMap2D.CloseCallBack(this)" ></a>';if(typeof(e)=="string"){j.innerHTML=h+e}else{$(j).append(h);$(j).append(j)}var d=new ol.Overlay({element:j,offset:[0,-10],positioning:"bottom-center"});d.setPosition(f);return d};ZMap2D.Convert=function(e,d,g){var f=ol.proj.transform(g,e,d);return f};ZMap2D.NavigationControl=function(){return null};ZMap2D.RuleControl=function(d){return this.RuleControl?this.RuleControl:new ol.control.ScaleLineCtl(d)};ZMap2D.ZoomControl=function(d){return this.ZoomControl?this.ZoomControl:new ol.control.ZoomCtl(d)};ZMap2D.ZoomSliderControl=function(d){return this.ZoomSliderControl?this.ZoomSliderControl:new ol.control.ZoomSliderCtl(d)};ZMap2D.MousePositionControl=function(d){return this.MousePositionControl?this.MousePositionControl:new ol.control.MousePositionCtl(d)};ZMap2D.OverviewMapControl=function(e){var f=e.map;var d=new ol.View({extent:[-180,-90,180,90],projection:"EPSG:4326"});return this.OverviewMapControl?this.OverviewMapControl:new ol.control.OverviewMapCtl({collapsed:e.collapsed,view:d})};ZMap2D.ZoomToExtent=function(d,e){return this.ZoomToExtent?this.ZoomToExtent:new ol.control.ZoomToExtentCtl({label:"R",handleClick:function(f){f.preventDefault();var g=this.getMap();g.getView().setCenter(d?d:[113.23333,23.16667]);g.getView().setZoom(e?e:4)}})};ZMap2D.Map=c})();function GetServerInfo(a){var b=a.substring(0,a.indexOf("zs/data"));if(b[b.length-1]!="/"){b=window.location.protocol+"//"+window.location.host;b+="/"}var c=randomString(32);var d=CodeString(c);updateMsg(b,c,d)}function updateMsg(a,b,c){$.ajax({url:a+"zs/cms/lic/check",type:"GET",data:{param:c,version:1},async:true,success:function(e){var d=e.sign;if(b==d){if(e.lic.status=="OK"){hideLogo()}else{showLogo(a)}}else{showLogo(a)}},error:function(d){showLogo(a)}})}function randomString(b){b=b||32;var c="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";var a=c.length;var d="";for(i=0;i<b;i++){d+=c.charAt(Math.floor(Math.random()*a))}return d}var desTable="WlNs4mMr7cPEh3FnGi0C5OAgId8JL6KkDuSaUb9Ty1Hfz2BjVoqXtZvYpwQxRe";function CodeString(j){var c="";var g=j.split("");var b=desTable.split("");var k=new Array(g.length);for(var d=0;d<g.length;d++){var a=g[d];var m=/^[a-z]+$/;var f=/^[A-Z]+$/;var e=/^[0-9]+$/;var l=j.charCodeAt(d);var h;if(m.test(a)){h=parseInt(l)-97+26}else{if(f.test(a)){h=parseInt(l)-65}else{if(e.test(a)){h=parseInt(a)+52}}}a=desTable[h];k[d]=a}c=k.join().replace(/,/g,"");return c}function showLogo(a){var c;c=document.getElementById("zmapservertip");if(c==null||c=="undefined"){c=document.createElement("div");c.className="zmapservertip";c.id="zmapservertip";c.style.cssText="display:block !important;border:1px solid red; background:#ddd; opacity:0.6;text-align:center; font-size:24px;font-weight:bold;font-style:italic;color: #FF6600;width:450px; z-index:100; height:50px;;position:absolute; bottom:5px; right:10px; ";var b="";c.innerHTML=decodeURI(b)+"<br>鏈嶅姟鍦板潃"+a+"";document.body.appendChild(c)}else{c.style.display="block !important"}setTimeout(function(){GetServerInfo(a)},10000)}function hideLogo(){var a;a=document.getElementById("zmapservertip");if(a==null||a=="undefined"){}else{a.style.display="none !important"}};
