!function(t){var a={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},e=function(){var t=function(t){this._coordinator={},this._data=[],this._radi=[],this._min=0,this._max=1,this._xField=t.xField||t.defaultXField,this._yField=t.yField||t.defaultYField,this._valueField=t.valueField||t.defaultValueField,t.radius&&(this._cfgRadius=t.radius)},e=a.defaultRadius;return t.prototype={_organiseData:function(t,a){var i=t[this._xField],r=t[this._yField],n=this._radi,s=this._data,h=this._max,o=this._min,d=t[this._valueField]||1,u=t.radius||this._cfgRadius||e;return s[i]||(s[i]=[],n[i]=[]),s[i][r]?s[i][r]+=d:(s[i][r]=d,n[i][r]=u),s[i][r]>h?(a?this.setDataMax(s[i][r]):this._max=s[i][r],!1):{x:i,y:r,value:d,radius:u,min:o,max:h}},_unOrganizeData:function(){var t=[],a=this._data,e=this._radi;for(var i in a)for(var r in a[i])t.push({x:i,y:r,radius:e[i][r],value:a[i][r]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var t=arguments[0],a=t.length;a--;)this.addData.call(this,t[a]);else{var e=this._organiseData(arguments[0],!0);e&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[e]})}return this},setData:function(t){var a=t.data,e=a.length;this._max=t.max,this._min=t.min||0,this._data=[],this._radi=[];for(var i=0;i<e;i++)this._organiseData(a[i],!1);return this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(t){return this._max=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(t){return this._min=t,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(t){this._coordinator=t},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),i=function(){var t=function(t){var a=t.gradient||t.defaultGradient,e=document.createElement("canvas"),i=e.getContext("2d");e.width=256,e.height=1;var r=i.createLinearGradient(0,0,256,1);for(var n in a)r.addColorStop(n,a[n]);return i.fillStyle=r,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data},a=function(t,a){var e=document.createElement("canvas"),i=e.getContext("2d"),r=t,n=t;if(e.width=e.height=2*t,1==a)i.beginPath(),i.arc(r,n,t,0,2*Math.PI,!1),i.fillStyle="rgba(0,0,0,1)",i.fill();else{var s=i.createRadialGradient(r,n,t*a,r,n,t);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),i.fillStyle=s,i.fillRect(0,0,2*t,2*t)}return e};function e(a){var e=a.container,i=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=a.canvas||document.createElement("canvas"),n=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(a.container)||{});r.className="heatmap-canvas",this._width=r.width=i.width=+n.width.replace(/px/,""),this._height=r.height=i.height=+n.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",e.style.position="relative",e.appendChild(r),this._palette=t(a),this._templates={},this._setStyles(a)}return e.prototype={renderPartial:function(t){this._drawAlpha(t),this._colorize()},renderAll:function(t){this._clear(),this._drawAlpha(function(t){for(var a=[],e=t.min,i=t.max,r=t.radi,n=(t=t.data,Object.keys(t)),s=n.length;s--;)for(var h=n[s],o=Object.keys(t[h]),d=o.length;d--;){var u=o[d],l=t[h][u],_=r[h][u];a.push({x:h,y:u,value:l,radius:_})}return{min:e,max:i,data:a}}(t)),this._colorize()},_updateGradient:function(a){this._palette=t(a)},updateConfig:function(t){t.gradient&&this._updateGradient(t),this._setStyles(t)},setDimensions:function(t,a){this._width=t,this._height=a,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=a},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(t){this._blur=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this._opacity=255*(t.opacity||0),this._maxOpacity=255*(t.maxOpacity||t.defaultMaxOpacity),this._minOpacity=255*(t.minOpacity||t.defaultMinOpacity)},_drawAlpha:function(t){for(var e=this._min=t.min,i=this._max=t.max,r=(t=t.data||[]).length,n=1-this._blur;r--;){var s,h=t[r],o=h.x,d=h.y,u=h.radius,l=h.value,_=o-u,c=d-u,f=this.shadowCtx;this._templates[u]?s=this._templates[u]:this._templates[u]=s=a(u,n),f.globalAlpha=l/Math.abs(i-e),f.drawImage(s,_,c),_<this._renderBoundaries[0]&&(this._renderBoundaries[0]=_),c<this._renderBoundaries[1]&&(this._renderBoundaries[1]=c),_+2*u>this._renderBoundaries[2]&&(this._renderBoundaries[2]=_+2*u),c+2*u>this._renderBoundaries[3]&&(this._renderBoundaries[3]=c+2*u)}},_colorize:function(){var t=this._renderBoundaries[0],a=this._renderBoundaries[1],e=this._renderBoundaries[2]-t,i=this._renderBoundaries[3]-a,r=this._width,n=this._height,s=this._opacity,h=this._maxOpacity,o=this._minOpacity;t<0&&(t=0),a<0&&(a=0),t+e>r&&(e=r-t),a+i>n&&(i=n-a);for(var d=this.shadowCtx.getImageData(t,a,e,i),u=d.data,l=u.length,_=this._palette,c=3;c<l;c+=4){var f,g=u[c],m=4*g;if(m)f=s>0?s:g<h?g<o?o:g:h,u[c-3]=_[m],u[c-2]=_[m+1],u[c-1]=_[m+2],u[c]=f}d.data=u,this.ctx.putImageData(d,t,a),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(t){var a=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],e=this._max,i=this._min;return Math.abs(e-i)*(a/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},e}(),r=function(){var t=!1;return"canvas2d"===a.defaultRenderer&&(t=i),t}(),n=function(){for(var t={},a=arguments.length,e=0;e<a;e++){var i=arguments[e];for(var r in i)t[r]=i[r]}return t},s=function(){var t=function(){function t(){this.cStore={}}return t.prototype={on:function(t,a,e){var i=this.cStore;i[t]||(i[t]=[]),i[t].push((function(t){return a.call(e,t)}))},emit:function(t,a){var e=this.cStore;if(e[t])for(var i=e[t].length,r=0;r<i;r++){(0,e[t][r])(a)}}},t}(),i=function(t){var a=t._renderer,e=t._coordinator,i=t._store;e.on("renderpartial",a.renderPartial,a),e.on("renderall",a.renderAll,a),e.on("extremachange",(function(a){t._config.onExtremaChange&&t._config.onExtremaChange({min:a.min,max:a.max,gradient:t._config.gradient||t._config.defaultGradient})})),i.setCoordinator(e)};function s(){var s=this._config=n(a,arguments[0]||{});if(this._coordinator=new t,s.plugin){var h=s.plugin;if(!a.plugins[h])throw new Error("Plugin '"+h+"' not found. Maybe it was not registered.");var o=a.plugins[h];this._renderer=o.renderer,this._store=o.store}else this._renderer=new r(s),this._store=new e(s);i(this)}return s.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(t){return this._config=n(this._config,t),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(t){return this._store.getValueAt?this._store.getValueAt(t):this._renderer.getValueAt?this._renderer.getValueAt(t):null}},s}(),h={create:function(t){return new s(t)},register:function(t,e){a.plugins[t]=e}};t.h337=h}(this||window);