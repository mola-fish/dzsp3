var APPWZARD=function(i,a,t){this.map3DTool=new ZMap3DLib.Input3DTool(i),this.dissectTool=i,this.viewer=i.GetView(),this._boundBoxPoint=[],this._midPlanePoins=[],this._boundBoxlanlat=[],this._sideOffset=0,this._midpoint=null,this._ballRadius=0,this._height=0,this._createWallPointc3=[],this._createWallPoint=[],this._existFlag=!1,function(i,a){if(!i||i.length<0)console.log("没有实体");else{for(var e=0,l=0,o=0,s=0,n=0,r=0,h=0,d=a.viewer.scene.primitives._primitives,u=[],p=0;p<d.length;p++){var m=d[p];if(m.id)for(var c=0;c<i.length;c++){var _=i[c]._id;if(m.id._id===_){u.push(m);break}}}for(var f=0;f<u.length;f++)if(u[f]._scaledBoundingSphere.radius>=a._ballRadius){var M=u[f]._scaledBoundingSphere.center,D=u[f]._scaledBoundingSphere.radius;e=Math.max(e,M.x),o=Math.max(o,M.y),n=Math.max(n,M.z),l=Math.min(l,M.x),s=Math.min(s,M.y),r=Math.min(r,M.z),h=Math.max(h,D),a._ballRadius=D}if(t){M=i[0].position._value;var C=new Cesium.Cartesian3(M.x-e-h,M.y-o-h,M.z-n-h),P=new Cesium.Cartesian3(M.x+e+h,M.y+o+h,M.z+n+h);a._ballRadius=Cesium.Cartesian3.distance(P,C)/2}a._midpoint=i[0]._position._value,a._height=a.dissectTool.cartesianTo2MapCoord(a._midpoint)[2],a._sideOffset=Math.sqrt(3)*a._ballRadius;var R=[GmMap3D.Math.toRadians(-135),GmMap3D.Math.toRadians(-45),GmMap3D.Math.toRadians(45),GmMap3D.Math.toRadians(135)],v=[-Math.asin(Math.sqrt(3)/3),Math.asin(Math.sqrt(3)/3)];this._boundBoxPoint=[];for(p=0;p<8;p++){var g=p%4,G=parseInt(p/4);a._boundBoxPoint.push(a.deviationCalculate(a._midpoint,R[g],v[G],a._sideOffset))}a._midPlanePoins=[];for(p=0;p<4;p++)a._midPlanePoins.push(a.deviationCalculate(a._midpoint,R[p],0,Math.sqrt(2)*a._ballRadius));a._existFlag=!0}}(a,this)};APPWZARD.prototype.deviationCalculate=function(i,a,t,e){var l=new GmMap3D.HeadingPitchRoll(a,t,0),o=GmMap3D.Transforms.headingPitchRollToFixedFrame(i,l,GmMap3D.Ellipsoid.WGS84,GmMap3D.Transforms.eastNorthUpToFixedFrame,new GmMap3D.Matrix4),s=new GmMap3D.Cartesian3(e,0,0);return GmMap3D.Matrix4.multiplyByPoint(o,s,new GmMap3D.Cartesian3)},APPWZARD.prototype.boundingBox=function(i){if(this._existFlag)return this.viewer.entities.add({id:i.id,name:i.name?i.name:i.id,position:this._midpoint,show:!0,box:{dimensions:new GmMap3D.Cartesian3(2*this._ballRadius,2*this._ballRadius,2*this._ballRadius),material:i.dcolor?this.dissectTool.colorTransform(i.dcolor):GmMap3D.Color.RED.withAlpha(.3),fill:!i.dfill||i.dfill,outline:!i.doutline||i.doutline,outlineColor:i.doutlineColor?this.dissectTool.colorTransform(i.doutlineColor):GmMap3D.Color.BLACK.withAlpha(.1),outlineWidth:i.doutlineWidth?i.doutlineWidth:1}});console.log("模型包围盒没有实例化")},APPWZARD.prototype.coordinateSystem=function(i){if(this._existFlag)for(var a=0;a<i.length;a++){var t=null,e=null;0===a&&(t=0,e=1),1===a&&(t=0,e=3),2===a&&(t=0,e=4);var l=i[a];this.viewer.entities.add({id:l.id,name:l.name?l.name:l.id,polyline:{positions:[this._boundBoxPoint[t],this._boundBoxPoint[e]],width:l.dwidth?l.dwidth:3,material:l.dcolor?this.dissectTool.colorTransform(l.dcolor):GmMap3D.Color.PURPLE}})}else console.log("模型包围盒没有实例化")},APPWZARD.prototype.boundingBall=function(i){if(this._existFlag)return this.viewer.entities.add({id:i.id,name:i.name?i.name:i.id,position:this._midpoint,show:!0,ellipsoid:{radii:new GmMap3D.Cartesian3(this._ballRadius,this._ballRadius,this._ballRadius),material:i.dcolor?this.dissectTool.colorTransform(i.dcolor):GmMap3D.Color.RED.withAlpha(.1),fill:!i.dfill||i.dfill,outline:!i.doutline||i.doutline,outlineColor:i.doutlineColor?this.dissectTool.colorTransform(i.doutlineColor):GmMap3D.Color.BLACK.withAlpha(.5),outlineWidth:i.doutlineWidth?i.doutlineWidth:1}});console.log("模型包围盒没有实例化")},APPWZARD.prototype.createProfilePlane=function(i){if(this._existFlag){var a=i.doffsetCoordinate,t=i.doffsetSize,e=i.dparallelPlane,l={},o=0;if(t&&(o=Number(t)),o>this._ballRadius)return null;var s=null,n=null,r=null;if("-x"===a||"-X"===a){var h=GmMap3D.Math.toRadians(-90);s=this.deviationCalculate(this._midpoint,h,0,o),n=2*this._ballRadius,r=2*this._ballRadius}else if("x"===a||"X"===a){h=GmMap3D.Math.toRadians(90);s=this.deviationCalculate(this._midpoint,h,0,o),n=2*this._ballRadius,r=2*this._ballRadius}else if("-y"===a||"-Y"===a){h=GmMap3D.Math.toRadians(180);s=this.deviationCalculate(this._midpoint,h,0,o),n=2*this._ballRadius,r=2*this._ballRadius}else if("y"===a||"Y"===a)s=this.deviationCalculate(this._midpoint,0,0,o),n=2*this._ballRadius,r=2*this._ballRadius;else if("-z"===a||"-Z"===a){var d=GmMap3D.Math.toRadians(-90);s=this.deviationCalculate(this._midpoint,0,d,o),n=2*this._ballRadius+o,r=2*this._ballRadius+o}else if("z"===a||"Z"===a){d=GmMap3D.Math.toRadians(90);s=this.deviationCalculate(this._midpoint,0,d,o),n=2*this._ballRadius+o,r=2*this._ballRadius+o}else s=this._midpoint,n=2*this._ballRadius,r=2*this._ballRadius;l.offsetPoint=s;var u=null;return u="x"===e||"X"===e?new GmMap3D.Plane(GmMap3D.Cartesian3.UNIT_Y,0):"y"===e||"Y"===e?new GmMap3D.Plane(GmMap3D.Cartesian3.UNIT_X,0):new GmMap3D.Plane(GmMap3D.Cartesian3.UNIT_Z,0),l.length=n,l.width=r,l.plane=u,l}console.log("模型包围盒没有实例化")},APPWZARD.prototype.drawplane=function(i,a){if(this._existFlag){var t=this;this.map3DTool._returnZ=!0,this.map3DTool.StartLineTool((function(i){}),(function(e){var l=e.geometry;if(l){for(var o=[],s=0;s<l.length;s++){var n=t.cartographicToc3(l[s]);o.push(n)}for(var r=!1,h=0;h<o.length;h++){if(t.calculateDistance(t._midpoint,o[h])){r=!0;break}}if(!r)return void console.log("点都在包围盒外");t.produceWall(o,i,a)}}))}else console.log("模型包围盒没有实例化")},APPWZARD.prototype.cartographicToc3=function(i){var a=i[0],t=i[1],e=i[2]?i[2]:0,l=this.viewer.scene.globe.ellipsoid,o=GmMap3D.Cartographic.fromDegrees(a,t,e);return l.cartographicToCartesian(o)},APPWZARD.prototype.calculateDistance=function(i,a){var t=GmMap3D.Cartesian3.distance(i,a);return!(Math.sqrt(t)>this._ballRadius)},APPWZARD.prototype.produceWall=function(i,a,t){var e=[];this._createWallPoint=[],this._createWallPointc3=[];for(var l=0;l<i.length;l++){var o=this.dissectTool.cartesianTo2MapCoord(i[l]),s=this.dissectTool.JWcoordToC3([o[0],o[1],this._height]);e.push(s)}var n=e[0],r=null,h=e[e.length-1],d=null;if(this.calculateDistance(n,this._midpoint)){var u=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(n,e[1],new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),p=GmMap3D.Cartesian3.multiplyByScalar(u,2*this._ballRadius,new GmMap3D.Cartesian3);r=GmMap3D.Cartesian3.add(n,p,new GmMap3D.Cartesian3);this._createWallPointc3.push(r)}if(this.calculateDistance(n,this._midpoint)){u=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(h,e[e.length-2],new GmMap3D.Cartesian3),new GmMap3D.Cartesian3);var m=GmMap3D.Cartesian3.multiplyByScalar(u,2*this._ballRadius,new GmMap3D.Cartesian3);d=GmMap3D.Cartesian3.add(h,m,new GmMap3D.Cartesian3)}for(var c=0;c<e.length;c++)this._createWallPointc3.push(e[c]);d&&this._createWallPointc3.push(d);for(c=0;c<this._createWallPointc3.length;c++){o=this.dissectTool.cartesianTo2MapCoord(this._createWallPointc3[c]);this._createWallPoint.push([o[0],o[1]])}this.crateWall(a,t)},APPWZARD.prototype.crateWall=function(i,a){for(var t=[],e=[],l=[],o=i.fmaximumHeight?i.fmaximumHeight:this._ballRadius+this._height,s=i.fminimumHeight?i.fminimumHeight:this._ballRadius-this._height,n=0;n<this._createWallPoint.length;n++)t.push(this._createWallPoint[n][0]),t.push(this._createWallPoint[n][1]),e.push(o),l.push(-s);var r=this.viewer.entities.add({id:i.id,name:i.name?i.name:i.id,wall:{positions:GmMap3D.Cartesian3.fromDegreesArray(t),maximumHeights:e,minimumHeights:l,material:i.dcolor?this.dissectTool.colorTransform(i.dcolor):GmMap3D.Color.BLUE.withAlpha(.5),outline:!1}});"function"==typeof a&&a(r)};