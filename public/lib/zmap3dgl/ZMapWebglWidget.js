var ZMap=ZMap||{};ZMap.WebglMapWidget=ZMap.WebglMapWidget||{},ZMap.WebglMapWidget.init=function(e,t,i){var o=this;this.zmap3dview=new ZMap3D.Map(e,t,i),o.zmap3dview.AddControl(new GmMap3D.MousePositionCtl({map:o.zmap3dview})),o.zmap3dview.RegisterKeyBoard(),this.zmap3dtool=new ZMap3DLib.Input3DTool(o.zmap3dview),this.entityGeo=o.zmap3dview.zmapGeometry=o.zmap3dview.zmapGeometry||new ZMAPGEOMETRY(o.zmap3dview),this.center=[105,36],this.zoom=5,o.zmap3dview.CenterAndZoom(o.center,o.zoom),this.removeLayer=function(e){var t=o.zmap3dview.GetUnkLayer(e);t&&o.zmap3dview.RemoveLayer(t)},this.addMapLayer=function(e){if(e.name){o.removeLayer(e.name);var t=new Cegore.ImageLayer({name:e.name||"tdtAnnoLayer",type:e.maptype||"UrlTemplate",url:e.url||"http://t0.tianditu.com/cia_w/wmts?service=WMTS&version=1.0.0&request=GetTile&Tilematrix={TileMatrix}&layer=cia&style=default&TileRow={TileRow}&TileCol={TileCol}&tilematrixset=w&format=tiles",visible:e.visible||!0,maximumLevel:e.maxZoom||18,customTags:{TileMatrix:function(e,t,i,o){return o},TileRow:function(e,t,i,o){return i},TileCol:function(e,t,i,o){return t}},scheme:"Geographic-level-0"});return o.zmap3dview.AddLayer(t),t}},this.Add3DTileMapLayer=function(e){if(param.name){removeLayer(param.name);var t=new Cegore.ImageLayer({name:e.name,type:e.maptype,url:e.url,visible:param.visible||!0,maximumLevel:param.maxZoom||18,scheme:"Geographic-level-0"});return o.zmap3dview.AddLayer(t),t}},this.AddRadarLayer=function(e){if(param.name){removeLayer(param.name);var t=new Cegore.NetCDFImageLayer({name:e.name,type:e.maptype,type:"ZMapNetCDFImage",url:e.url,visible:param.visible||!0,maximumLevel:param.maxZoom||18,scheme:"Geographic-level-0"});return o.zmap3dview.AddLayer(t),t}},this.PointQuery=function(e,t){n("左键单击开始画点",2e3),o.zmap3dtool.StartPointTool((function(e){}),(function(i){o.entityGeo.removeEntityById("testPoint");var a=i.geometry;a&&(o.addPoint({id:"testPoint",dcolor:e.color,doutlineColor:e.color,position:a,dpixelSize:e.pixelSize||5}),0!=t&&"function"==typeof t&&t(a)),o.zmap3dtool.ClearAll()}))},this.CircleQuery=function(e,t){o.entityGeo.removeEntityById("testCircle"),n("左键开始画圆形，左键双击结束画圆形",2e3);var i={material:new GmMap3D.Material({fabric:{type:"Color",uniforms:{color:e.color?this.zmap3dview.colorTransform(e.color):GmMap3D.Color.WHITE}}})};o.zmap3dtool.StartCircleTool((function(e){}),(function(i){var a=i.geometry;if(a){var n=e.id||"testCircle",l=GmMap3D.Math.toRadians(a.radius)*GmMap3D.Ellipsoid.WGS84._maximumRadius,r=o.addEllipse({id:n,position:[a.center],dheight:a.height||a.center[2]||.1,dextrudedHeight:a.height||a.center[2]||.1,doutlineColor:e.outlineColor||"red",dsemiMajorAxis:l,dsemiMinorAxis:l,dmaterial:{materialName:"dGridMaterial",dcolor:e.color||"rgba(255,255,0,1)",dcellAlpha:e.dcellAlpha||.5,dlineThickness:[1,1]}});o.zmap3dtool.ClearAll(),0!=t&&"function"==typeof t&&t(a,r,e)}}),i)},this.PolyQuery=function(e,t){n("左键开始画多边形，左键双击结束画多边形",2e3);var i={materialName:"dGridMaterial",dcolor:e.color||"rgba(255,255,0,1)",doutlineColor:e.outlineColor||"rgba(255,255,0,1)",dcellAlpha:e.dcellAlpha||.5,dlineThickness:[1,1]},a={lineWidth:e.outlineWidth||1,material:new GmMap3D.Material({fabric:{type:"Grid",uniforms:{color:i.dcolor?this.zmap3dview.colorTransform(i.dcolor):GmMap3D.Color.WHITE,cellAlpha:i.dcellAlpha?Number(i.dcellAlpha):.1,lineCount:i.dlineCount?new GmMap3D.Cartesian2(Number(i.dlineCount[0]),Number(i.dlineCount[1])):new GmMap3D.Cartesian2(8,8),lineThickness:i.dlineThickness?new GmMap3D.Cartesian2(Number(i.dlineThickness[0]),Number(i.dlineThickness[1])):new GmMap3D.Cartesian2(1,1),lineOffset:i.dlineOffset?new GmMap3D.Cartesian2(Number(i.dlineOffset[0]),Number(i.dlineOffset[1])):new GmMap3D.Cartesian2(0,0)}}})};o.zmap3dtool.StartPolygonTool((function(e){}),(function(i){o.entityGeo.removeEntityById("testPolygon");var a=i.geometry;if(a){a[0].join(","),a[1].join(","),n("结束画多边形",1e3);for(var l=0;l<a.length;l++)a[l][2]=a[l][2]||1;var r={id:"testPolygon",position:a,doutline:!0,dperPositionHeight:!0,doutlineColor:e.outlineColor||"rgba(255,255,0,1)",doutlineWidth:2,dmaterial:{materialName:"dGridMaterial",dcolor:e.color||"rgba(255,255,0,1)",dcellAlpha:e.dcellAlpha||.5,dlineThickness:[1,1]}};o.addPolygon(r),0!=t&&"function"==typeof t&&t(a)}}),a)},this.RectQuery=function(e,t){n("左键按下开始画矩形，左键抬起结束画矩形",2e3);var i={materialName:"dGridMaterial",dcolor:e.color||"rgba(255,255,0,1)",doutlineColor:e.outlineColor||"rgba(255,255,0,1)",dcellAlpha:e.dcellAlpha||.65,dlineThickness:[1,1]},a={lineWidth:e.outlineWidth||1,material:new GmMap3D.Material({fabric:{type:"Grid",uniforms:{color:i.dcolor?this.zmap3dview.colorTransform(i.dcolor):GmMap3D.Color.WHITE,cellAlpha:i.dcellAlpha?Number(i.dcellAlpha):.1,lineCount:i.dlineCount?new GmMap3D.Cartesian2(Number(i.dlineCount[0]),Number(i.dlineCount[1])):new GmMap3D.Cartesian2(8,8),lineThickness:i.dlineThickness?new GmMap3D.Cartesian2(Number(i.dlineThickness[0]),Number(i.dlineThickness[1])):new GmMap3D.Cartesian2(1,1),lineOffset:i.dlineOffset?new GmMap3D.Cartesian2(Number(i.dlineOffset[0]),Number(i.dlineOffset[1])):new GmMap3D.Cartesian2(0,0)}}})};o.zmap3dtool.StartRectTool((function(e){}),(function(i){o.entityGeo.removeEntityById("testRectangle");var a=i.geometry,l=[];l.push([a[0],a[1],i.height||0]),l.push([a[2],a[1],i.height||0]),l.push([a[2],a[3],i.height||0]),l.push([a[0],a[3],i.height||0]),l.push([a[0],a[1],i.height||0]),n("结束画矩形",1e3);for(var r=0;r<l.length;r++)l[r][2]=l[r][2]||1;var d={id:"testRectangle",position:l,doutline:!0,dperPositionHeight:!0,doutlineColor:e.outlineColor||"rgba(255,255,0,1)",doutlineWidth:2,dmaterial:{materialName:"dGridMaterial",dcolor:e.color||"rgba(255,255,0,1)",dcellAlpha:e.dcellAlpha||.5,dlineThickness:[1,1]}};o.addPolygon(d),o.zmap3dtool.ClearAll(),0!=t&&"function"==typeof t&&t(a)}),a)},this.LineQuery=function(e,t){n("左键单击开始画线，双击结束画线",2e3);var i={material:new GmMap3D.Material({fabric:{type:"Color",uniforms:{color:e.color?this.zmap3dview.colorTransform(e.color):GmMap3D.Color.RED}}})};o.zmap3dtool.StartLineTool((function(e){}),(function(i){var a=i.geometry;if(a){n("结束画线",1e3);for(var l=0;l<a.length;l++)a[l][2]=a[l][2]||0;o.entityGeo.removeEntityById("testLine"),o.addLine({id:"testLine",position:a,dfollowSurface:!0,dclampToGround:!0,dwidth:e.lineWidth?e.lineWidth:3,dmaterial:{materialName:"dPolylineOutlineMaterialProperty",dcolor:e.color||"rgba(255,255,0,1)",doutlineColor:e.outlineColor||"rgba(255,255,0,1)",doutlineWidth:0}}),o.zmap3dtool.ClearAll(),0!=t&&"function"==typeof t&&t(a)}}),i)},this.addPoint=function(e){return o.entityGeo.addPoint(e)},this.addPoints=function(e){return o.entityGeo.addPoints(e)},this.addLine=function(e){return o.entityGeo.addLine(e)},this.addPolygon=function(e){return o.entityGeo.Addpolygon(e)},this.addEllipse=function(e){return o.entityGeo.addellipse(e)},this.toolClearAll=function(){o.entityGeo.removeEntityById("testLine"),o.entityGeo.removeEntityById("testRectangle"),o.entityGeo.removeEntityById("testPolygon"),o.entityGeo.removeEntityById("testCircle"),o.entityGeo.removeEntityById("testPoint"),l(),o.zmap3dtool.ClearAll()};var a=null;function n(e,t){if(l(),null==a){null==t&&(t=3e3);var i=o.zmap3dview.GetViewCenter();if(null==i)return void this.CloseFlashTip();o.zmap3dview.AddTextLabel("only-tip",i[0],i[1],e,{id:"TextLabel",position:[119.345,23.4546,0],dtext:"测试文字标注",dfont:"15px 宋体",dstyle:"FILL_AND_OUTLINE",dfillColor:"rgba23,34,34,0",doutlineColor:"red",doutlineWidth:1,dshowBackground:!1,dscale:1,dhorizontalOrigin:"CENTER",dverticalOrigin:"CENTER",deyeOffset:[0,0,0],ddistanceDisplayCondition:[10,2e7],dscaleByDistance:[10,2,8e6,0]}),a=window.setInterval(l,t)}}function l(){null!=a&&(o.zmap3dview.RemoveLabel("only-tip"),window.clearInterval(a),a=null)}this.getCenter=function(){return o.zmap3dview.GetViewCenter()},this.getZoom=function(){return o.zmap3dview.GetZoom()},this.getCegore=function(){return o.zmap3dview.GetCegore()},this.getCesium=function(){return o.zmap3dview.GetCesium()},this.addModel=function(e){var t=e.id||"testModel",i={position:e.position||[110.05254,25.002073,0],rotate:e.rotate||[0,0,0],shadows:e.shadows||!0,url:e.url||"./gltf/WoodTower/Wood_Tower.gltf"};o.zmap3dview.AddModel(t,i)},this.removeModel=function(e){o.zmap3dview.RemoveModel(e)},this.rotateModel=function(e,t){o.zmap3dview.RotateModel(e,t)},this.getModel=function(e){return o.zmap3dview.GetModel(e)},this.pickModel=function(e){return o.zmap3dview.PickModel(e)},this.dztModel=function(e,t,i,a,n){return o.zmap3dview.addZmapModel(e,t,i,a,n)},this.zmap3DTilesModel=new ZMAP3DTILES(o.zmap3dview),this.add3DTiless=function(e,t,i,a){o.zmap3DTilesModel.add3dTiles(e,t,i,a)},this.moveRotateModel=function(){},this.getCamera=function(){return o.zmap3dview.getCamera()},this.setCamera=function(e){o.zmap3dview.setCamera(e)}};