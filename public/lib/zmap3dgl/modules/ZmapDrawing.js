import Calc from"./ZmapCompute.js";export default class ZmapDrawing{constructor(e){this.viewer=e,this.czviewer=e._czdata.viewer,this.calc=new Calc(e)}startdrawPoint(e={}){const{viewer:t,czviewer:n,calc:i}=this,o=new Cesium.ScreenSpaceEventHandler(n.canvas),{pointOptions:c,leftClick:s,rightClick:p,drawheight:r}=e,u=[],l=r||void 0;o.setInputAction((function(e){const t=i.getendpt(e.position,l);if(!t)return;const o=n.entities.add({position:t,point:{color:Cesium.Color.RED,pixelSize:5,...c}});u.push(o),"function"==typeof s&&s(startPoints)}),Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction((function(e){o.destroy(),u.forEach(e=>{n.entities.remove(e)}),"function"==typeof p&&p(u)}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}startdrawLine(e={}){const{viewer:t,czviewer:n,calc:i}=this,o=new Cesium.ScreenSpaceEventHandler(n.canvas),c=[];let s=null,p=null;const{polylineOptions:r,leftClick:u,leftDbClick:l,rightClick:a,mouseMove:C,drawLineHeight:m}=e,v=m||void 0;function f(){var e=c.slice(0);return p&&e.push(p),e}o.setInputAction((function(e){const t=i.getendpt(e.position,v);t&&(c.push(t),"function"==typeof u&&u(c))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction((function(e){if(c.length<1)return;const t=i.getendpt(e.endPosition,v);t&&(s?p=t:s=n.entities.add({polyline:{positions:new Cesium.CallbackProperty(f,!1),width:2,followSurface:!1,show:!0,material:new Cesium.Color(174/255,238/255,238/255),...r}}),"function"==typeof C&&C(p,c))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction((function(e){o.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),o.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);var t=c.slice(0);p&&t.push(p),"function"==typeof l&&l(t,s)}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),o.setInputAction((function(e){o.destroy(),n.entities.remove(s),"function"==typeof a&&a()}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}startDrawPolygon(e={}){const{viewer:t,czviewer:n,calc:i}=this,{polygonOptions:o,leftClick:c,leftDbClick:s,rightClick:p,mouseMove:r,drawLineHeight:u}=e,l=new Cesium.ScreenSpaceEventHandler(n.canvas),a=u||void 0;var C=null,m=null,v=[],f=[];let S=function(){f.length=0;for(var e=null,t=0;t<v.length;++t)null!=v[t]&&(null==e?(e=v[t],f.push(e.clone())):e.equalsEpsilon(v[t],0,.1)||(e=v[t],f.push(e.clone())));return f.length>=3&&f.push(f[0].clone()),f};l.setInputAction((function(e){v.length<1||(v[v.length-1]=i.getendpt(e.endPosition,a),2==v.length&&(C||(C=n.entities.add({polyline:{positions:new Cesium.CallbackProperty(S,!1),width:1,followSurface:!1,show:!0,material:Cesium.Color.RED,height:a}}))),v.length>2&&(C&&(n.entities.remove(C),C=null),m||(m=n.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty(S,!1),material:new Cesium.Color(174/255,238/255,238/255,.7),height:a,...o},id:"drawpolygon"}))),"function"==typeof r&&r(i.getendpt(e.endPosition,a)))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction((function(e){console.log("dbclick"),l.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),l.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),l.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),"function"==typeof s&&s(f,m)}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),l.setInputAction((function(e){l.destroy(),n.entities.remove(C),n.entities.remove(m),"function"==typeof p&&p()}),Cesium.ScreenSpaceEventType.RIGHT_CLICK),l.setInputAction((function(e){console.log("click");const t=i.getendpt(e.position,a);t&&(0==v.length&&v.push(t),v.push(null),"function"==typeof c&&c(line))}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}startdrawCircle(e={}){const{viewer:t,czviewer:n,calc:i}=this,{polylineOptions:o,leftClick:c,leftDbClick:s,rightClick:p,mouseMove:r,drawheight:u}=e,l=u||void 0,a=new Cesium.ScreenSpaceEventHandler(n.canvas),C=[];let m=null,v=null,f=null,S=0;function E(){S=C[0]&&v?Cesium.Cartesian3.distance(C[0],v):0;const e=i.getCircleLinepoints(Cesium.Cartographic.fromCartesian(C[0]),S,3600);return e.push(e[0]),e}a.setInputAction((function(e){var t=i.getendpt(e.position,l);t&&(C.push(t),1==C.length&&(f=n.entities.add({position:C[0],point:{color:Cesium.Color.RED,pixelSize:3}})),"function"==typeof c&&c(t))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(t){C.length<1||(m?v=i.getendpt(t.endPosition,Cesium.Cartographic.fromCartesian(C[0]).height):m=n.entities.add({polyline:{positions:new Cesium.CallbackProperty(E,!1),width:e.width?e.width:2,followSurface:!0===e.followSurface,show:!0,material:e.material?e.material:new Cesium.Color(188/255,238/255,104/255),...o}}),"function"==typeof r&&r(i.getendpt(t.endPosition,Cesium.Cartographic.fromCartesian(C[0]).height)))}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(e){a.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),a.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),a.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),"function"==typeof s&&s(C[0],S,m)}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),a.setInputAction((function(e){a.destroy(),n.entities.remove(m),n.entities.remove(f),"function"==typeof p&&p()}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}}