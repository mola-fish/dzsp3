import CALC from"./ZmapCompute.js";export default class{constructor(e,t={}){const{bottom:n,top:i,left:s,right:a,padding:o,width:l,height:c}=t;this.viewer=e,this.czviewer=e._czdata.viewer,this.calc=new CALC(e),this.entities=[],this.mainPanel=document.createElement("div"),this.mainPanel.style.position="absolute",this.mainPanel.style.padding=defaultValue(o,"2vh"),this.mainPanel.style.bottom=defaultValue(n,"1vh"),this.mainPanel.style.top=defaultValue(i),this.mainPanel.style.left=defaultValue(s,".5vw"),this.mainPanel.style.right=defaultValue(a),this.mainPanel.style.width=defaultValue(l,"25vh"),this.mainPanel.style.height=defaultValue(c,"15vh"),this.mainPanel.style.backgroundColor="rgb(7,28,93)",document.body.appendChild(this.mainPanel),this.registerCegoreActions(),this.registerCegoreActions()}add(e,t){let n;e instanceof Element&&(n=e),"string"==typeof e&&(n=document.createElement("img"),n.src=e),n.draggable=!1,this.mainPanel.appendChild(n);const i=[];for(const e in t)i.push(e.concat("ï¼š").concat(t[e]));const s=i.join("  \n");this.registerDomActions(n,s)}registerDomActions(e,t){const n=e,i=this;n.onmousedown=function(e){"absolute"!=$(n).css("position")&&$(n).css("position","absolute");const s=e,a=s.clientX-n.offsetLeft,o=s.clientY-n.offsetTop,l=a-n.parentElement.offsetLeft-n.clientWidth/2,c=o-n.parentElement.offsetTop-n.clientHeight;document.onmousemove=function(e){const t=e;n.style.left=t.clientX-a+"px",n.style.top=t.clientY-o+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null;const s=i.calc.getendpt(new Cesium.Cartesian2(e.clientX-l,e.clientY-c)),a=i.czviewer.entities.add({id:"policeman_"+Math.random(),position:s,billboard:{image:n,pixelOffset:new Cesium.Cartesian2(0,-27)},label:{text:t,font:"2.5vh -apple-system",show:!1,fillColor:Cesium.Color.BLUE,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-53),backgroundColor:new Cesium.Color(174/255,238/255,238/255,.7)}});i.entities.push(a),i.mainPanel.removeChild(n)}}}registerCegoreActions(){const{viewer:e,czviewer:t,calc:n}=this,i=this.sceneHandler=new Cesium.ScreenSpaceEventHandler(this.czviewer.canvas);let s,a,o=new Cesium.Cartesian2;i.setInputAction(e=>{const n=t.scene.pick(e.position);if(!n)return;const i=n.id;if(i&&"policeman_"==i.id.substr(0,10)&&i.billboard instanceof Cesium.BillboardGraphics&&i.label instanceof Cesium.LabelGraphics){s=i,t.scene.screenSpaceCameraController.enableInputs=!1;const n=t.scene.cartesianToCanvasCoordinates(i.position.getValue(new Cesium.JulianDate));Cesium.Cartesian2.add(n,Cesium.Cartesian2.negate(e.position,e.position),o)}},Cesium.ScreenSpaceEventType.LEFT_DOWN),i.setInputAction(e=>{if(!s)return;const t=n.getendpt(Cesium.Cartesian2.add(e.endPosition,o,e.endPosition));t&&(s.position=t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction(e=>{s=null,t.scene.screenSpaceCameraController.enableInputs=!0},Cesium.ScreenSpaceEventType.LEFT_UP),this.listener=this.czviewer.selectedEntityChanged.addEventListener(e=>{a&&(a.label.show=!1),e&&"policeman_"==e.id.substr(0,10)&&e.billboard instanceof Cesium.BillboardGraphics&&e.label instanceof Cesium.LabelGraphics?(e.label.show=!0,a=e):t.trackedEntity=null})}}function defaultValue(e,t){return null!=e?e:t}