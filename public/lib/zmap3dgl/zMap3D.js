var globeMap3D={},GmMap3D=Cesium,ZMAP3D=GmMap3D,Map3DSDK=Map3DSDK||{};!function(){var t=Map3DSDK.Map=function(e,t,i){var o=null,a=null;i&&null!=i&&null!=i&&(i.terrain&&(o=i.terrain),a=i.images?i.images:[{name:"tdt",type:"UrlTemplate",url:"http://www.google.cn/maps/vt?lyrs=s@748&gl=cn&x={x}&y={y}&z={z}",visible:!0,maximumLevel:18,scheme:"Geographic-level-0"}]);var n=null;if(n=null!=o?{fullscreenElement:e,fullscreenButton:!1,geocoder:!1,sceneMode:GmMap3D.defaultValue(i.sceneMode,GmMap3D.SceneMode.SCENE3D),terrain:o,images:a,currentTime:new Date(2017,12,26,12,0,0),infoBox:!1,animation:!1,shouldAnimate:!0}:{fullscreenElement:e,fullscreenButton:!1,sceneMode:GmMap3D.defaultValue(i.sceneMode,GmMap3D.SceneMode.SCENE3D),geocoder:!1,images:a,currentTime:new Date(2017,12,26,12,0,0),infoBox:!1,animation:!1,shouldAnimate:!0},t&&"object"==typeof t)for(var r=Object.keys(t),s=0;s<r.length;s++)n[r[s]]=t[r[s]];var l=new Cegore.Viewer(e,n);if(l.camera.setView({rect:i.rect||[-95.59,40.03,-95.6,40.04]}),this.divID=e,this.cegore=l,this.cesium=l._czData,globeMap3D[e]=this,this._initq=new ZMAP3D.Quaternion(-.5,-.5,-.5,.5),this.handlerArray=[],this.taskLoadMap={},this.dmap=[61437120,30718560,22914940,15003300,7679640,3839820,1484560,763e3,381010,196080,91300,46070,23210,11290,5730,2900,1450,750,360,180,100,50],this.Keyflags={looking:!0,moveUp:!1,moveLeft:!1,moveRight:!1,moveForward:!1,moveBackward:!1},this.controls={},this.layerMap={},(i=i||{navigation:!0,mousePosition:!0}).navigation)try{this.cesium.viewer.extend(GmMap3D.viewerCesiumNavigationMixin,{})}catch(e){}i.mousePosition&&this.AddControl(new ZMAP3D.MousePositionCtl),this.cesium.viewer.scene.globe.depthTestAgainstTerrain=!1,this.cesium.viewer.scene.rethrowRenderErrors=!1,this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),Map3DSDK.map3DView=this;var p=this;this.dbClick=this.AddEventListener("dblclick",(function(e){var t=e.position,i=p.PickModel(t).models;GmMap3D.defined(i)||p.unLockModel()})),this.mouseWheel=this.AddEventListener("wheel",(function(){for(var e=p.getCamera().position[2],t=p.GetView().entities.values,i=0;i<t.length;i++)if(t[i].model&&t[i].model&&t[i].scaleBase&&"number"==typeof t[i].scaleBase){var o=e/t[i].scaleBase<1?1:e/t[i].scaleBase;p.changeScaleModel(t[i],o)}})),this.fullscreenViewModel=new ZMAP3D.FullscreenButtonViewModel(e),window.addEventListener("mousewheel",(function(e){1===e.deltaY&&e.preventDefault()})),function(e){e._renderLoopRunning=!0;var t=0;requestAnimationFrame((function i(o){if(!e.isDestroyed())try{var a=e._targetFrameRate;if(Cesium.defined(a)){var n=1e3/a,r=o-t;r>n&&(e.resize(),e.render(),t=o-r%n),requestAnimationFrame(i)}else e.resize(),e.render(),requestAnimationFrame(i)}catch(e){requestAnimationFrame(i)}}))}(this.cesium.viewer.cesiumWidget);new ZMAP3D.BoundingSphere(Cesium.Cartesian3.ZERO,6378137);var h=ZMAP3D.Globe.prototype.pickWorldCoordinates;ZMAP3D.Globe.prototype.pickWorldCoordinates=function(e,t,i){var o=h.call(this,e,t,i);if(Cesium.defined(o))return o};var m={enableCollisionDetection:!1,depthTestAgainstTerrain:!1};this.enable(m),m={minAngle:0,minHeight:-1e4,minimumZoomDistance:10},this.setInputParam(m),this.checkpower(),this.GetView().scene.highDynamicRange=!1};function i(){var e=null;for(var t in globeMap3D){e=globeMap3D[t];break}return e}t.prototype.checkpower=function(){var e=decodeURIComponent("%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E4%B8%BA%E8%AF%95%E7%94%A8%E7%89%88%EF%BC%8C%E6%9C%AA%E6%AD%A3%E5%BC%8F%E6%8E%88%E6%9D%83");$.ajax({url:window.location.protocol+"//"+window.location.host+"/zs/cms/lic/q",dataType:"json",success:function(t){t.lic&&t.lic.authorizer&&""!=t.lic.authorizer&&(e=t.lic.authorizer)}});var t=randomString(32),i=CodeString(t);decodeURIComponent("%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF%E6%88%96%E8%80%85%E8%AF%81%E4%B9%A6%E5%B7%B2%E8%BF%87%E6%9C%9F");$.ajax({url:window.location.protocol+"//"+window.location.host+"/zs/cms/lic/check",type:"GET",data:{param:i,version:6},async:!0,success:function(e){var i=e.sign;t==i&&"OK"==e.lic.status&&""}}),$("#"+this.divID).append("<span style='position:absolute;right:2px;bottom:2px;color:#fff;font-size:12px;' >"+e+"</span>")},t.prototype.setTerrain=function(e){var t={type:e.type||"ZMapTerrain",url:e.url||"",tileWidth:e.tileWidth||64,tileHeight:e.tileHeight||64,waterMask:!!e.waterMask,waterHeight:e.waterHeight?e.waterHeight:0,heightOffset:e.heightOffset?e.heightOffset:0,tilingScheme:new GmMap3D.GeographicTilingScheme({ellipsoid:e.ellipsoid||GmMap3D.Ellipsoid.WGS84,numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX?e.numberOfLevelZeroTilesX:8,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY?e.numberOfLevelZeroTilesY:4})};Cegore.TypeCheck.isObject(t)&&this.cegore.globe.setTerrain(t)},t.prototype.getScreenSpaceCameraController=function(){return this.cesium.viewer.scene._screenSpaceCameraController},t.prototype.enable=function(e){ZMAP3D.defined(e.enableCollisionDetection)&&(this.getScreenSpaceCameraController().enableCollisionDetection=e.enableCollisionDetection),ZMAP3D.defined(e.depthTestAgainstTerrain)&&(this.cesium.viewer.scene.globe.depthTestAgainstTerrain=e.depthTestAgainstTerrain),ZMAP3D.defined(e.rethrowRenderErrors)&&(this.cesium.viewer.scene.rethrowRenderErrors=e.rethrowRenderErrors)},t.prototype.setInputParam=function(e){var t=this.getScreenSpaceCameraController();for(var i in ZMAP3D.defined(e.minAngle)&&(t._minAngle=e.minAngle),ZMAP3D.defined(e.minHeight)&&(t._minHeight=e.minHeight),ZMAP3D.defined(e.minimumZoomDistance)&&(t.minimumZoomDistance=e.minimumZoomDistance),e)ZMAP3D.defined(e[i])&&(t[i]=e[i])},t.prototype.morphTo2D=function(){this.cesium.scene.morphTo2D()},t.prototype.morphTo3D=function(){this.cesium.scene.morphTo3D()},t.prototype.morphToColumbusView=function(){this.cesium.scene.morphToColumbusView()},t.prototype.fullscreen=function(){this.fullscreenViewModel.command()},t.prototype.GetCegore=function(){return this.cegore},t.prototype.GetCesium=function(){return this.cesium},t.prototype.EnableDebug=function(e){e&&this.cesium.viewer.extend(GmMap3D.viewerCesiumInspectorMixin)},t.prototype.setControlsBackground=function(e){$("#setControlsBackground").remove();var t='<style id="setControlsBackground">.compass-outer-ring-background{border-color:'+e+"}.compass-outer-ring-background,.compass-gyro-background,.navigation-controls{background:"+e+"}.</style>";$("head").append(t)},t.prototype.GetMap=function(){return this.cesium},t.prototype.GetView=function(){return this.cesium.viewer},t.prototype.SetKeyBoardMsg=function(e){this.Keyflags=e},t.prototype.GetKeyBoardMsg=function(){return this.Keyflags},t.prototype.RegisterKeyBoard=function(){var e=this.GetView(),t=e.canvas,i=e.scene.globe.ellipsoid,o=(new GmMap3D.ScreenSpaceEventHandler(t),this.Keyflags);e.clock.onTick.addEventListener((function(t){var a=e.camera,n=i.cartesianToCartographic(a.position).height/100;o.moveForward&&a.moveForward(n),o.moveBackward&&a.moveBackward(n),o.moveUp&&a.moveUp(n),o.moveDown&&a.moveDown(n),o.moveLeft&&a.moveLeft(n),o.moveRight&&a.moveRight(n)}))},t.prototype.JW2MapExtent=function(e){var t=e;if("EPSG:900913"==this.GetProjectCode()){var i=Map3DSDK.Convert("EPSG:4326","EPSG:900913",[e[0],e[1]]),o=Map3DSDK.Convert("EPSG:4326","EPSG:900913",[e[2],e[3]]);t=[i[0],i[1],o[0],o[1]]}return t},t.prototype.IsInView=function(e){var t=this.JW2MapCoord(e),i=this.GetViewRect();return!(t[0]<i[0]||t[0]>i[2]||t[1]<i[1]||t[1]>i[3])},t.prototype.SetResetCenterAndZoom=function(...e){this.setResetCenterAndZoom(...e)},t.prototype.setResetCenterAndZoom=function(e,t,i){let o=this.GetHeightByZoom(i||5);this.setResetCenterAndHeight(e,t,o)},t.prototype.setResetCenterAndHeight=function(e,t,i){try{let o=this.cesium.viewer.cesiumNavigation.navigationViewModel.controls;for(let a=0;a<o.length;a++)"navigation-control3D-icon-reset"==o[a].cssClass&&o[a].setLocate(e,t,i)}catch(e){console.warn("设置默认位置失败")}},t.prototype.GetResetCenterAndZoom=function(){try{for(var e,t=this.cesium.viewer.cesiumNavigation.navigationViewModel.controls,i=0;i<t.length;i++)if("navigation-control3D-icon-reset"==t[i].cssClass){e=t[i].getLocate();break}return e[2]=this.GetZoomByHeight(e[2]),e}catch(e){}return[0,0,1]},t.prototype.CenterAndZoom=function(e,t){this.SetViewCenter(e[0],e[1]),this.SetZoom(t)},t.prototype.AddTileMapLayer=function(e){if((e=e||{}).url){var t=new Cegore.ImageLayer({name:e.name||"imagelayer",type:e.type||"ZMapImage",url:e.url,brightness:e.brightness||1,visible:!!e.visible,maximumLevel:e.maximumLevel||18,scheme:e.scheme||"Geographic-level-0"});return this.AddLayer(t)}},t.prototype.AddLayer=function(e){try{var t=this.GetLayerName(e);if(this.layerMap[t])throw"exist layer: "+t;var i=this.GetMap(),o=i.viewer.imageryLayers.length;i.viewer.imageryLayers.add(e._czLayer,o),this.layerMap[e.name]=e}catch(e){return null}},t.prototype.GetLayerName=function(e){return e.name},t.prototype.GetUnkLayer=function(e){this.GetMap();var t=this.layerMap[e];return null==t&&(t=this.GetCegore().images.get(e))&&(this.layerMap[e]=t),t},t.prototype._GetInnerZMapLayer=function(e){return"string"==typeof e?this.GetUnkLayer(e):e instanceof GmMap3D.ImageryLayer?e._ZMapLayer:(Cegore.NetCDFImageLayer,e)},t.prototype._GetCzLayer=function(e){return"string"==typeof e?rLayer=this.GetUnkLayer(e):e instanceof"ImageryLayer"?rLayer=e._ZMapLayer:e instanceof"NetCDFImageLayer"&&(rLayer=e),rLayer._czLayer},t.prototype.RemoveLayer=function(e){var t,i=this._GetInnerZMapLayer(e);if(null!=i){t=i.name;var o=this.GetLayerName(i);delete this.layerMap[o];for(var a=this.GetMap(),n=a.viewer.imageryLayers.length,r=0;r<n;r++){if((o=(e=a.viewer.imageryLayers._layers[r])._ZMapLayer.name)==t){a.viewer.imageryLayers.remove(e);break}}}},t.prototype.GetLayers=function(){var e=[];for(var t in this.layerMap)e.push(this.layerMap[t]);return e},t.prototype.SetVisible=function(e,t){var i=this._GetCzLayer(e);i&&(i.show=t)},t.prototype.IsVisible=function(e){return this._GetCzLayer(e).show},t.prototype.JW2MapCoord=function(e){return e},t.prototype.GetViewCenter=function(){var e=this.GetView(),t=e.camera.pickEllipsoid(new GmMap3D.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),i=GmMap3D.Ellipsoid.WGS84.cartesianToCartographic(t);return[180*i.longitude/Math.PI,180*i.latitude/Math.PI,i.height]},t.prototype.FlyTo=function(e,t,i){i=i||{};var o=this.GetView().camera,a=i.height?i.height:15e4,n=new GmMap3D.Cartesian3(e,t,a),r=(o=this.GetView().camera,this.GetView().scene.globe.ellipsoid),s=GmMap3D.Cartesian3.fromDegrees(n.x,n.y,n.z,r);o.flyTo({destination:s,duration:i.duration?i.duration:2,orientation:{heading:GmMap3D.Math.toRadians(i.heading?i.heading:0),pitch:GmMap3D.Math.toRadians(i.pitch?i.pitch:-90),roll:GmMap3D.Math.toRadians(i.roll?i.roll:0)}})},t.prototype.setCamera=function(e){var t=this.GetView().camera,i=e.position;if(i&&Array.isArray(i))var o=GmMap3D.Cartesian3.fromDegrees(i[0]||0,i[1]||0,i[2]||0);else o=t.position;var a=e.rotate;if(a&&Array.isArray(i))var n=GmMap3D.Math.toRadians(parseFloat(a[0])),r=GmMap3D.Math.toRadians(parseFloat(a[1])),s=GmMap3D.Math.toRadians(parseFloat(a[2])),l=new GmMap3D.HeadingPitchRoll(n,r,s);else l={heading:t.heading,pitch:t.pitch,roll:t.roll};t.flyTo({destination:o,duration:e.duration?e.duration:2,orientation:l})},t.prototype.getCamera=function(){var e=this.GetView().camera;return{position:this.cartesianTo2MapCoord(e.position),rotate:[GmMap3D.Math.toDegrees(e.heading),GmMap3D.Math.toDegrees(e.pitch),GmMap3D.Math.toDegrees(e.roll)]}},t.prototype.SetViewCenter=function(e,t,i){var o=(i=i||{}).height?i.height:15e4,a=new GmMap3D.Cartesian3(e,t,o),n=this.GetView().camera,r=this.GetView().scene.globe.ellipsoid,s=GmMap3D.Cartesian3.fromDegrees(a.x,a.y,a.z,r);n.setView({destination:s,orientation:{heading:GmMap3D.Math.toRadians(i.heading?i.heading:0),pitch:GmMap3D.Math.toRadians(i.pitch?i.pitch:-90),roll:GmMap3D.Math.toRadians(i.roll?i.roll:0)}})},t.prototype.SetZoom=function(e){for(var t=$("#"+this.divID).width(),i=$("#"+this.divID).height(),o=(t>i?t:i)/1366,a=[],n=0;n<this.dmap.length;n++)a.push(this.dmap[n]*o);var r=[99999999999];for(n=1;n<a.length;++n)r[n]=(a[n-1]+a[n])/2;r[r.length]=0;var s=(r[e-1]+r[e])/2,l=this.GetViewCenter(),p=new GmMap3D.Cartesian3(l[0],l[1],s),h=this.GetView().camera,m=this.GetView().scene.globe.ellipsoid,d=GmMap3D.Cartesian3.fromDegrees(p.x,p.y,p.z,m);h.setView({destination:d,endTransform:GmMap3D.Matrix4.IDENTITY})},t.prototype.GetZoom=function(){for(var e=$("#"+this.divID).width(),t=$("#"+this.divID).height(),i=(e>t?e:t)/1366,o=[],a=0;a<this.dmap.length;a++)o.push(this.dmap[a]*i);var n=[99999999999];for(a=1;a<o.length;++a)n[a]=(o[a-1]+o[a])/2;n[n.length]=0;var r=this.GetView().camera.position,s=this.cesium.ellipsoid.cartesianToCartographic(r).height;for(a=0;a<n.length;++a)if(s>=n[a])return a;return n.length},t.prototype.GetHeightByZoom=function(e){for(var t=$("#"+this.divID).width(),i=$("#"+this.divID).height(),o=(t>i?t:i)/1366,a=[],n=0;n<this.dmap.length;n++)a.push(this.dmap[n]*o);var r=[99999999999];for(n=1;n<a.length;++n)r[n]=(a[n-1]+a[n])/2;return r[r.length]=0,e<0?r[0]:e>r.length?r[r.length-1]:r[e]},t.prototype.GetZoomByHeight=function(e){for(var t=$("#"+this.divID).width(),i=$("#"+this.divID).height(),o=(t>i?t:i)/1366,a=[],n=0;n<this.dmap.length;n++)a.push(this.dmap[n]*o);var r=[99999999999];for(n=1;n<a.length;++n)r[n]=(a[n-1]+a[n])/2;r[r.length]=0;var s=e;for(n=0;n<r.length;++n)if(s>=r[n])return n;return r.length},t.prototype.GetViewRect=function(){var e=180/Math.PI,t=this.GetView().camera.computeViewRectangle();return[t.west*e,t.south*e,t.east*e,t.north*e]},t.prototype.SetViewRect=function(e,t,i,o,a){a=a||{},this.GetView().camera.flyTo({destination:GmMap3D.Rectangle.fromDegrees(e,t,i,o),duration:a.duration?a.duration:1})},t.prototype.setViewRectByPositions=function(e,t){if(t=t||{},Array.isArray(e)&&e.length>1&&Array.isArray(e[0])){for(var i=[0,0,0,0],o=0;o<e.length;o++){var a=e[o][0],n=e[o][1];0==o?(i[0]=a,i[2]=a,i[1]=n,i[3]=n):(i[0]=i[0]<=a?i[0]:a,i[2]=i[2]>=a?i[2]:a,i[1]=i[1]<=n?i[1]:n,i[3]=i[3]>=n?i[3]:n)}if(null!=t.scale){var r=isNaN(parseFolat(t.scale))?.6:parseFolat(t.scale)>0?parseFolat(t.scale):.6;r=r>.6?.6:r,i[0]=i[0]-(i[2]-i[0])*(1-r)/2,i[1]=i[1]-(i[3]-i[1])*(1-r)/2,i[2]=i[2]+(i[2]-i[0])*(1-r)/2,i[3]=i[3]+(i[3]-i[1])*(1-r)/2}if(i[0]==i[2]||i[1]==i[3])return;this.SetViewRect(i[0],i[1],i[2],i[3],t)}},t.prototype.GetPixelFromCoordinate=function(e,t){this.Screen2MapCoord([e,t])},t.prototype.Screen2MapCoord=function(e){var t={x:e[0],y:e[1]},i=this.cesium,o=i.scene.camera.getPickRay(t),a=i.scene.globe.pick(o,i.viewer.scene);if(!a)return null;var n=i.ellipsoid.cartesianToCartographic(a);return[(n.longitude/Math.PI*180).toFixed(6),(n.latitude/Math.PI*180).toFixed(6),n.height]},t.prototype.MapCoord2Screen=function(e){var t=e[0],i=e[1],o=e[2]?e[2]:0,a=this.cesium,n=GmMap3D.Cartesian3.fromDegrees(t,i,o),r=GmMap3D.SceneTransforms.wgs84ToWindowCoordinates(a.scene,n);return[r.x,r.y]},t.prototype.JWcoordToC3=function(e){var t=e[0],i=e[1],o=e[2]?e[2]:0,a=this.GetView().scene.globe.ellipsoid,n=GmMap3D.Cartographic.fromDegrees(t,i,o);return a.cartographicToCartesian(n)},t.prototype.cartesianTo2MapCoord=function(e){var t=this.cesium.ellipsoid.cartesianToCartographic(e);return[parseFloat((t.longitude/Math.PI*180).toFixed(6)),parseFloat((t.latitude/Math.PI*180).toFixed(6)),t.height]},t.prototype.rotateCalculate=function(e,t,i,o){var a=new GmMap3D.HeadingPitchRoll(t,i,0),n=GmMap3D.Transforms.headingPitchRollToFixedFrame(e,a,GmMap3D.Ellipsoid.WGS84,GmMap3D.Transforms.eastNorthUpToFixedFrame,new GmMap3D.Matrix4),r=new GmMap3D.Cartesian3(o,0,0);return GmMap3D.Matrix4.multiplyByPoint(n,r,new GmMap3D.Cartesian3)},t.prototype.calculatehp=function(e,t){var i=this.JWcoordToC3(e),o=this.JWcoordToC3(t),a=this.rotateCalculate(i,0,GmMap3D.Math.toRadians(-90),10),n=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(a,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),r=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(o,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),s=GmMap3D.Cartesian3.dot(n,r),l=GmMap3D.Math.toDegrees(Math.acos(s))-90;t[2]=e[2],i=this.JWcoordToC3(e),o=this.JWcoordToC3(t);var p=this.rotateCalculate(i,0,0,10),h=this.rotateCalculate(i,GmMap3D.Math.toRadians(90),0,10),m=this.rotateCalculate(i,GmMap3D.Math.toRadians(-90),0,10),d=GmMap3D.Cartesian3.subtract(o,i,new GmMap3D.Cartesian3),c=0;if(0==d.x&&0==d.y&&0==d.z)c=0;else{r=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(o,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3);var u=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(h,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),y=GmMap3D.Cartesian3.dot(u,r),f=GmMap3D.Math.toDegrees(Math.acos(y)),g=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(m,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),M=GmMap3D.Cartesian3.dot(g,r),G=GmMap3D.Math.toDegrees(Math.acos(M)),v=GmMap3D.Cartesian3.normalize(GmMap3D.Cartesian3.subtract(p,i,new GmMap3D.Cartesian3),new GmMap3D.Cartesian3),w=GmMap3D.Cartesian3.dot(v,r),D=GmMap3D.Math.toDegrees(Math.acos(w));c=G>=f?D:-D}return[c,l]},t.prototype.unshowGlodeBackground=function(e){var t=this.cesium.viewer,i=t.scene.globe.show,o=t.scene.skyAtmosphere.show,a=t.scene.skyBox.show,n=t.scene.sun.show;i&&(t.scene.globe.show=!1),o&&(t.scene.skyAtmosphere.show=!1),a&&(t.scene.skyBox.show=!1),n&&(t.scene.sun.show=!1),e&&(t.scene.backgroundColor=this.colorTransform(e))},t.prototype.showGlodeBackground=function(e){var t=this.cesium.viewer,i=t.scene.globe.show,o=t.scene.skyAtmosphere.show,a=t.scene.skyBox.show,n=t.scene.sun.show;i||(t.scene.globe.show=!0),o||(t.scene.skyAtmosphere.show=!0),a||(t.scene.skyBox.show=!0),n||(t.scene.sun.show=!0),t.scene.backgroundColor=GmMap3D.Color.BLACK},t.prototype.SetCursorStyle=function(e){$("#"+this.divID).css("cursor",e)},t.prototype.Point=function(e,t){return this.cesium.viewer.entities.add({id:t.id,name:t.name||t.id,position:GmMap3D.Cartesian3.fromDegrees(e[0],e[1],e[2]),point:t.style||{pixelSize:t.pixelSize?t.pixelSize:10,color:GmMap3D.Color.RED,outlineColor:GmMap3D.Color.WHITE,outlineWidth:2}})},Map3DSDK.MultiPoint=function(e,t){var o,a=i();if(a){o=[];for(var n=0;n<e.length;n++)0==t?o.push(e[n]):o.push(a.JW2MapCoord(e[n]))}else o=e},Map3DSDK.Line=function(e,t){var o,a=i();if(a){o=[];for(var n=0;n<e.length;n++)0==t?o.push(e[n]):o.push(a.JW2MapCoord(e[n]))}else o=e},Map3DSDK.MultiLine=function(e,t,o){var a;if(i()){a=[];for(var n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)0==t?a.push(parseFloat(e[n][r])):a.push(parseFloat(this.JW2MapCoord(e[n][r])))}else a=e;var s=0;return s=o&&o.width?o.width:5,new GmMap3D.PolylineGeometry({positions:GmMap3D.Cartesian3.fromDegreesArray(a),width:s,vertexFormat:GmMap3D.PolylineColorAppearance.VERTEX_FORMAT})},Map3DSDK.Polygon=function(e,t){for(var i=e,o=[],a=0;a<i.length;a++)for(var n=0;n<i[a].length;n++)0==t?o.push(parseFloat(i[a][n])):o.push(parseFloat(this.JW2MapCoord(i[a][n])));for(a=1;a<e.length;a++);return new GmMap3D.PolygonGeometry({polygonHierarchy:new GmMap3D.PolygonHierarchy(GmMap3D.Cartesian3.fromDegreesArray(o)),height:0})},Map3DSDK.MultiPolygon=function(e){},Map3DSDK.Circle=function(e,t){var i=e.center,o=Map3DSDK.GetMap().GetCegore()._scene.globe._czGlobe._ellipsoid._maximumRadius;t=GmMap3D.Math.toRadians(o*e.radius);return new GmMap3D.CircleGeometry({center:GmMap3D.Cartesian3.fromDegrees(i[0],i[1]),radius:t,height:i[2]||0})},Map3DSDK.GetMap=function(){return this.map3DView},t.prototype.AddGeometrys=function(e,t,i,o,a){var n=this.GetView();a=a||{};var r=[];if("string"==typeof(r=i&&i.color?i.color:[1,1,0,1])){var s=this.colorTransform(r);r=[s.red,s.green,s.blue,s.alpha]}var l=new GmMap3D.GeometryInstance({id:e,geometry:t,asynchronous:!!a.asynchronous&&a.asynchronous,attributes:{color:new GmMap3D.ColorGeometryInstanceAttribute(r[0],r[1],r[2],r[3])}}),p=null;if(t._width)p=new GmMap3D.PolylineColorAppearance({translucent:!1});else{var h=GmMap3D.Material.fromType("Color",{color:new GmMap3D.Color(r[0],r[1],r[2],r[3])});p=new GmMap3D.EllipsoidSurfaceAppearance({material:h,aboveGround:!0})}var m=new GmMap3D.Primitive({geometryInstances:l,appearance:p});n.scene.primitives.add(m)},t.prototype.RemoveGeometrys=function(e){for(var t=this.GetView(),i=t.scene.primitives,o=0;o<i.length;o++){var a=i.get(o);if(a instanceof GmMap3D.Primitive)if(a.getGeometryInstanceAttributes(e)){t.scene.primitives.remove(a);break}}},t.prototype.AddEntity=function(e,t,i,o,a){for(var n=[],r=t[0],s=0;s<r.length;s++)n.push(r[s][0]),n.push(r[s][1]);for(s=1;s<t.length;s++);GmMap3D.Material.fromType("Color",{color:new GmMap3D.Color(1,1,0,.45)});a=a||{};var l=this.GetView(),p=null;p="image"==a.type?new GmMap3D.ImageMaterialProperty({image:a.imgUrl,transparent:a.transparent}):"heatmap"==a.type?a.material:new GmMap3D.Color(1,1,0,.45),l.entities.add({id:e,name:e,polygon:{hierarchy:GmMap3D.Cartesian3.fromDegreesArray(n),extrudedHeight:0,perPositionHeight:!0,material:p,outline:!a.outline||a.outline,outlineColor:GmMap3D.Color.RED}})},t.prototype.getParimitive=function(e){for(var t=this.GetView().scene.primitives._primitives||[],i=0;i<t.length;i++)if(t[i].id&&t[i].id.id==e)return t[i];return null},t.prototype.GetEntity=function(e){if(null==e||""==e)return null;var t=this.GetView().entities.getById(e);return t&&null!=t&&null!=t||(t=null),t},t.prototype.GetEntityByName=function(e){if(null==e||""==e)return null;for(var t=this.GetView().entities.values,i=[],o=0;o<t.length;o++)t[o].name===e&&i.push(t[o]);return i},t.prototype.RemoveEntity=function(e){return this.GetView().entities.removeById(e)},t.prototype.RemoveEntitys=function(e){this.GetView().entities.removeAll()},t.prototype.GetModelByName=function(e){this.GetView();return this.GetEntityByName(e)},t.prototype.GetModelsByName=function(e){var t=this.GetView().entities.values;if(e&&"string"==typeof e){for(var i=[],o=0;o<t.length;o++)t[o].name.indexOf(e)>-1&&i.push(t[o]);return i}return t},t.prototype.GetModelsById=function(e){var t=this.GetView().entities.values;if(e&&"string"==typeof e){for(var i=[],o=0;o<t.length;o++)t[o].id.indexOf(e)>-1&&i.push(t[o]);return i}return t},t.prototype.addPoint=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.addPoint(e,t)},t.prototype.delPoint=function(e){this.zmapGeometry.removeEntity(e)},t.prototype.delPointById=function(e){this.zmapGeometry.removeEntityById(e)},t.prototype.addLine=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.addLine(e,t)},t.prototype.setLineMatrial=function(e,t){var i=e;if(this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),e&&t){"string"==typeof e&&(i=this.GetModelsById(e)[0]);var o=this.zmapGeometry.LineMaterial(t);i.polyline.material=o}},t.prototype.addPolygon=function(e,t){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this);var i=this.zmapGeometry.Addpolygon(e);if(i){var o=i,a=this.GetView().scene;(o.handler=new GmMap3D.ScreenSpaceEventHandler(a.canvas)).setInputAction((function(e){for(var i=a.drillPick(e.position),n=0;n<i.length;n++){if(i[n].id.id==o.id){t&&t(e);break}}}),GmMap3D.ScreenSpaceEventType.LEFT_CLICK)}return i},t.prototype.getPolygonByid=function(e){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getEntity(e)},t.prototype.removePolygon=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntity(e)},t.prototype.removePolygonByid=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntityById(e)},t.prototype.removePolygons=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._polygon&&this.removePolygon(e[t])}},t.prototype.getPolygons=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._polygon&&t.push(e[i])}return existlabels},t.prototype.showPolygon=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.showEntity(e)},t.prototype.unshowPolygon=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.unshowEntity(e)},t.prototype.showPolygonById=function(e){var t=this.getPolygonByid(e);this.showPolygon(t)},t.prototype.unshowPolygonById=function(e){var t=this.getPolygonByid(e);this.unshowPolygon(t)},t.prototype.showPolygons=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._polygon&&this.showPolygon(e[t])}},t.prototype.unshowPolygons=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._polygon&&this.unshowPolygon(e[t])}},t.prototype.getPolygonProperties=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getPolygonProperties(e,t)},t.prototype.setPolygonProperties=function(e,t){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.setPolygonProperties(e,t)},t.prototype.AddTextLabel=function(e,t,i,o,a){var n=null;n=(a=a||{}).height?[t,i,a.height]:[t,i,0],a.position=n,a.id=e,a.dtext=o,this.addTextLabel(a)},t.prototype.addTextLabel=function(e){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.AddTextLabel(e)},t.prototype.getLabelByid=function(e){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getEntity(e)},t.prototype.RemoveLabel=function(e){this.removeLabelByid(e)},t.prototype.removeLabel=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntity(e)},t.prototype.removeLabelByid=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntityById(e)},t.prototype.removeLabels=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._label&&t.push(e[i])}for(i=0;i<t.length;i++)this.removeLabel(t[i])},t.prototype.getLabels=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._label&&t.push(e[i])}return t},t.prototype.showLabel=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.showEntity(e)},t.prototype.unshowLabel=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.unshowEntity(e)},t.prototype.showLabelById=function(e){var t=this.getLabelByid(e);this.showLabel(t)},t.prototype.unshowLabelById=function(e){var t=this.getLabelByid(e);this.unshowLabel(t)},t.prototype.showLabels=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._label&&this.showLabel(e[t])}},t.prototype.unshowLabels=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._label&&this.unshowLabel(e[t])}},t.prototype.getTextLabelProperties=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getTextProperties(e,t)},t.prototype.setTextLabelProperties=function(e,t){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.setTextProperties(e,t)},t.prototype.addImage=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.addbillboard(e)},t.prototype.AddImageLabel=function(e,t,i,o,a){var n=this.GetView().entities.getById(e);this.removeImage(n);var r=null;r=(a=a||{}).height?[t,i,a.height]:[t,i,0],a.position=r,a.id=e,a.imageUrl=o,this.addImage(a)},t.prototype.getImageByid=function(e){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getEntity(e)},t.prototype.removeImage=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntity(e)},t.prototype.removeImageByid=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.removeEntityById(e)},t.prototype.removeImages=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._billboard&&t.push(e[i])}for(i=0;i<t.length;i++)this.removeImage(t[i])},t.prototype.getImages=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._billboard&&t.push(e[i])}},t.prototype.showImage=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.showEntity(e)},t.prototype.unshowImage=function(e){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.unshowEntity(e)},t.prototype.showImageById=function(e){var t=this.getImageByid(e);this.showImage(t)},t.prototype.unshowImageById=function(e){var t=this.getImageByid(e);this.unshowImage(t)},t.prototype.showImages=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._billboard&&this.showImage(e[t])}},t.prototype.unshowImages=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._billboard&&this.unshowImage(e[t])}},t.prototype.getImageProperties=function(e,t){return this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.getbillboardProperties(e,t)},t.prototype.setImageProperties=function(e,t){this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(this),this.zmapGeometry.setbillboardProperties(e,t)},t.prototype.AddControl=function(e){this.controls[e.name]=e.element},t.prototype.RemoveControl=function(e){if(e){var t=!1;for(var i in this.controls){var o=this.controls[i];if(o===e.element){t=!0,o.remove(),delete this.controls[i];break}}return t}},t.prototype.RemoveAllControl=function(){for(var e in this.controls){var t=this.controls[control.name];document.removeChild(t)}this.controls={}},t.prototype.AddCustomControl=function(e,t,i,o,a,n,r,s){var l=document.getElementById(e);null==l&&(l=document.createElement("button")),l.id=e,l.innerHTML=r,l.title=e,l.addEventListener("click",s,!1),l.addEventListener("touchstart",s,!1),t&&(l.style.backgroundColor=t),l.style.width="calc(100% - 0.1em)",l.style.height="calc(100% - 0.1em)";var p=document.createElement("div");if(p){p.className="gmap-custom-control3D",p.style.left=i+"px",p.style.top=o+"px",p.style.width=a+"px",p.style.height=n+"px",p.appendChild(l),document.body.appendChild(p);var h={};h.name=e,h.element=p,this.AddControl(h)}return h},t.prototype.RemoveCustomControl=function(e){var t=this.controls[control.name];document.removeChild(t),delete this.controls[control.name]},t.prototype.AddEventListener=function(e,t,i){var o;switch(e){case"click":o=GmMap3D.ScreenSpaceEventType.LEFT_CLICK;break;case"dblclick":o=GmMap3D.ScreenSpaceEventType.LEFT_DOUBLE_CLICK;break;case"mousemove":o=GmMap3D.ScreenSpaceEventType.MOUSE_MOVE;break;case"leftDown":o=GmMap3D.ScreenSpaceEventType.LEFT_DOWN;break;case"leftup":o=GmMap3D.ScreenSpaceEventType.LEFT_UP;break;case"wheel":o=GmMap3D.ScreenSpaceEventType.WHEEL;break;case"rclick":o=GmMap3D.ScreenSpaceEventType.RIGHT_CLICK;break;default:o=e}this.cesium;var a=new GmMap3D.ScreenSpaceEventHandler(this.cegore.canvas);return a.setInputAction((function(e){t&&t(e)}),o,i),a},t.prototype.RemoveEventListener=function(e){return e.destroy()},t.prototype.cameraChanged=function(e){return this.GetView().scene.camera.percentageChanged=.1,this.GetView().scene.camera.changed.addEventListener(e)},t.prototype.cameraMoveStart=function(e){return this.GetView().scene.camera.moveStart.addEventListener(e)},t.prototype.cameraMoveEnd=function(e){return this.GetView().scene.camera.moveEnd.addEventListener(e)},t.prototype.senecPostRender=function(e){return this.GetView().scene.postRender.addEventListener(e)},t.prototype.senecPostUpdate=function(e){return this.GetView().scene.postUpdate.addEventListener(e)},t.prototype.senecPreRender=function(e){return this.GetView().scene.preRender.addEventListener(e)},t.prototype.senecPreUpdate=function(e){return this.GetView().scene.preUpdate.addEventListener(e)},t.prototype.useWebVR=function(e){this.GetView().scene.useWebVR=1==e},t.prototype.IsEnableDragging=function(){return this.GetView().scene.screenSpaceCameraController.enableTranslate},t.prototype.EnableDragging=function(e){this.GetView().scene.screenSpaceCameraController.enableTranslate=e},t.prototype.IsEnableWheel=function(){return this.GetView().scene.screenSpaceCameraController.enableZoom},t.prototype.EnableWheel=function(e){this.GetView().scene.screenSpaceCameraController.enableZoom=e},t.prototype.IsEnableKeyboardPan=function(){return this.GetView().scene.screenSpaceCameraController.enableTranslate},t.prototype.EnableKeyboardPan=function(e){return this.GetView().scene.screenSpaceCameraController.enableTranslate=e},t.prototype.IsEnableKeyboardZoom=function(){return this.GetView().scene.screenSpaceCameraController.enableZoom},t.prototype.EnableKeyboardZoom=function(e){this.GetView().scene.screenSpaceCameraController.enableZoom=e},t.prototype.IsEnableRotate=function(){return this.GetView().scene.screenSpaceCameraController.enableRotate},t.prototype.EnableRotate=function(e){this.GetView().scene.screenSpaceCameraController.enableRotate=e},t.prototype.IsEnableTilt=function(){return this.GetView().scene.screenSpaceCameraController.enableTilt},t.prototype.EnableTilt=function(e){this.GetView().scene.screenSpaceCameraController.enableTilt=e},t.prototype.IsEnableLook=function(){return this.GetView().scene.screenSpaceCameraController.enableLook},t.prototype.EnableLook=function(e){this.GetView().scene.screenSpaceCameraController.enableLook=e},t.prototype.IsInputActive=function(e){return this.GetView().scene.screenSpaceCameraController.enableZoom},t.prototype.EnableInput=function(e){this.GetView().scene.screenSpaceCameraController.enableInputs=e},t.prototype.AddSingleImage=function(e){var t=e.name?e.name:"testE",i=e.url?e.url:"image/entity.jpg",o=e.polygon?e.polygon:[[[109.080842,25.002073],[105.91517,25.002073],[104.058488,24.996596],[104.053011,23.002989],[104.053011,21.003906],[105.728954,20.998429],[107.919731,21.003906],[109.04798,20.998429],[111.047063,20.998429],[111.047063,22.000709],[111.047063,24.476286],[111.05254,25.002073]]],a={type:"image",imgUrl:i,transparent:!!e.transparent&&e.transparent};this.AddEntity(t,o,void 0,void 0,a)},t.prototype.RemoveSingImage=function(e){e=e;this.RemoveEntity(e)},Map3DSDK.InfoWindow=function(e,t,i){e[2]||(e[2]=0),this.InfoWindowPoint=e,this.InfoWindowSite=i,this.divid=i.divid?i.divid:"trackPopUp";var o='<div id="'+this.divid+'" style="display:block;"><div id="'+this.divid+'Content" class="leaflet-popup" style="top:5px;left:0;"><a class="leaflet-popup-close-button" data_id ="'+this.divid+'" href="#">×</a><div class="leaflet-popup-content-wrapper"><div id="'+this.divid+'Link" class="leaflet-popup-content" style="max-width: 300px;"></div></div><div class="leaflet-popup-tip-container"><div class="leaflet-popup-tip"></div></div></div></div>';$("#"+i.viewer.divID).append(o),$(".cesium-selection-wrapper").show(),$("#"+this.divid+"Link").empty(),$("#"+this.divid+"Link").append(t);var a=i.viewer.MapCoord2Screen([parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]),n=new GmMap3D.Cartesian2(parseFloat(a[0]),parseFloat(a[1]));h(n,i),$("#"+this.divid).hide(),this.viewer=i.viewer;i.viewer;var r=i.viewer.GetCesium().viewer,s=r.scene,l=this,p=s.postRender.addEventListener((function(){var e;e=GmMap3D.Cartesian3.fromDegrees(parseFloat(l.InfoWindowPoint[0]),parseFloat(l.InfoWindowPoint[1]),parseFloat(l.InfoWindowPoint[2]));try{var t=GmMap3D.SceneTransforms.wgs84ToWindowCoordinates(r.scene,e);t=new GmMap3D.Cartesian2(parseFloat(t.x),parseFloat(t.y)),n.x===t.x&&n.y===t.y||(h(t,l.InfoWindowSite),n=t)}catch(e){}}));function h(e,t){var i=t;i&&null!=i?(i.xoffset||(i.xoffset=0),i.yoffset||(i.yoffset=0),i.positioning||(i.positioning="bottom-center")):i={xoffset:0,yoffset:0,positioning:"bottom-center"};var o=i.positioning,a=0,n=0;n=o.indexOf("top")>0?e.y+2+i.yoffset:e.y-$("#"+i.divid+"Content").height()+2+i.yoffset,a=o.indexOf("left")>0?e.x+0+i.xoffset:o.indexOf("right")>0?e.x-$("#"+i.divid+"Content").width()+0+i.xoffset:e.x-$("#"+i.divid+"Content").width()/2+0+i.xoffset,$("#"+i.divid+"Content").css("transform","translate3d("+a+"px, "+n+"px, 0)")}return this.addHandler=p,$(".leaflet-popup-close-button").click((function(){var e=$(this).attr("data_id");return $("#"+e).hide(),$("#"+e+"Link").empty(),$(".cesium-selection-wrapper").hide(),p.call(),!1})),this},Map3DSDK.InfoWindow.prototype.SetContent=function(e){var t=this.InfoWindowSite;$("#"+t.divid+"Link").empty(),$("#"+t.divid+"Link").append(e)},Map3DSDK.InfoWindow.prototype.SetPosition=function(e){e[2]||(e[2]=0);var t=this.viewer.MapCoord2Screen([parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]),i=new GmMap3D.Cartesian2(parseFloat(t[0]),parseFloat(t[1]));this.InfoWindowPoint=e;var o=this.InfoWindowSite;o&&null!=o?(o.xoffset||(o.xoffset=0),o.yoffset||(o.yoffset=0),o.positioning||(o.positioning="bottom-center")):o={xoffset:0,yoffset:0,positioning:"bottom-center"};var a=o.positioning,n=0,r=0;r=a.indexOf("top")>0?i.y+2+o.yoffset:i.y-$("#"+o.divid+"Content").height()+2+o.yoffset,n=a.indexOf("left")>0?i.x+0+o.xoffset:a.indexOf("right")>0?i.x-$("#"+o.divid+"Content").width()+0+o.xoffset:i.x-$("#"+o.divid+"Content").width()/2+0+o.xoffset,$("#"+o.divid+"Content").css("transform","translate3d("+n+"px, "+r+"px, 0)")},t.prototype.OpenInfoWindow=function(e){$("#"+e.divid).show()},t.prototype.UpdatePosition=function(e,t){e&&e.SetPosition(t)},t.prototype.CloseInfoWindow=function(e){$("#"+e.divid).hide(),$("#"+e.divid).remove(),e.addHandler(),e={}},t.prototype.AddModel=function(e,t,i,o,a){var n=ZMAP3D.clone(t,!0),r=this.GetModel(e);return null==r&&null==r||this.RemoveModel(e),this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),n.modelid=e,n.drotate?n.drotate=[n.drotate[0],n.drotate[1],n.drotate[2]]:n.drotate=[0,0,0],this.zmapGltf.addModel(n,i,o,a)},t.prototype.GetModel=function(e){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.getModel(e)},t.prototype.GetModels=function(){for(var e=this.GetView().entities._entities._array,t=[],i=0;i<e.length;i++){e[i]._model&&t.push(e[i])}return t},t.prototype.showModelByid=function(e){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.showModel(e)},t.prototype.unshowModelByid=function(e){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.unshowModel(e)},t.prototype.showModel=function(e){this.GetView().entities.contains(e)&&(e.show=!0)},t.prototype.unshowModel=function(e){this.GetView().entities.contains(e)&&(e.show=!1)},t.prototype.showModels=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._model&&this.showModel(e[t])}},t.prototype.unshowModels=function(){for(var e=this.GetView().entities._entities._array,t=0;t<e.length;t++){e[t]._model&&this.unshowModel(e[t])}},t.prototype.removeModelByid=function(e,t){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),t||null==t?(this.RemoveLoadTask(e),this.zmapGltf.removeModelById(e)):this.removeModelsByid(e)},t.prototype.removeModel=function(e){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.removeModel(e)},t.prototype.removeModelsByid=function(e){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.RemoveLoadTask(e);for(var t=this.GetModels(),i=0;i<t.length;i++)this.removeModel(t[i])},t.prototype.RemoveModel=function(e){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.removeModelByid(e)},t.prototype.RemoveLoadTask=function(e){var t=this.taskLoadMap[e];t&&(t.cancle(),delete this.taskLoadMap[e])},t.prototype.RemoveAllLoadTask=function(e){for(var t in this.taskLoadMap)delete this.taskLoadMap[t]},t.prototype.removeModels=function(){for(var e=this.GetView().entities._entities._array,t=this,i=[],o=0;o<e.length;o++){e[o].model&&i.push(e[o].id)}i.map((function(e){t.removeModelByid(e)}))},t.prototype.RotateModelByid=function(e,t,i){var o=this.GetModel(e);this.RotateNewModel(o,t,i)},t.prototype.RotateNewModel=function(e,t,i){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.changeOrientation(e,t,i)},t.prototype.RotateModel=function(e,t){this.RotateModelByid(e,t)},t.prototype.changePositionModelByid=function(e,t,i){var o=this.GetModel(e),a=!0;a=i||!1,this.changePositionModel(o,t,a)},t.prototype.changePositionModel=function(e,t,i){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this);var o=!0;o=i||!1,this.zmapGltf.changePosition(e,t,o)},t.prototype.getPositionModelByid=function(e,t){var i=this.GetModel(e);return this.getPositionModel(i,t)},t.prototype.getPositionModel=function(e,t){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.getModelPosition(e,t)},t.prototype.changeColorModelByid=function(e,t){var i=this.GetModel(e);this.changeColorModel(i,t)},t.prototype.changeColorModel=function(e,t){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.changeColor(e,t)},t.prototype.getColorModelByid=function(e){var t=this.GetModel(e);return this.getColorModel(t)},t.prototype.getColorModel=function(e){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.getModelcolor(e)},t.prototype.changeScaleModelByid=function(e,t){var i=this.GetModel(e);this.changeScaleModel(i,t)},t.prototype.changeScaleModel=function(e,t){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.changeScale(e,t)},t.prototype.getScaleModelByid=function(e){var t=this.GetModel(e);return this.getScaleModel(t)},t.prototype.getScaleModel=function(e){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.getModelScale(e)},t.prototype.dynamicRotateModel=function(e,t){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),new ZMAPGLTF.rotateModel(this.GetView(),e,t)},t.prototype.singeldynamicRotateModel=function(e,t,i){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),new ZMAPGLTF.singelMoveAndrotateModel(this.zmapGltf,e,t,i)},t.prototype.shieldMachineMoveAndrotateModel=function(e,t,i){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),new ZMAPGLTF.shieldMachineMoveAndrotateModel(this.zmapGltf,e,t,i)},t.prototype.shieldMachinejumpAndrotateModel=function(e,t,i){return this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),new ZMAPGLTF.shieldMachinejumpAndrotateModel(this.zmapGltf,e,t,i)},t.prototype.lookatModel=function(e,t){this.zmapGltf=this.zmapGltf||new ZMAPGLTF(this),this.zmapGltf.lookModel(e,t)},t.prototype.urlTransform=function(e,t){var i=e.id;if(i){var o=e.url;if(o){var a=e.longlat,n=e.single,r=e.single;this.addZmapModel(i,o,a,n,r,t,{ifFlyTo:e.ifFlyTo||!1})}}};var o=function(e){this.url=e};o.prototype={constructor:o,then:function(t){return $.ajax({url:url,success:function(i){t(e)},error:function(e){}}),this}};var a=function(){this.id=null,this.iscancle="false"};a.prototype={constructor:a,cancle:function(){this.iscancle="true"},request:function(e,t,i,o,a,n,r,s,l){this.id=i;var p=e.GetView();if(o.indexOf("/zs/zfcls")>-1){function h(a,l,p,h){null!=a&&fetch(o+"/model/group/"+a.join(",")).then((function(e){return e.arrayBuffer()})).then((function(o){"true"!=h.iscancle&&function(o,a,l,p){for(var h=new Uint32Array(o),m=h[0],d=h[1],c=h[2],u=0;u<m;++u){var y=l[a[u]],f=(d=h[2*u+3],c=h[2*u+4],URL.createObjectURL(new Blob([o.slice(d,d+c)]))),g={modelid:i+"-"+y.id,name:y.name||y.id,drotate:[0,0,0],position:p,center:y.center,initq:t,url:f,show:r,dcolor:GmMap3D.Color.WHITE,dscale:1,dcolorBlendMode:GmMap3D.ColorBlendMode.HIGHLIGHT,dcolorBlendAmount:.5};"function"==typeof s&&(g=s(g)||g),r&&!n&&e.GetModel(g.modelid)&&e.RemoveModel(g.modelid);e.AddModel(g.modelid,g)}}(o,a,l,p)}))}if(this.zmapGltf=this.zmapGltf||new ZMAPGLTF(e),n)$.ajax({url:o+"/info",datatype:"json",success:function(n){var l=n.position.split(",");3==l.length?(l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),l[2]=parseFloat(l[2])):l=a;var h={modelid:i,name:i,drotate:[90,0,0],initq:t,position:l,url:o+"/model/0/"+n.offset,dcolor:GmMap3D.Color.WHITE,show:r,dscale:1,dcolorBlendMode:GmMap3D.ColorBlendMode.HIGHLIGHT,dcolorBlendAmount:.5};"function"==typeof s&&(h=s(h)||h),r&&e.zmapGltf.getModel(h.modelid)&&e.zmapGltf.removeModelById(h.modelid);e.zmapGltf.addModel(h);p.camera.flyTo({destination:GmMap3D.Cartesian3.fromDegrees(parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])+1e3)})}});else{var m=this;fetch(o+"/model/pg/2000000").then((function(e){return e.json()})).then((function(e){if("true"!=m.iscancle){var n=function(e){var n=e,r=n.position.split(",");3==r.length&&(r[0]=parseFloat(r[0]),r[1]=parseFloat(r[1]),r[2]=parseFloat(r[2])),!a||!Array.isArray(a)||3!=a.length||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||(r=a);var h={modelid:i,name:n.name||i,drotate:[0,0,0],position:r,initq:t,center:n.center,url:o+"/model/0/"+n.offset,dcolor:GmMap3D.Color.WHITE,dscale:1,dcolorBlendMode:GmMap3D.ColorBlendMode.HIGHLIGHT,dcolorBlendAmount:.5};return"function"==typeof s&&(h=s(h)||h),0!=l.ifFlyTo&&p.camera.flyTo({destination:GmMap3D.Cartesian3.fromDegrees(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])+l.distance||1500)}),r}(e.tree),r={};!function e(t,i){for(var o=0;o<t.length;++o){var a=t[o];a.complex?e(a.children,i):i[a.id]=a}}(e.tree.children,r);for(var d=0;d<e.groups.length;++d)h(e.groups[d],r,n,m)}}))}}else if(o.indexOf("/zs/obj")>-1)this.zmapGltf=this.zmapGltf||new ZMAPGLTF(e),$.ajax({url:o+"/files/zmapgltf.json",datatype:"json",success:function(t){var n=(t=JSON.parse(t)).position.split(",");if(3==n.length&&(n[0]=parseFloat(n[0]),n[1]=parseFloat(n[1]),n[2]=parseFloat(n[2])),!a||!Array.isArray(a)||3!=a.length||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||(n=a),Array.isArray(t.children))for(var h=0;h<t.children.length;h++){var m={modelid:t.children[h].id||i+"-"+t.children[h].url.replace(".gltf",""),name:t.children[h].name||i+"-"+h,drotate:[0,0,0],position:n,url:o+"/files/"+t.children[h].url,dcolor:GmMap3D.Color.WHITE,dscale:1,show:r,colorBlendMode:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:.5};"function"==typeof s&&(m=s(m)||m),r&&e.GetModel(m.modelid)&&e.RemoveModel(m.modelid);e.AddModel(m.modelid,m)}0!=l.ifFlyTo&&p.camera.flyTo({destination:GmMap3D.Cartesian3.fromDegrees(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])+l.distance||1500)})}});else if(o.indexOf("/zs/osg")>-1||o.indexOf("/zs/ifc")>-1||o.indexOf("/zs/3dtiles")>-1)this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(e),$.ajax({url:o.replace("osg","data").replace("ifc","data").replace("3dtiles","data")+"?f=json",type:"post",datatype:"json",success:function(t){var n=[parseFloat(t.attributes.X),parseFloat(t.attributes.Y),parseFloat(t.attributes.Z)];!a||!Array.isArray(a)||3!=a.length||isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||(n=a);var p={modelid:i,position:n,url:o+"/files/3dtiles.json",fskipScreenSpaceErrorFactor:16,fskipLevels:7};if((isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))&&delete p.position,"function"==typeof s&&(p=s(p)||p),r){e.get3dTilesById(p.modelid)&&e.deleteTilesById(p.modelid);e.add3dTiles(p,0!=l.ifFlyTo)}}});else if(o.indexOf("/zs/dot")>-1){function d(t){$.ajax({url:o+"/info?f=json",dataType:"json",success:function(o){for(var a=o.data,n=!0,p=0;p<a.length;p++){var h=a[p].ID||p,m=parseFloat(a[p].X),d=parseFloat(a[p].Y),c=parseFloat(a[p].Z);if(!(isNaN(m)||isNaN(d)||isNaN(c)))if(n&&(0!=l.ifFlyTo&&e.setCamera({position:[m,d,c+l.distance||1500],rotate:[0,-90,0]}),n=!1),t){var u={modelid:i+"-"+h,name:h,drotate:[0,0,0],position:[m,d,c],url:t,dcolor:GmMap3D.Color.WHITE,dscale:1,colorBlendMode:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:.5};if("function"==typeof s&&(u=s(u)||u),r){e.GetModel(u.modelid)&&e.RemoveModel(u.modelid);e.AddModel(u.modelid,u)}}else{u={id:i+"-"+h,name:h,position:[m,d,c],dcolor:"red",dpixelSize:10};"function"==typeof s&&(u=s(u)||u),r&&(e.zmapGeometry.getModel(u.id)&&e.zmapGeometry.removeEntityById(u.id),e.zmapGeometry.addPoint(u))}}},error:function(e){}})}this.zmapGeometry=this.zmapGeometry||new ZMAPGEOMETRY(e),$.ajax({url:o.replace("dot","data")+"?f=json",dataType:"json",success:function(e){var t=e.attributes.modelUrl;t&&""!=t&&t.indexOf("/zs/")>-1?$.ajax({url:t+"/files/zmapgltf.json",datatype:"json",success:function(e){(e=JSON.parse(e)).children&&Array.isArray(e.children)&&e.children.length>0?d(t+"/files/"+e.children[0].url):d()},error:function(){d()}}):d()}})}}},t.prototype.addZmapModel=function(e,t,i,o,n,r,s){s=s||{};var l=this._initq;this.taskLoadMap[e]=new a,this.taskLoadMap[e].request(this,l,e,t,i,o,n,r,s)},t.prototype.lookatLockedModelEx=function(e,t,i){var o=this.GetView(),a=e,n=0,r=null,s=!0;if("string"==typeof e&&(this.zmapGltf?a=this.GetModel(e):this.zmap3DTiles&&(a=this.get3dTilesById(e),s=!1)),a){if(a._id&&(s=!0),s){for(var l=o.scene.primitives._primitives,p=null,h=0;h<l.length;h++){var m=l[h];if(m.id&&m.id._id===a._id){p=m;break}}n=p._scaledBoundingSphere.radius,r=a._position._value}else r=a._root._boundingVolume._boundingSphere.center,n=a._root._boundingVolume._boundingSphere.radius;a&&(o.trackedEntity=a,this.lookatLockedModelFlool(r,t,n,i),o.trackedEntity=null)}},t.prototype.assignloockat=function(e,t){if(!t)return e;switch(Number(t)){case 1:e[1]=90;break;case 2:var i=Number(e[0])+180;i<=180?e[0]=i:i>180&&i<360&&(e[0]=360-i);break;case 3:e[0]=Number(e[0])+90;break;case 4:e[0]=Number(e[0])-90}return e},t.prototype.lookatLockedModelFlool=function(e,t,i,o){var a=5*i;o&&(a=o);var n=this.deviationCalculate(e,GmMap3D.Math.toRadians(t[0]),GmMap3D.Math.toRadians(t[1]),a),r=this.cartesianTo2MapCoord(n);r[2]=Math.abs(r[2]);var s=this.JWcoordToC3(r);this.calculatehp(this.cartesianTo2MapCoord(s),this.cartesianTo2MapCoord(e)),this.cartesianTo2MapCoord(s);cpositon1=GmMap3D.Cartographic.fromCartesian(s),cpositon2=GmMap3D.Cartographic.fromCartesian(e),this.GetCegore().camera.lookAtFromTo(cpositon1,cpositon2)},t.prototype.lookatLockedModel=function(e,t,i){this.lookatLockedModelEx(e,t,i)},t.prototype.lockedModel=function(e){e&&(this.GetView().trackedEntity=e)},t.prototype.unLockModel=function(){this.GetView().trackedEntity=null},t.prototype.getColorBlendMode=function(e){return GmMap3D.ColorBlendMode[e.toUpperCase()]},t.prototype.getColor=function(e,t){var i=GmMap3D.Color[e.toUpperCase()];return GmMap3D.Color.fromAlpha(i,parseFloat(t))},t.prototype.PickModel=function(e){var t=this.GetCegore(),i=(t=this.GetView()).scene,o={},a={x:parseFloat(e.x),y:parseFloat(e.y)},n=i.pick(a);if(i.pickPositionSupported&&GmMap3D.defined(n)&&n.primitive){var r=t.scene.pickPosition(a);if(GmMap3D.defined(r)){var s=GmMap3D.Cartographic.fromCartesian(r),l=GmMap3D.Math.toDegrees(s.longitude),p=GmMap3D.Math.toDegrees(s.latitude),h=s.height;o.coord={x:l.toFixed(6),y:p.toFixed(6),z:h.toFixed(6)}}}else{var m=t.camera.getPickRay(a);r=t.scene.globe.pick(m,i);if(GmMap3D.defined(r)){s=GmMap3D.Cartographic.fromCartesian(r),l=GmMap3D.Math.toDegrees(s.longitude),p=GmMap3D.Math.toDegrees(s.latitude);o.coord={x:l.toFixed(6),y:p.toFixed(6),z:s.height.toFixed(6)}}}return o.models=n,o},t.prototype.add3dTiles=function(e,t,i){return this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.add3dTiles(e,t,i)},t.prototype.get3dTilesById=function(e){return this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.get3dTilesById(e)},t.prototype.deleteTilesById=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.deleteTilesById(e)},t.prototype.showTiles=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.show(e)},t.prototype.unshowTiles=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshow(e)},t.prototype.showAllTiles=function(){for(var e in this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.tileslist)this.showTiles(this.zmap3DTiles.tileslist[e])},t.prototype.unshowAllTiles=function(){for(var e in this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.tileslist)this.unshowTiles(this.zmap3DTiles.tileslist[e])},t.prototype.getAllTiles=function(){return this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.tileslist},t.prototype.removeTiles=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.deletedTiles(e)},t.prototype.removeAllTiles=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this);var t=Object.keys(this.zmap3DTiles.tileslist);for(var i in t)this.deleteTilesById(t[i])},t.prototype.show3dTilesModelUrl=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugShowUrl(e)},t.prototype.unshow3dTilesModelUrl=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugShowUrl(e)},t.prototype.show3dTilesModelMemoryUsage=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugShowMemoryUsage(e)},t.prototype.unshow3dTilesModelMemoryUsage=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugShowMemoryUsage(e)},t.prototype.show3dTilesModelRenderingStatistics=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugShowRenderingStatistics(e)},t.prototype.unshow3dTilesModelRenderingStatistics=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugShowRenderingStatistics(e)},t.prototype.show3dTilesModelContentBoundingVolume=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugShowContentBoundingVolume(e)},t.prototype.unshow3dTilesModelContentBoundingVolume=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugShowContentBoundingVolume(e)},t.prototype.show3dTilesModelBoundingVolume=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugShowBoundingVolume(e)},t.prototype.unshow3dTilesModelBoundingVolume=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugShowBoundingVolume(e)},t.prototype.show3dTilesModelWireframe=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugWireframe(e)},t.prototype.unshow3dTilesModelWireframe=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugWireframe(e)},t.prototype.tilesModelRandomColor=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.showDebugColorizeTiles(e)},t.prototype.untilesModelRandomColor=function(e){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.unshowDebugColorizeTiles(e)},t.prototype.tilesModelColorByHeight=function(e,t){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.colorByHeight(e,t)},t.prototype.tilesModelcolorByLatitudeDefine=function(e,t){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.colorByLatitudeDefine(e,t)},t.prototype.tilesModelcolorByLongitudeDefined=function(e,t){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.colorByLongitudeDefined(e,t)},t.prototype.tilesModelcolorByDistance=function(e,t,i){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.colorByDistance(e,t,i)},t.prototype.tilesModelcolorByNameRegex=function(e,t){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.colorByNameRegex(e,t)},t.prototype.tilesModelhideByHeight=function(e,t){this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.hideByHeight(e,t)},t.prototype.get3dtilesModelStyle=function(e){return this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.getTilesStyle(e)},t.prototype.remove3dtilesModelStyle=function(e){return this.zmap3DTiles=this.zmap3DTiles||new ZMAP3DTILES(this),this.zmap3DTiles.removeTilesStyle(e)},t.prototype.createDnyLinePoints=function(e,t,i){var o=[];lat1=Math.PI/180*e[1],lat2=Math.PI/180*t[1],lon1=Math.PI/180*e[0],lon2=Math.PI/180*t[0];var a=Math.cos(lat1)*Math.cos(lat2)*Math.cos(lon1-lon2)+Math.sin(lat1)*Math.sin(lat2);a>1&&(a=1),a<-1&&(a=-1);var n=Math.acos(a),r=Math.sin(lon2-lon1)*Math.cos(lat2),s=Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);azi=Math.atan2(r,s);for(var l=0;l<=100;++l){var p=.02*l,h=6378137*(2*p-p*p)*i;if(0===l)o.push(e[0]),o.push(e[1]),o.push(h);else if(100===l)o.push(t[0]),o.push(t[1]),o.push(h);else{var m=Math.sin(lat1),d=Math.cos(lat1),c=Math.sin(.01*n*l),u=Math.cos(.01*n*l),y=Math.sin(azi),f=Math.cos(azi),g=Math.asin(m*u+d*c*f),M=lon1+Math.atan2(y*c*d,u-m*Math.sin(g));o.push(180*M/Math.PI),o.push(180*g/Math.PI),o.push(h)}}return o},t.prototype.createDnyLine=function(e){var t=this.GetView(),i=this.createDnyLinePoints(e.stponit,e.enpoint,e.heightRatio);if(e.flymove){var o=new PolylineDynMaterialProperty({color:e.bottomColor,color2:e.flyColor,lineLength:1,lineSpeed:1});t.entities.add({name:"Glowing blue line on the surface",polyline:{positions:GmMap3D.Cartesian3.fromDegreesArrayHeights(i),width:e.linewidth?e.linewidth:3,material:o,shadows:GmMap3D.ShadowMode.ENABLED,followSurface:!1}});this.cesium.scene.preRender.addEventListener((function(e){o.update(.01)}))}else t.entities.add({name:"Glowing blue line on the surface",polyline:{positions:GmMap3D.Cartesian3.fromDegreesArrayHeights(i),width:e.linewidth?e.linewidth:3,material:e.noflycolor,shadows:GmMap3D.ShadowMode.ENABLED,followSurface:!1}})},t.prototype.caldistancejw=function(e,t){lat1=Math.PI/180*e[1],lat2=Math.PI/180*t[1],lon1=Math.PI/180*e[0],lon2=Math.PI/180*t[0];var i=Math.cos(lat1)*Math.cos(lat2)*Math.cos(lon1-lon2)+Math.sin(lat1)*Math.sin(lat2);return i>1&&(i=1),i<-1&&(i=-1),6378137*Math.acos(i)},t.prototype.setDepthTestAgainstTerrain=function(e){this.GetView().scene.globe.depthTestAgainstTerrain=e},t.prototype.getDepthTestAgainstTerrain=function(){return this.GetView().scene.globe.depthTestAgainstTerrain},t.prototype.setPickTranslucentDepth=function(e){this.GetView().scene.pickTranslucentDepth=e},t.prototype.getPickTranslucentDepth=function(){return this.GetView().scene.pickTranslucentDepth},t.prototype.unshowClippingPlanes=function(){this.GetView().scene.globe.clippingPlanes&&this.GetView().scene.globe.clippingPlanes.removeAll&&this.GetView().scene.globe.clippingPlanes.removeAll(),this.setDepthTestAgainstTerrain(!1),this.GetEntity("cuttingWall")&&(this.RemoveEntity("cuttingWall"),this.RemoveEntity("cuttingUnderside"))},t.prototype.showClippingPlanes=function(e){if(e.positions&&Array.isArray(e.positions)&&e.positions.length>2){for(var t=[],i=0,o=0;o<e.positions.length;o++){var a=GmMap3D.Cartesian3.fromDegrees(parseFloat(e.positions[o][0]),parseFloat(e.positions[o][1]),parseFloat(e.positions[o][2]));a&&t.push(a);var n=e.positions,r=(o+1)%e.positions.length;i+=-.5*(n[r][1]+n[o][1])*(n[r][0]-n[o][0])}this.GetView().scene.globe.clippingPlanes&&this.GetView().scene.globe.clippingPlanes.removeAll&&this.GetView().scene.globe.clippingPlanes.removeAll();for(var s=this.GetView(),l=[],p=[],h=t.length,m=(new GmMap3D.Cartesian3,0);m<h;++m){var d=(m+1)%h,c=GmMap3D.Cartesian3.midpoint(t[m],t[d],new GmMap3D.Cartesian3);l.push(t[m]),l.push(c);var u,y=GmMap3D.Cartesian3.normalize(c,new GmMap3D.Cartesian3);u=i<0?GmMap3D.Cartesian3.subtract(t[m],t[d],new GmMap3D.Cartesian3):GmMap3D.Cartesian3.subtract(t[d],t[m],new GmMap3D.Cartesian3),u=GmMap3D.Cartesian3.normalize(u,u);var f=GmMap3D.Cartesian3.cross(u,y,new GmMap3D.Cartesian3);f=GmMap3D.Cartesian3.normalize(f,f);var g=new GmMap3D.Plane(f,0),M=GmMap3D.Plane.getPointDistance(g,c);p.push(new GmMap3D.ClippingPlane(f,M))}this.setDepthTestAgainstTerrain(!0),this.setPickTranslucentDepth(!0),s.scene.globe.clippingPlanes=new GmMap3D.ClippingPlaneCollection({planes:p,edgeWidth:1,edgeColor:GmMap3D.Color.WHITE,enabled:!0}),1!=e.noWall&&this.addClippingImageMaterial(e)}else console.log("切割坐标输入错误!")},t.prototype.addClippingImageMaterial=function(e){for(var t=this.GetView(),i=[],o=[],a=[],n=[],r=0;r<e.positions.length;r++){var s=GmMap3D.Cartesian3.fromDegrees(parseFloat(e.positions[r][0]),parseFloat(e.positions[r][1]),parseFloat(e.positions[r][2])),l=e.positions[r][2],p=parseFloat(e.height||-100),h=GmMap3D.Cartesian3.fromDegrees(parseFloat(e.positions[r][0]),parseFloat(e.positions[r][1]),p);s&&h&&(i.push(s),n.push(h),o.push(l),a.push(p))}i.push(i[0]),a.push(a[0]),o.push(o[0]);var m=this.GetEntity("cuttingWall"),d=this.GetEntity("cuttingUnderside");m?m.wall.positions.setValue(i):t.entities.add({id:"cuttingWall",name:"挖地四周墙",wall:{positions:i,maximumHeights:o,minimumHeights:a,material:e.wallMaterial||new GmMap3D.ImageMaterialProperty({image:"images/excavationregion_top.jpg",repeat:new GmMap3D.Cartesian2(10,30)})}}),d?d.polygon.hierarchy.setValue(n):t.entities.add({id:"cuttingUnderside",name:"挖地底面",polygon:{hierarchy:n,perPositionHeight:!0,material:e.undersideMaterial||new GmMap3D.ImageMaterialProperty({image:"images/excavationregion_side.jpg",repeat:new GmMap3D.Cartesian2(10,10)})}})},t.prototype.autoClippingPlanes=function(e,t,i){var o=parseFloat(e),a=parseFloat(t);if(isNaN(o)||isNaN(a))console.log("自动裁切地形参数错误!");else{var n=this.getCamera(),r=n.rotate[0],s=null==i.pitch?-30:i.pitch;if(!(n.rotate[1]>s||n.rotate[1]>-10)){var l=this.GetViewCenter(),p=GmMap3D.Cartesian3.fromDegrees(l[0],l[1],0),h=180*Math.atan(o/a)/Math.PI,m=Math.sqrt(a*a+o*o),d=this.cartesianTo2MapCoord(this.deviationCalculate(p,GmMap3D.Math.toRadians(r+90-h),GmMap3D.Math.toRadians(0),m)),c=this.cartesianTo2MapCoord(this.deviationCalculate(p,GmMap3D.Math.toRadians(r+90+h),GmMap3D.Math.toRadians(0),m)),u=this.cartesianTo2MapCoord(this.deviationCalculate(p,GmMap3D.Math.toRadians(r+270-h),GmMap3D.Math.toRadians(0),m)),y=this.cartesianTo2MapCoord(this.deviationCalculate(p,GmMap3D.Math.toRadians(r+270+h),GmMap3D.Math.toRadians(0),m));(i=i||{}).positions=[d,c,u,y];var f=new GmMap3D.ImageMaterialProperty({color:this.colorTransform("#000000"),transparent:!1});i.wallMaterial=i.wallMaterial||f,i.undersideMaterial=i.wallMaterial||f,this.showClippingPlanes(i)}}},t.prototype.deviationCalculate=function(e,t,i,o){var a=new GmMap3D.HeadingPitchRoll(t,i,0),n=GmMap3D.Transforms.headingPitchRollToFixedFrame(e,a,GmMap3D.Ellipsoid.WGS84,GmMap3D.Transforms.eastNorthUpToFixedFrame,new GmMap3D.Matrix4),r=new GmMap3D.Cartesian3(o,0,0);return GmMap3D.Matrix4.multiplyByPoint(n,r,new GmMap3D.Cartesian3)},t.prototype.conshearzmap=function(e){for(var t=e.pointes,i=e.bmaterials,o=e.btopheight,a=e.bbotheight,n=e.bbheight,r=e.bjeercode,s=e.bweercode,l=e.id,p=0,h=0,m=[],d=[],c=0;c<t.length;c++){var u=(c+1)%t.length,y=t[c],f=t[u];m.push(y[0],y[1]),p+=y[0],h+=y[1];var g={points:y,pointe:f,facematerial:i[c],topheight:o[c],botheight:a[c]};d.push(g)}var M={midpoint:[p/t.length,h/t.length,0],ponits:m,facematmaterial:i[i.length-1],bheight:n},G=this.caldistancejw(t[0],t[1])-r,v=this.caldistancejw(t[0],t[t.length-1])-s;fplans=[[1,0,0,-G/2],[-1,0,0,-G/2],[0,1,0,-v/2],[0,-1,0,-v/2]];var w={id:l,plans:fplans,shearedgewidth:1,shearedgeclor:GmMap3D.Color.WHITE,verticalface:d,bootomface:M};return this.shearzmap(w)},t.prototype.shearzmap=function(e){for(var t=this.GetView(),i=t.scene.globe,o=e.bootomface.midpoint,a=GmMap3D.Cartesian3.fromDegrees(o[0],o[1],o[2]),n=t.entities.add({id:e.id,position:a,polygon:{hierarchy:GmMap3D.Cartesian3.fromDegreesArray(e.bootomface.ponits),height:e.bootomface.bheight?e.bootomface.bheight:-50,material:e.bootomface.facematmaterial?e.bootomface.facematmaterial:GmMap3D.Color.RED}}),r=[],s=0;s<e.plans.length;s++){var l=e.plans[s],p=new GmMap3D.ClippingPlane(new GmMap3D.Cartesian3(l[0],l[1],l[2]),l[3]);r.push(p)}i.depthTestAgainstTerrain=!0,i.clippingPlanes=new GmMap3D.ClippingPlaneCollection({modelMatrix:n.computeModelMatrix(GmMap3D.JulianDate.now()),planes:r,shearedgewidth:e.shearedgewidth?e.shearedgewidth:1,shearedgeclor:e.shearedgeclor?e.shearedgeclor:GmMap3D.Color.WHITE,enabled:!0});var h=e.verticalface;if(h){for(s=0;s<h.length;s++){var m=h[s].topheight;m&&0!==m||(m=1e-6);var d=h[s].botheight;m||(d=50);var c=h[s].points,u=h[s].pointe;t.entities.add({id:e.id+s,wall:{positions:GmMap3D.Cartesian3.fromDegreesArrayHeights([c[0],c[1],m,u[0],u[1],m]),minimumHeights:[d,d],material:h[s].facematerial?h[s].facematerial:GmMap3D.Color.RED,outline:!1}})}return r}},t.prototype.createWall=function(e){return this.zmapGeometry=this.zmapGeomettry||new ZMAPGEOMETRY(this),this.zmapGeometry.AddWall(e)},t.prototype.createPolyline=function(e){return this.zmapGeometry=this.zmapGeomettry||new ZMAPGEOMETRY(this),this.zmapGeometry.addPolyline(e)},t.prototype.colorTransform=function(e){if(e instanceof Cesium.Color)return e;if(e){if("Color"===e.constructor.name)return e;var t=null;if(e.red||e.RED||e.green||e.GREEN||e.blue||e.BLUE){var i=[];if(e.red||e.RED?i.push(e.red?e.red:e.RED):i.push(0),e.green||e.GREEN?i.push(e.green?e.green:e.GREEN):i.push(0),e.blue||e.BLUE?i.push(e.blue?e.blue:e.BLUE):i.push(0),e.alpha||e.ALPHA?i.push(e.alpha?e.alpha:e.ALPHA):i.push(1),0===Number(i[0])&&0===Number(i[1])&&0===Number(i[2]))t=new GmMap3D.Color(0,0,0,i[3]);else{var o={x:isNaN(Number(i[0]/255))?1:Number(i[0]/255),y:isNaN(Number(i[1]/255))?1:Number(i[1]/255),z:isNaN(Number(i[2]/255))?1:Number(i[2]/255)};t=new GmMap3D.Color(o.x,o.y,o.z,i[3])}return t}var a=e.replace(/(^[\s\n\t]+|[\s\n\t]+$)/g,"").replace(/\s/g,"").replace(/，/gi,",").replace("(","").replace(")","").replace("（","").replace("）",""),n=a.slice(0,3),r=a.slice(0,4);if("RGB"===n.toUpperCase()){var s=null;s=a.slice(3,a.length).split(",");if("RGBA"===r.toUpperCase()&&(s=a.slice(4,a.length).split(",")),0===Number(s[0])&&0===Number(s[1])&&0===Number(s[2]))t=new GmMap3D.Color(0,0,0,1);else{o={x:isNaN(Number(s[0]/255))?1:Number(s[0]/255),y:isNaN(Number(s[1]/255))?1:Number(s[1]/255),z:isNaN(Number(s[2]/255))?1:Number(s[2]/255)};t=s[3]?new GmMap3D.Color(o.x,o.y,o.z,Number(s[3])):new GmMap3D.Color(o.x,o.y,o.z,1)}return t}if(!(r.indexOf("#")>=0)){if("HSL"===n.toUpperCase()){s=a.slice(3,a.length).split(",");var l,p,h,m=Number(s[0]),d=Number(s[1]),c=Number(s[2]);if(0===d)return l=p=h=c,t=new GmMap3D.Color(Number(l),Number(p),Number(h),1);var u=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},y=c<.5?c*(1+d):c+d-c*d,f=2*c-y;return l=u(f,y,m+1/3),p=u(f,y,m),h=u(f,y,m-1/3),t=0===l&&0===p&&0===h?new GmMap3D.Color(0,0,0,1):new GmMap3D.Color(parseFloat(l),parseFloat(p),parseFloat(h),1)}return t=GmMap3D.Color[a.toUpperCase()]}var s=a;"HEX"===n.toUpperCase()&&(s=a.slice(3,a.length));var g=s.toLowerCase();if(g&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(g)){if(4===g.length){for(var M="#",G=1;G<4;G+=1)M+=g.slice(G,G+1).concat(g.slice(G,G+1));g=M}var v=[];for(G=1;G<7;G+=2)v.push(parseInt(g.slice(G,G+2),16));if(0===Number(v[0])&&0===Number(v[1])&&0===Number(v[2]))return t=new GmMap3D.Color(0,0,0,1);if(0===Number(v[0])&&0===Number(v[1])&&0===Number(v[2]))t=new GmMap3D.Color(0,0,0,1);else{o={x:isNaN(Number(v[0]/255))?1:Number(v[0]/255),y:isNaN(Number(v[1]/255))?1:Number(v[1]/255),z:isNaN(Number(v[2]/255))?1:Number(v[2]/255)};t=new GmMap3D.Color(o.x,o.y,o.z,1)}return t}return null}},t.prototype.addHeatmap=function(e,t){var i=e;this.GetView().entities.removeById(i);var o=document.createElement("div");o.setAttribute("style","width:1000px;height:1000px;margin: 0px;display: none;"),document.body.appendChild(o);for(var a=this.GetZoom(),n=parseInt(17150/(a*a*a)),r=t.gradient?t.gradient:{.9:"red",.8:"orange",.7:"yellow",.5:"blue",.3:"green"},s=h337.create({container:o,radius:n,blur:.95,gradient:r,opacity:.8}),l=t.data,p=0,h=0;h<l.length;h++)parseFloat(l[h].value)>p&&(p=parseFloat(l[h].value));s.setData({max:p,data:l});var m=t.polygon?t.polygon:[[[105.91517,25.002073],[104.058488,24.996596],[104.053011,23.002989],[104.053011,21.003906],[105.728954,20.998429],[107.919731,21.003906],[109.04798,20.998429],[111.047063,20.998429],[111.047063,22.000709],[111.047063,24.476286],[111.05254,25.002073]]],d={type:"heatmap",material:s._renderer.canvas,outline:!1};this.AddEntity(i,m,void 0,void 0,d);var c=this,u={heatmapID:this.AddEventListener("wheel",(function(){var e=c.GetZoom(),t=parseInt(17150/(e*e*e)),a=h337.create({container:o,radius:t,opacity:.8,blur:.95,gradient:r});a.setData({max:p,data:l}),c.GetEntity(i).polygon.material=a._renderer.canvas}))},y=this.handlerArray;y.push(u),this.handlerArray=y};var n=null;t.prototype.moveRain=function(){null!=n.show&&(n.show=!1)},t.prototype.GetRain=function(e){var t=e[2]||3e3,i=new GmMap3D.Cartesian3.fromDegrees(e[0],e[1],t),o=this.GetView().scene;o.globe.depthTestAgainstTerrain=!0;o.camera.setView({destination:new GmMap3D.Cartesian3(i.x,i.y,i.z)});var a=o.drawingBufferWidth/200,r=new GmMap3D.Cartesian2(a,4*a),s=new GmMap3D.Cartesian3;n=new GmMap3D.ParticleSystem({modelMatrix:new GmMap3D.Matrix4.fromTranslation(o.camera.position),speed:-2,lifetime:15,emitter:new GmMap3D.SphereEmitter(5e4),startScale:1,endScale:0,image:e.image?e.image:"./images/rain.png",emissionRate:8e3,startColor:new GmMap3D.Color(.71,.71,.66,0),endColor:new GmMap3D.Color(.71,.71,.66,.98),imageSize:r,updateCallback:function(e,t){s=GmMap3D.Cartesian3.normalize(e.position,s),s=GmMap3D.Cartesian3.multiplyByScalar(s,-1050,s),e.position=GmMap3D.Cartesian3.add(e.position,s,e.position);var i=GmMap3D.Cartesian3.distance(o.camera.position,e.position);e.endColor.alpha=i>5e4?0:n.endColor.alpha/(i/5e4+.1)}}),o.primitives.add(n)};var r=[];t.prototype.KDT=function(e){r=[];var t=this.GetView(),i=this.orderLines(e);for(var o in i){var a="KDT"+o;r.push(a);t.entities.add({id:a,name:"Glowing blue line on the surface",polyline:{positions:GmMap3D.Cartesian3.fromDegreesArrayHeights(i[o]),width:1,material:GmMap3D.Color.YELLOW.withAlpha(.5),shadows:GmMap3D.ShadowMode.ENABLED,followSurface:!1}})}};var s=[];t.prototype.orderLines=function(e){var t=[];s=[];var i=e.minHeight||0,o=e.maxHeight||3e3,a=e.markZ||10,n=e.markY||10,r=e.markX||10,l=e.pointArr,p=e.dif;t.push([l[0][0],l[0][1],i,l[0][0],l[0][1],o]),t.push([l[0][0],l[0][1],i,l[1][0],l[1][1],i]),t.push([l[0][0],l[0][1],i,l[2][0],l[2][1],i]);for(var h=0;h<a;h++){var m=(o-i)/a*(h+1);h<a-1&&(t.push([l[0][0],l[0][1],m+i,l[0][0]+p,l[0][1],m+i]),this.AddTextLabel("TextLabel"+h,l[0][0],l[0][1],parseInt(m)+"",{height:m+i}),s.push("TextLabel"+h)),h==a-1&&(this.AddTextLabel("TextLabel"+h,l[0][0],l[0][1],"米",{height:m+i}),s.push("TextLabel"+h))}for(var d=0,c=0;c<r;c++){m=(l[0][0]-l[1][0])/r*c;d||(d=parseInt(this.caldistancejw(l[0],l[1])/r));var u=d*c;c<r-1&&(t.push([l[0][0]-m,l[0][1],i,l[0][0]-m,l[0][1],i+o/30]),this.AddTextLabel("TextLabel1"+c,l[0][0]-m,l[0][1],parseInt(u)+"",{height:i}),s.push("TextLabel1"+c)),c==r-1&&(this.AddTextLabel("TextLabel1"+c,l[0][0]-m,l[0][1],"米",{height:i}),s.push("TextLabel1"+c))}for(var y=0,f=0;f<n;f++){m=(l[0][1]-l[2][1])/n*f;y||(y=parseInt(this.caldistancejw(l[0],l[2])/n));var g=y*f;f<n-1&&(t.push([l[0][0],l[0][1]-m,i,l[0][0],l[0][1]-m,i+o/30]),this.AddTextLabel("TextLabel2"+f,l[0][0],l[0][1]-m,parseInt(g)+"",{height:i}),s.push("TextLabel2"+f)),f==n-1&&(this.AddTextLabel("TextLabel2"+f,l[0][0],l[0][1]-m,"米",{height:i}),s.push("TextLabel2"+f))}return t},t.prototype.moveKDTextLable=function(){for(var e=0;e<s.length;e++)this.RemoveLabel(s[e]);for(var t=0;t<r.length;t++)this.RemoveEntity(r[t])},Map3DSDK.Map=t;var l=Map3DSDK.ZmapModelPick=function(e,t){var i=this;if(this.option=t||{},i.option.clickColor=i.option.clickColor||"rgba(255,0,0,0.6)",i.option.hoverColor=i.option.hoverColor||"rgba(0,255,0,0.6)",this.map3dView=e,"Silhouette"==i.option.type)this.silhouetteBlue=GmMap3D.PostProcessStageLibrary.createEdgeDetectionStage(),i.silhouetteBlue.uniforms.color=i.option.hoverColor?e.colorTransform(i.option.hoverColor):GmMap3D.Color.BLUE,i.silhouetteBlue.uniforms.length=.01,i.silhouetteBlue.selected=[],this.silhouetteGreen=GmMap3D.PostProcessStageLibrary.createEdgeDetectionStage(),i.silhouetteGreen.uniforms.color=i.option.clickColor?e.colorTransform(i.option.clickColor):GmMap3D.Color.RED,i.silhouetteGreen.uniforms.length=.01,i.silhouetteGreen.selected=[],e.GetView().scene.postProcessStages.add(GmMap3D.PostProcessStageLibrary.createSilhouetteStage([i.silhouetteBlue,i.silhouetteGreen]));else{var o="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nuniform vec4 highlight;\nvoid main() {\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (czm_selected()) {\n        vec3 highlighted = highlight.a * highlight.rgb + (1.0 - highlight.a) * color.rgb;\n        gl_FragColor = vec4(highlighted, 1.0);\n    } else { \n        gl_FragColor = color;\n    }\n}\n";this.silhouetteBlue=new GmMap3D.PostProcessStage({fragmentShader:o,uniforms:{highlight:function(){return i.option.hoverColor?e.colorTransform(i.option.hoverColor):GmMap3D.Color.BLUE}}}),i.silhouetteBlue.selected=[],this.silhouetteGreen=new GmMap3D.PostProcessStage({fragmentShader:o,uniforms:{highlight:function(){return i.option.clickColor?e.colorTransform(i.option.clickColor):GmMap3D.Color.RED}}}),i.silhouetteGreen.selected=[],e.GetView().scene.postProcessStages.add(i.silhouetteBlue),e.GetView().scene.postProcessStages.add(i.silhouetteGreen)}this.nameOverlay=document.createElement("div"),e.GetView().container.appendChild(i.nameOverlay),i.nameOverlay.className=i.option.hoverClass||"backdrop",i.nameOverlay.style.display="none",i.nameOverlay.style.position="absolute",i.nameOverlay.style.bottom="0",i.nameOverlay.style.left="0",i.nameOverlay.style["pointer-events"]="none",this.selectedEntity=new GmMap3D.Entity,this.clickHandler=e.GetView().screenSpaceEventHandler.getInputAction(GmMap3D.ScreenSpaceEventType.LEFT_CLICK);var a=document.createElement("style");a.innerHTML=".backdrop {background: #000;color: #fff;padding: 4px;font-size: 12px;}",document.getElementsByTagName("head")[0].append(a)};function p(e,t){var i="";if(t&&"object"==typeof t){i+='<tr><th style="max-width:100px;text-overflow:ellipsis;overflow:hidden;" title="'+e+'">'+e+'</th><td><table style="width:100%;font-size:12px"><tbody>';for(var o=0;o<Object.keys(t).length;o++)i+=p(Object.keys(t)[o],t[Object.keys(t)[o]]);i+="</tbody></table></td></tr>"}else i+='<tr><th style="max-width:100px;text-overflow:ellipsis;overflow:hidden;" title="'+e+'">'+e+"</th><td>"+t+"</td></tr>";return i}l.prototype.reback=function(){this.silhouetteBlue.selected=[],this.silhouetteGreen.selected=[],this.nameOverlay.style.display="none"},l.prototype.hover=function(e,t){this.silhouetteBlue.selected=[];var i=e.endPosition,o=this.map3dView.PickModel(i);if(!t||"function"!=typeof t||0!=t(o)){var a=o.models;if(GmMap3D.defined(a))if(this.nameOverlay.style.display="block",this.nameOverlay.style.bottom=this.map3dView.GetView().canvas.clientHeight-e.endPosition.y+"px",this.nameOverlay.style.left=e.endPosition.x+"px",a.id){this.silhouetteBlue.selected=[a.primitive];var n=a.id;this.nameOverlay.textContent="string"==typeof n?n:n.name||n.id}else{if(a.getProperty){var r=a.getProperty("name")||a.getProperty("NAME");GmMap3D.defined(r)||(r=a.getProperty("id")||a.getProperty("ID")),this.nameOverlay.textContent=r}else this.nameOverlay.style.display="none";this.silhouetteBlue.selected=[a]}else this.nameOverlay.style.display="none"}},l.prototype.click=function(e,t){this.silhouetteGreen.selected=[];var i=e.position,o=this.map3dView.PickModel(i);if(!t||"function"!=typeof t||0!=t(o)){var a=o.models;if(GmMap3D.defined(a))if(a.id){if(a.id.callfun&&"function"==typeof a.id.callfun){var n={id:a.id.id,name:a.id.name};a.id.callfun(n)}this.silhouetteGreen.selected=[a.primitive],this.selectedEntity=a.id,this.selectedEntity.description='Loading <div class="cesium-infoBox-loading"></div>',this.map3dView.GetView().selectedEntity=this.selectedEntity,this.selectedEntity.description='<table class="cesium-infoBox-defaultTable"><tbody><tr><th>id</th><td>'+a.id.id+"</td></tr><tr><th>name</th><td>"+a.id.name+"</td></tr></tbody></table>"}else{if(this.silhouetteGreen.selected[0]===a)return;if(a===this.silhouetteBlue.selected[0]&&(this.silhouetteBlue.selected=[]),this.silhouetteGreen.selected=[a],a.getProperty){var r=a.getProperty("name")||a.getProperty("NAME");GmMap3D.defined(r)||(r=a.getProperty("id")||a.getProperty("ID")),this.selectedEntity.name=r,this.selectedEntity.description='Loading <div class="cesium-infoBox-loading"></div>',this.map3dView.GetView().selectedEntity=this.selectedEntity;for(var s=a.getPropertyNames(),l="",h=0;h<s.length;h++)l+=p(s[h],a.getProperty(s[h]))}this.selectedEntity.description='<table class="cesium-infoBox-defaultTable" style="font-size:12px"><tbody>'+l+"</tbody></table>"}else this.clickHandler(e)}}}();var ZMap3D=Map3DSDK;function randomString(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,a="";for(i=0;i<e;i++)a+=t.charAt(Math.floor(Math.random()*o));return a}var desTable="WlNs4mMr7cPEh3FnGi0C5OAgId8JL6KkDuSaUb9Ty1Hfz2BjVoqXtZvYpwQxRe";function CodeString(e){for(var t=e.split(""),i=(desTable.split(""),new Array(t.length)),o=0;o<t.length;o++){var a,n=t[o],r=e.charCodeAt(o);/^[a-z]+$/.test(n)?a=parseInt(r)-97+26:/^[A-Z]+$/.test(n)?a=parseInt(r)-65:/^[0-9]+$/.test(n)&&(a=parseInt(n)+52),n=desTable[a],i[o]=n}return i.join().replace(/,/g,"")}function showLogo(e){var t;if(null==(t=document.getElementById("zmapservertip"))||"undefined"==t){(t=document.createElement("div")).className="zmapservertip",t.id="zmapservertip",t.style.cssText="display:block !important;border:1px solid red; background:#ddd; opacity:0.6;text-align:center; font-size:24px;font-weight:bold;font-style:italic;color: #FF6600;width:450px; z-index:100; height:50px;;position:absolute; bottom:5px; right:10px; ";t.innerHTML=decodeURI("%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF%E6%88%96%E8%80%85%E8%AF%81%E4%B9%A6%E5%B7%B2%E8%BF%87%E6%9C%9F")+"<br>服务地址"+e,document.body.appendChild(t)}else t.style.display="block !important";setTimeout((function(){GetServerInfo()}),1e4)}function hideLogo(){var e;null==(e=document.getElementById("zmapservertip"))||"undefined"==e||(e.style.display="none !important")}
