!function(t){var a=function(t,a,o){t&&a&&o?(this.GmMap3D=t,this.map3DView=a,this.viewer=a.cesium.viewer,this._toolbar=o,this.cameras=[],this.count=0,this.loopTimer=null,this.GmMap3D.knockout.track(this),this.GmMap3D.knockout.applyBindings(this,o),this.inited=!0):this.inited=!1};a.prototype={call:function(){},init:function(t,a,o){return this.inited||(this.GmMap3D=t,this.map3DView=a,this.viewer=a.cesium.viewer,this._toolbar=o,this.cameras=[],this.count=0,this.loopTimer=null,this.GmMap3D.knockout.track(this),this.GmMap3D.knockout.applyBindings(this,o),this.inited=!0),this},_showToolbar:function(){return this._toolbar.style.display="block",this},_hideToolbar:function(){return this._toolbar.style.display="none",this},save:function(){var t=this.viewer.scene.camera,a=this.viewer.canvas,o=this.GmMap3D.Cartesian3.clone;this.count++;var e={id:Date.now(),name:"相片"+this.count,photo:a.toDataURL("image/jpeg",300/a.width),destination:o(t.position),orientation:{heading:t.heading,pitch:t.pitch,roll:t.roll}};return this.cameras.push(e),e},getImg:function(t,a){},setImgCall:function(t){this.call="function"==typeof t?t:function(){}},get:function(t){var a,o=this.cameras;return 0===o.length?null:(t=Number(t))<1e4?o[t]:(a=null,o.forEach((function(o){o.id===t&&(a=o)})),a)},remove:function(t){var a=typeof t,o=this.cameras,e=null;return"number"===a?e=t<1e4?t:(o.forEach((function(a,o){a.id===t&&(e=o)})),e):"object"===a&&o.forEach((function(a,o){a===t&&(e=o)})),null!==e&&o.splice(e,1),this},getAll:function(){return this.cameras},fly:function(t){return this.viewer.camera.flyTo(t),this},autofly:function(t,a){var o=this,e=o.cameras.length;return clearInterval(o.loopTimer),o.viewer.camera.flyTo(o.get(t)),o.loopTimer=setInterval((function(){o.viewer.camera.flyTo(o.get(t++%e))}),a||6e3),this},stop:function(){return clearInterval(this.loopTimer),this},clean:function(){return this.stop(),this.cameras=[],this.count=0,this},formaterData:function(){return{data:this.cameras,count:this.count}},imports:function(t){try{t="string"==typeof t?JSON.parse(t):t,this.cameras=t.data,this.count=t.count}catch(t){alert("浏览器不支持导入")}},download:function(t,a){try{var o=document.createElement("a");o.download=a,o.style.display="none";var e=new Blob([t]);o.href=URL.createObjectURL(e),document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(t){console.error("浏览器不支持直接下载"),alert("浏览器不支持直接下载")}},downloadImg:function(t){try{var a=this.get(t),o=document.createElement("a");o.download=a.name+".jpg",o.style.display="none",o.href=a.photo,document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(t){console.error("浏览器不支持直接下载"),alert("浏览器不支持直接下载")}},createDefaultUI:function(){return this._createDefaultDOM()._createDefaultStyle()._createDefaultBinding()},_createDefaultDOM:function(){var a=['<div class="zmap-cameraStatus">','\t\t    <div id="toolbar">','\t\t\t    <ul data-bind="foreach: cameras">',"\t\t\t    \t<li data-bind=\"attr: { 'data-id': id }\">",'\t\t\t\t\t\t<div class="control3D download"></div>','\t\t\t\t\t\t<div class="control3D save"></div>','\t\t\t\t\t\t<div class="control3D close"></div>','\t\t\t\t        <input type="text" data-bind="value: name, valueUpdate: \'input\'" />','\t\t\t\t        <img data-bind="attr: { src: photo }" />',"\t\t\t\t    </li>","\t\t\t\t</ul>","\t\t\t</div>","\t\t\t",'\t\t\t<div class="bottom">','\t\t\t\t<input type="file" name="file" id="file" style="display:none">','\t\t\t    <input type="button" value="拍照" onclick="javascript:CameraTool.save()"/>','\t\t\t\t<input type="button" value="获取全部相机对象" onclick="javascript:console.info(CameraTool.getAll())"/>','\t\t\t    <input type="button" value="自动播放" onclick="javascript:CameraTool.autofly(0)._hideToolbar();"/>','\t\t\t    <input type="button" value="停止播放" onclick="javascript:CameraTool.stop()._showToolbar()"/>','\t\t\t    <input type="button" value="下载标准文件" onclick="javascript:CameraTool.download(JSON.stringify(CameraTool.formaterData()),\'未命名.json\')"/>','\t\t\t    <input type="button" value="导入文件" onclick="javascript:$(\'#file\').click()"/>',"\t\t\t</div>","\t\t</div>"].join("");return t("body").append(a),this},_createDefaultStyle:function(){var a=["<style>","        .zmap-cameraStatus #toolbar {","\t\t\tbackground: rgba(42, 42, 42, 0.8);","\t\t    padding: 4px;","\t\t    border-radius: 4px;","\t\t    position: absolute;","\t\t    top: 3%;","\t\t    color: white;","\t\t    right: 7%;","\t\t\tmax-height: 90%;","\t\t\toverflow: auto;","\t\t\topacity: .4;","\t\t\ttransition: opacity .4s ease;","\t    }","\t    .zmap-cameraStatus #toolbar:hover{","\t    \topacity: 1;","\t    }","\t    .zmap-cameraStatus #toolbar input {","\t\t\tvertical-align: middle;","\t\t\tpadding-top: 2px;","\t\t\tpadding-bottom: 2px;","\t\t\twidth: 100%;","\t\t\tbox-sizing: border-box;","\t\t\toutline: none;","\t\t\tbackground: rgba(0,0,0,.5);","\t\t\tcolor: white;","\t\t\ttext-align: center;","\t\t\tborder: none;","\t\t\tposition: absolute;","\t\t\tbottom: 0;","\t    }","\t\t.control3D{","\t\t    background-repeat: no-repeat;","\t\t    background-position: center;","\t\t    background-size: 20px;","\t\t    position: absolute;","\t\t    width: 20px;","\t\t    height: 20px;","\t\t    top: 0;","\t\t    display: none;","\t\t}","\t\t.control3D:nth-child(1){","\t\t\tright: 50px;","\t\t}","\t\t.control3D:nth-child(2){","\t\t\tright: 25px;","\t\t}","\t\t.control3D:nth-child(3){","\t\t\tright: 0;","\t\t}","\t\t.save{","\t\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADlklEQVR4Xu2bS6hNURjHf3+Tez0mJAMlpORRQhkKA0kGJgrdlJkrlJky8CoZGhkw8kooMTC6I68hcktuopuUiLzJKz59dU6dTvecvda+e92zz2NNTt37re/xW99a69trry26vKnL46cHoJcBAQTMrB9YCMwIEJ8IkVFJL4swlDkFzGwLcBaYWoTBgnT8Bc4AByR9HY/OpgDMbBNwczwGEve9C6yV9C+vnSwAnmZz8iqfoH6HJR3La6shADObDbzKq3gC+/nor5L0MI/NZgAWA0/yKG1Bn1FgqaSfsbbzAPgO3I81VLD8KmBKnc7TkgZj7eQBMCxpeayhIuXNzDPTM7S+bZA0FGOr0wC8q0wF/w1qnQbAgx6StCEoemj8LGBmjRbBMk+Baty7JHmhlNk6MQM8aF+ol0ny3aFpKzUAM9sJzAXOSXpRjaTJIlgbrNcFXh80rRJLC8DMjgCHKxF9AuZL8l8CAbjoUUmup2ErM4BbwJoaz9dJ8r/FAMisEjsdgPN6XlkPfoyVBt0AwOM+IelgNwN4L2lmNwPw2Psk/a6H0C1TwOPul/SrCAAjkpZkFRjj/X/dNvgZmFezDfrCtiDSRmEAfGtxZX8iHYgWrxRC8/xMsloImdlk4BswKVJhYQDc7l5JpyIdKETczI4DY67oGQYKBeAjsFvSxUKiClBiZn426Wd/Xh7naYUCqDrwERgBUk+HacDKZk+vAUSSAAiwWxqRHoCitsHSDGmkI70M6GVAQZVgZOaVRrw3BVJNgevAZeBtC8baT673+LuAANtJMuCypO0BxpOJmFkf8CzgLXYSAGsk3UkWXaBiMzvkB6AT+SxQteWXE24H+plMrO7RuZGdJBlwRdK2ZJEFKG71FHAXrwFXW7gI7mvwprgeX5IMCBij0oj0AKSqA0ozxK3YBdolePcz6RTwU6FWVYKzAkchCYDXwEZJw4FOFC5mZgPAhYDjsiQAgm9iFB55jUIzuwRkleRJAKyQ9ChlcCG6zWw/cLIVi+CgpNMhTqaUMTN/Gt3aCgBvgPWSHqcMsJluM9sBnA+wn2QKVO127S4QAL40IkkzoDRRNnEkGkC7XJcPge+v7vyChNULZ30w4d8LOIh2b/ckrR4riCwAm4EbbR69j7pfmHwQDcA7VD6a8m3GLya0W/sCDEhq+N1T5ldjFQh+8roImN5GBD4AT8c6A6iNIQhAGwUd7WoPQDSyDuvQ9RnwH17V71DKxd5sAAAAAElFTkSuQmCC);","\t\t}","\t\t.download{","\t\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEUklEQVR4Xu2aS8hVVRTHf/+KqIZR0KSalBlBFA56UBliVGoOMiroQQ/BiaRiDiokC4sgoSwFMawIhISKKLOiB0Rlgj0JehgNtKEZNJGQasWC88luu8/jnnu+c47fPXt2zz1n7/X/rbWfa4sJL5pw/QwAhgiYcAJDF5jwAOhuEDSzE4HbMgfskPRPF87opAtk4j8Ers1E75R00yQBuAD4KRJ8nqRf24bQVQTMAb6MxM6R9PUAoGUCQwQUATez04GlwD3Ahdm7PwJzJR2s6ywza7wLmNkpwEbgTuA04A/gA2CNpN/ybM2NADO7F9gMnJr4+ClJD/UMwBPAwwmbDgOrJG1N2ZsEYGbu9RcKBG6UtLJnAJ4EipzynKQVsc3HADCz2cB3wMk5An8Grpe0v2cAzgQ+BXyKzSvzJX0U/pkC4P3ogaiGz4G3swb2SPq3rnj/bjrGgKzeE4DLgauBBcA1kZ3bJfkYcbSkAHwDXBK884VX2ORSdboAxE4xM3faouD595IuLgNwADg7eGm9pLXjeDxhWOOzQMo+M1sPPBL8d0DSuQOAki4wRMDQBYYxYBgER5oFzOwc4LCk36vMFuNOg2Z2hq/3Jfl4lVtamQWCRv7ONh7PlkEYB4CZ+RL8aeAk4BlgtSTrZBo0s/OBfVHjvvvaUOKZWusAM3swEx9Wf6mkb7sC4CtGXznGpRBCnQgws3XAo4m2Zkn6pSsAvpR+MTsviG14TJIbfUwZFYCZeci79+OyWdLyvGhrawzwDcgrwB0JQzZIWhM/HwVAgfjtwF15/d/bbAVA1tBIEKoCKBF/d9mutDUAAYQdwC1lkVAFQIH41zyhUia+1QiYEpwlPF4tg1AGwMyeB1J928XfXnVr3moERBDeABbnRUIRgALxbwE3VxXfSQQEEHyR8noOhE3Ay6nECOAHsSnPu/glknyxVbl0EgERhJ1+fpiw+D3ghuj5+znv1hLfaQQEEPxg1QWkIFTxpENZNKrng/a7PxEys7oQXPxiSUeqkEq902kXCA3KILwLzKso5mPgxnHE96ILRBA8dfVOBQgufqGkvyrCyn2tNxEQ9EmH4Pm6q3Ks/gy4rgnxvYuAAIInLr1/xxBcvGecPJfXSOldBEQQdnmWOXv2iWdymhTf2wiI1glXZr93153qikKltxHQSHxXqGQA0NfUWAXnNfLKEAFDBNTLDvsNkFlBDG6VtKyRmGy5EjPzw5mp67je+j5J/7tBkrog4ctVv10xVXwz4vdvfAv71XRMV01yMTM/i/C8g1+9De8GeDO7JC0M20sBuA/Y1qRRParrfkl+jH+0pAD4Ce9u4LIeGd6EKXv9/lB8mJp3Tc7X6y8BtzbRcg/q8MzRFZIOxbYUXpU1syWAn+Gd1QMRdUz4E9gCPJ63zyi9K2xm3iUuyq7K+uzgg8zxUH4A3iw7VCkFcDwoHcfGAcA49GbCt0MEzAQvjqNhiIBx6M2Eb/8DoBrmX+csKL0AAAAASUVORK5CYII=);","\t\t}","\t\t.close{","\t\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC40lEQVR4Xu3aoW8UQRTH8d/PERICgX8FBYSQIBAIDAqDw5GAIKEKUFSQgMAhUTgUCoXC1GAQCEgQCJKSkoaSBhgy5JY0zd3Oe2/em2nvdk3FTTf7/ezs7Pa6xIpvXPF+TADTDFhxgekSWPEJMC2CxUsgpbQD4MicmbJOcu0gzKCU0kMAd+ccyw7Jo2PHWAOQ99sdYSQ+H184QFeEQnwzgC4IgvimAE0RhPHNAZogKOLdAG4BeKxY7cMWRmV8PuTbJJ9U3QXyL6eUuiNExOe24m1w0OuJEBWvApjNhPywkR86pFv15RAZrwZojRAdbwJohdAi3gwQjdAqvgrAiHCf5IOxBaRlfDWAEWGN5Po8hNbxLgBeCIb4hZDSW5QbQC1Cr3hXACsCgOMLvsxYdCJdzvywc/GToHRapZS0D0vSXedxrvHuM2DPY3MEgnt8GIDxchibCSHxoQCOCGHx4QAOCKHxTQAqEMLjDzrAHZKPNLcIy1j32+D+g6i8Ld4k+dQSJv2dUIDK+KHhBsln0iDtuDAAp/h/SwiA6ySfa+Mk40MAHOOHhj8ArpF8IYnSjHEHCIgfen4DuErypSawNNYVwBA/fDlyr3Sgs89/AbhC8pVwfHGYG4Ah/v83xso/h3cBXCb5ulgnGOACUBM/HKMS4SeASyTfCBpHh1QDeMQbEX4AuEjybQ1CFYBnvBFhG8AFkhtWBDNARLwRYQvAeZLvLAgmgMh4I8ImgHMk32sR1AAt4o0IXwGcJflBg6ACaBlvRPgyQ/goRRAD9Ig3InyeIeSfxU0E0DPeiPAJwBmSeUbUPQcchHgjQl4L8pqQ14aFW3EGjLwpOm+n1S9ElM6Y8olxg+TpVgDh8YaZsEnyVAuAZvFKhG8kT0YDNI9XIGyRPBEJ0C1eiPCdZP7na8gi2D1+D0J+kTO/y7h/2yZ5rAqgtCof9s+Lt8HDHlg6/gmgJLTsn08zYNnPcKlvmgEloWX//C97lKtQkiI67wAAAABJRU5ErkJggg==);","\t\t}","\t\t.zmap-cameraStatus li{","\t\t\twidth: 300px;","\t\t\tborder: 1px solid white;","\t\t\tbox-sizing: border-box;","\t\t\tposition: relative;","\t\t\tmargin: 0 0 10px 0;","\t\t\tborder-radius: 5px;","\t\t\toverflow: hidden;","\t\t}","\t\t.zmap-cameraStatus li:hover{","\t\t\tcursor: pointer;","\t\t}","\t\t.zmap-cameraStatus li:hover .control3D{","\t\t\tdisplay: block;","\t\t}","\t\t.zmap-cameraStatus li img{","\t\t\twidth: 100%;","\t\t}","\t\t.zmap-cameraStatus .bottom{","\t\t\tposition: absolute;","    \t\ttop: 3%;","\t\t}","\t\t.zmap-cameraStatus .bottom input[type='button']{","\t\t\tborder: 1px solid white;","\t\t\tbackground: rgba(0,0,0,.5);","\t\t\tcolor: white;","\t\t\tpadding: 3px 5px 4px 5px;","\t\t\tcursor: pointer;","\t\t}","</style>"].join("");return t("head").append(a),this},_createDefaultBinding:function(){return t("#toolbar").on("click","li",(function(){var a=t(this).attr("data-id");CameraTool.fly(CameraTool.get(a))})),t("#toolbar").on("click",".close",(function(){var a=t(this).parent("li").attr("data-id");return CameraTool.remove(Number(a)),!1})),t("#toolbar").on("click",".save",(function(){var a=t(this).parent("li").attr("data-id"),o=CameraTool.get(a);return CameraTool.call(o),!1})),t("#toolbar").on("click",".download",(function(){var a=t(this).parent("li").attr("data-id");return CameraTool.downloadImg(Number(a)),!1})),t("#file").change((function(){try{var t=this.files[0],a=new FileReader;a.readAsText(t,"utf-8"),a.onload=function(t){CameraTool.imports(t.target.result)}}catch(t){alert("文件读取失败，请检查是否为纯文本")}})),this}},window.CameraTool=new a,window.CameraToolPrototype=a}(jQuery);
