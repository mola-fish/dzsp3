var Map3DSDK=Map3DSDK||{};!function(){var e=function(e){return null!=e},t=function(t){if(!e(t.scene))throw"no scene param!";if(!e(t.dirs))throw"no dirs param!";if(!e(t.model))throw"no model param!";var o,r,a,s=this,l=(o=t.image,r="images/arrow.png",null!=o?o:r);this.scene=t.scene,this.dirs=t.dirs,this.models=t.model,this.models instanceof Array||(this.models=[t.model]),this.canvas=((a=document.createElement("CANVAS")).width=512,a.height=512,a),this.ctx=this.canvas.getContext("2d"),this.tex1=i(this.scene._context),this.tex2=i(this.scene._context),this.image=new Image,this.image.onload=function(){n(s,0)},this.image.src=l,this.pos=0,this.uniforms=[]};function n(e,t){var n=e.image,i=e.ctx,o=e.pos=(e.pos+t)%512;i.clearRect(0,0,512,512),i.fillStyle="#FF0000",i.fillRect(0,0,512,512),i.drawImage(n,o-512,0,512,512),i.drawImage(n,o,0,512,512),e.tex1.copyFrom(e.canvas),i.clearRect(0,0,512,512),i.fillStyle="#0000FF",i.fillRect(0,0,512,512),i.translate(256,0),i.scale(-1,1),i.translate(-256,0),i.drawImage(n,o+512,0,-512,512),i.drawImage(n,o,0,-512,512),i.setTransform(1,0,0,1,0,0),e.tex2.copyFrom(e.canvas)}function i(e){return new Cesium.Texture({context:e,width:512,height:512,preMultiplyAlpha:!1,flipY:!1,sampler:new Cesium.Sampler({wrapS:Cesium.TextureWrap.REPEAT,wrapT:Cesium.TextureWrap.REPEAT})})}t.prototype.show=function(){if(!(this.uniforms.length>0)){var e=this;!function e(t,n){for(var i,o=0;o<t.length;++o)(i=t.get(o))instanceof Cesium.PrimitiveCollection?e(i,n):n(i)}(this.scene.primitives,(function(i){if(-1!=function(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}(e.models,i.id))for(var o=i._nodeCommands,r=0;r<o.length;++r){var a=o[r].command;e.uniforms.push([a._uniformMap,a._uniformMap.u_baseColorTexture]),o[r].command._uniformMap.u_baseColorTexture=e.dirs[a.owner.mesh.name]?t:n}}))}function t(){return e.tex1}function n(){return e.tex2}},t.prototype.hide=function(){if(0!=this.uniforms.length){for(var e=this.uniforms,t=0;t<e.length;++t){var n=e[t];n[0].u_baseColorTexture=n[1]}e.length=0}},t.prototype.start=function(){if(!this.loopHandle){var e=this;this.loopHandle=setInterval(()=>{n(e,30)},50)}},t.prototype.stop=function(){this.loopHandle&&(clearInterval(this.loopHandle),this.loopHandle=0)},Map3DSDK.PipeTexFlow=t}();