!function(t){var e={GmMap3D:null,inited:!1,map3DView:null,viewer:null,models:[],init:function(t,e){return this.inited||(this.GmMap3D=t,this.map3DView=e,this.viewer=e.cesium.viewer,this.zmapgltf=new ZMAPGLTF(e),this.inited=!0),this},loadModels:function(t,e){return e=e||[0,0,0],t.files.sort().forEach((function(i,o){var n=i,a=t.path;this.models.push(this.zmapgltf.addModel({modelid:n.split(".")[0],drotate:[0,0,180],position:e,fcolor:"rgba(255,0,0,.5)",shadows:!0,url:a+n,dminimumPixelSize:1,dmaximumScale:1,ifFlyTo:!1},0===o))}),this),this._setOriginHeight()},setModels:function(t){return this.models=t,this._setOriginHeight()},getModel:function(t){return this.models.filter((function(e){return e._id===t}))[0]},flyWithLight:function(t,e){this.setColor(t,e),this.map3DView.lockedModel(t);var i=this;return setTimeout((function(){i.map3DView.unLockModel()}),100),this},setColor:function(t,e){return t.model.color=e||Cesium.Color.GRAY,t.model.silhouetteColor=new Cesium.Color(1,1,0,1),t.model.silhouetteSize=3,this},cleanColor:function(t){return t.model.color=null,t.model.silhouetteColor=null,t.model.silhouetteSize=0,this},cleanAllColor:function(){this.models.forEach((function(t){this.cleanColor(t)}),this)},_setOriginHeight:function(){return this.models.forEach((function(t){if(!t.hasOwnProperty("default_hei")){var e=this._cartographic2(t._position._value);t.default_lng=e[0],t.default_lat=e[1],t.default_hei=e[2]}}),this),this},up:function(t,e,i){return this._animate(t,{z:e||5},i)},down:function(t,e,i){return this._animate(t,{z:-e||-5},i)},left:function(t,e,i){return this._animate(t,{x:-e||-5},i)},right:function(t,e,i){return this._animate(t,{x:e||5},i)},front:function(t,e,i){return this._animate(t,{y:e||5},i)},behind:function(t,e,i){return this._animate(t,{y:-e||-5},i)},animate:function(t,e,i){return this._animate(t,e,i)},revert:function(t,e){var i=e||this.models,o=i.map((function(t){return{x:t.default_lng,y:t.default_lat,z:t.default_hei}}));this._animate(i,0,t,o)},_animate:function(t,e,i,o){var n=0,a=this,r=e.x||0,l=e.y||0,u=e.z||0,s=o||t.map((function(t){var e=a._cartographic2(t._position._value,0);return{x:e[0]+r/1e5,y:e[1]+l/1e5,z:e[2]+u}})),d=function(){n++,t.forEach((function(t,e){var o=a._cartographic2(t._position._value,0),r=i||Math.tween.Cubic.easeInOut,l=r(n,o[0],s[e].x-o[0],100),u=r(n,o[1],s[e].y-o[1],100),d=r(n,o[2],s[e].z-o[2],100);o[0]=l,o[1]=u,o[2]=d,a.zmapgltf.changePosition(t,o,!1)})),n<100&&requestAnimationFrame(d)};d()},getGlObj:function(t,e){return{modelid:t,drotate:[0,0,-180],fcolor:"rgba(255,0,0,.5)",shadows:!0,url:e+t,dminimumPixelSize:1,dmaximumScale:1,ifFlyTo:!1}},getUps:function(t){var e=[];return this.models.forEach((function(i,o){t.forEach((function(t){t==i._id&&e.push(i)}))})),e},_cartographic:function(t){var e=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(t);return{lat:this.GmMap3D.Math.toDegrees(e.latitude),lng:this.GmMap3D.Math.toDegrees(e.longitude),hei:e.height}},_cartographic2:function(t,e){var i=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),o=GmMap3D.Math.toDegrees(i.latitude);return[GmMap3D.Math.toDegrees(i.longitude),o,i.height+(e||0)]},createDefaultUI:function(){return this._createDefaultDOM()._createDefaultStyle()._createDefaultBinding()},_createDefaultDOM:function(){var e=['\t<div class="zmap-toolbar">','\t\t<div class="bottom">','\t\t\t<input type="button" name="" id="" value="全部还原" onclick="javascript:modelTool.revert();"/>',"\t\t</div>","\t</div>"].join("");return t("body").append(e),this},_createDefaultStyle:function(){var e=["<style>","    \t.zmap-msg-panel-wapper {","\t\t\tpadding: 8px;","\t\t    text-align: center;","\t\t    font-size: 14px;","\t\t    color: white;","\t\t    transition: all .3s ease-in-out;","\t\t    z-index: 200;","\t\t}","\t\t.zmap-msg-panel {","\t\t\tdisplay: inline-block;","\t\t    pointer-events: all;","\t\t    padding: 8px 16px;","\t\t    border-radius: 4px;","\t\t    box-shadow: 0 1px 6px rgba(0,0,0,.2);","\t\t    background: #00e09e;","\t\t    position: relative;","\t\t}","\t\t.zmap-msg-panel-hide {","\t\t\theight: 0;","\t\t\tpadding: 0;","\t\t\topacity: 0;","\t\t}","</style>"].join(""),i=["<style>","\t\t.zmap-toolbar #toolbar {","\t\t\tbackground: rgba(42, 42, 42, 0.8);","\t\t    padding: 4px;","\t\t    border-radius: 4px;","\t\t    position: absolute;","\t\t    top: 10%;","\t\t    color: white;","\t\t    left: 2%;","\t\t    display: none;","\t    }","\t    .zmap-toolbar #toolbar input,.zmap-toolbar #toolbar select {","\t        vertical-align: middle;","\t        padding-top: 2px;","\t        padding-bottom: 2px;","\t    }","\t\t.zmap-toolbar #toolbar input[type='button']{","\t\t    width: 100%;","\t\t    background: transparent;","\t\t    outline: none;","\t\t    border: 1px solid white;","\t\t    color: white;","\t\t}","\t\t.zmap-toolbar #toolbar select{","\t\t\twidth: 55px;","\t\t}","\t\t.zmap-toolbar [readonly]{","\t\t\tbackground: #C3C3C3;","\t\t\tborder:1px solid white;","\t\t\toutline: none;","\t\t}","\t\t.zmap-toolbar .bottom {","\t\t \tposition: absolute;","\t\t \ttop: 3%;","\t\t \tleft: 2%;","\t\t }","\t\t ","\t\t.zmap-toolbar .bottom input[type='button'] {","\t\t \tborder: 1px solid white;","\t\t \tbackground: rgba(0, 0, 0, .5);","\t\t \tcolor: white;","\t\t \tpadding: 3px 5px 4px 5px;","\t\t \tcursor: pointer;","\t\t }","</style>"].join("");return t("head").append(e),t("head").append(i),this},_createDefaultBinding:function(){return this}};window.modelTool=e}(jQuery);