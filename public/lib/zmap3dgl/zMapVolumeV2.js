var Volumn,__extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();!function(t){var e,i,o=function(){function t(t,e,i){this.longitude=t,this.latitude=e,this.height=i}return t.prototype.toCartographic=function(t){return Cesium.Cartographic.fromDegrees(this.longitude,this.latitude,this.height)},t.prototype.toCartesian3=function(t){return Cesium.Cartesian3.fromDegrees(this.longitude,this.latitude,this.height)},t.fromDegrees=function(e,i,o){return new t(e,i,o)},t.fromRadians=function(e,i,o){return new t(Cesium.Math.toDegrees(e),Cesium.Math.toDegrees(i),o)},t.formCartographic=function(t){return this.fromRadians(t.longitude,t.latitude,t.height)},t.fromCartesian3=function(e){var i=new t;return Cesium.Cartographic.fromCartesian(e,void 0,i),i.longitude=Cesium.Math.toDegrees(i.longitude),i.latitude=Cesium.Math.toDegrees(i.latitude),i},t}(),n=function(){function t(t,e,i,n,s,r){this.xmin=t,this.ymin=e,this.zmin=i,this.zmax=n,this.ymax=s,this.zmax=r,this.center=[(n+t)/2,(s+e)/2,(r+i)/2],this.size=[n-t,s-e,r-i],this.from=new o(t,e,i),this.to=new o(n,s,r)}return t.fromStartEnd=function(e,i){return new t(e.longitude,e.latitude,e.height,i.longitude,i.latitude,i.height)},t}(),s=function(){function t(t){this._default={lineWidth:15,pointSize:10,lineColor:Cesium.Color.CORAL,pointColor:Cesium.Color.DEEPSKYBLUE,textColor:Cesium.Color.DEEPSKYBLUE},this.viewer=t}return Object.defineProperty(t.prototype,"defaultOpt",{get:function(){return this._default},set:function(t){this._default=Object.assign(this._default,t)},enumerable:!0,configurable:!0}),t.prototype.addPloyline=function(t,e){var i=Object.assign(this.getDefault(),e);return this.viewer.entities.add({polyline:{positions:t,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.2,color:i.lineColor}),width:i.lineWidth,clampToGround:!1}})},t.prototype.getDefault=function(){return this._default},t.prototype.addPoint=function(t,e,i){var o=this,n=Object.assign(this.getDefault(),i);return t.map((function(t){return o.viewer.entities.add({position:t,point:{pixelSize:n.pointSize,color:n.pointColor},label:e})}))},t.prototype.addPointWithLongitude=function(t,e){var i=this,o=Object.assign(this.getDefault(),e);return t.map((function(t){return i.viewer.entities.add({position:t,point:{pixelSize:o.pointSize,color:o.pointColor},label:{text:"\n\n\n\n"+(Cesium.Cartographic.fromCartesian(t).longitude/Math.PI*180).toFixed(1),font:"16px sans-serif",fillColor:o.textColor}})}))},t.prototype.addPointWithLatitude=function(t,e){var i=this,o=Object.assign(this.getDefault(),e);return t.map((function(t){return i.viewer.entities.add({position:t,point:{pixelSize:o.pointSize,color:o.pointColor},label:{text:"\n\n"+(Cesium.Cartographic.fromCartesian(t).latitude/Math.PI*180).toFixed(1),font:"16px sans-serif",fillColor:o.textColor}})}))},t.prototype.addSinglePointWithText=function(t,e,i){var o=Object.assign(this.getDefault(),i);return this.viewer.entities.add({position:t,point:{pixelSize:o.pointSize,color:o.pointColor},label:{text:e,font:"16px sans-serif",fillColor:o.textColor}})},t}(),r=function(){function t(t,e){this.tool=a,this._show=!0,this.viewer=t.cesium.viewer,this.scene=t.cesium.scene,this.box=e,this.entityTool=new s(this.viewer)}return Object.defineProperty(t.prototype,"show",{get:function(){return this._show},set:function(t){this._show=t,this.onShowChanged(t)},enumerable:!0,configurable:!0}),t}(),a=(function(t){function e(e,i,o){var n=t.call(this,e,i)||this;n.xSteps=[],n.ySteps=[],n.zSteps=[],n.gridLine=[],n.scale=[1,1,1];return n.opt=Object.assign({stepX:1,stepY:1,stepZ:100,useOrigin:!1},o),n.entityTool=new s(n.viewer),n.opt.style&&(n.style=n.opt.style),n.init(),n}__extends(e,t),Object.defineProperty(e.prototype,"style",{get:function(){return this.entityTool.getDefault()},set:function(t){this.entityTool.defaultOpt=t,this.update(this.box)},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this.box=t,this.destroy(),this.init(),this.show=!!this.show},e.prototype.clean=function(){},e.prototype.binding=function(){},e.prototype.init=function(){var t=this.box,e=t.xmin,i=t.ymin,o=t.zmin,n=t.xmax,s=t.ymax,r=t.zmax,a=Math.abs(r-o);this.xSteps=this.computeMiddleSpacing(e,n,this.opt.stepX),this.ySteps=this.computeMiddleSpacing(i,s,this.opt.stepY),this.zSteps=a&&this.opt.stepZ?this.computeMiddleSpacing(o,r,this.opt.stepZ):[],this.createGrid()},e.prototype.onShowChanged=function(t){this.gridLine.forEach((function(e){e.show=t}))},e.prototype.computeMiddleSpacing=function(t,e,i){for(var o=[],n=e-t,s=0;s<n/i;s++)o.push(i*s);return n%i!=0&&o.push(n),o},e.prototype.createGrid=function(){return this.gridLine=this.gridLine.concat(this._vertical(),this._justify())},e.prototype._vertical=function(){var t=this,e=this.box.from,i=[];return this.xSteps.forEach((function(n,s){var r=t.ySteps.map((function(i){var s=t.tool.cartographicAdd(e,new o(n,i,0));return t.tool.c3ByDegrees(s)}));0===s&&(i=(i=i.concat(t._verticalZ(r))).concat(t.entityTool.addPointWithLatitude(r))),i.push(t.entityTool.addPloyline(r))})),i},e.prototype._justify=function(){var t=this,e=this.box.from,i=[];return this.ySteps.forEach((function(n,s){var r=t.xSteps.map((function(i){var s=t.tool.cartographicAdd(e,new o(i,n,0));return t.tool.c3ByDegrees(s)}));0===s&&(i=(i=i.concat(t._verticalZ(r))).concat(t.entityTool.addPointWithLongitude(r))),i.push(t.entityTool.addPloyline(r))})),i},e.prototype._verticalZ=function(t){var e=this,i=[],o=this.opt.useOrigin?this.scale[2]:1;return this.zSteps.forEach((function(n){i.push(e.entityTool.addPloyline(t.map((function(t){var i=e.tool.c3ToCartographic(t);return i.height+=n,e.tool.c3ByRadians(i)}))));var s=e.tool.c3ToCartographic(t[0]);s.height+=n,i.push(e.entityTool.addSinglePointWithText(e.tool.c3ByRadians(s),(s.height/o).toFixed(1)+"m\n\n"))})),i},e.prototype.destroy=function(){var t=this.viewer.entities;this.gridLine.forEach((function(e){t.remove(e)})),this.gridLine=[]}}(r),function(t){function e(e,i,o){var n=t.call(this,e,i)||this;return n.opt=Object.assign({sliceSize:20},o),n.planes={xoy:null,xoz:null,yoz:null,xoy_offset:.5,xoz_offset:.5,yoz_offset:.5},n.opt.style?n.style=n.opt.style:n.init(),n}__extends(e,t),Object.defineProperty(e.prototype,"style",{get:function(){return this.entityTool.getDefault()},set:function(t){this.entityTool.defaultOpt=t,this.destroy(),this.update(this.box)},enumerable:!0,configurable:!0}),e.prototype.init=function(){var t=this;return h&&!this.sliceControl&&(this.sliceControl=new h(this,null,this.opt)),this.height=Math.abs(this.box.zmax-this.box.zmin),this.xoy=this._getScalePoint("xoy",this.planes.xoy_offset),this.xoz=this._getScalePoint("xoz",this.planes.xoz_offset),this.yoz=this._getScalePoint("yoz",this.planes.yoz_offset),this.planes.xoy=this.entityTool.addPloyline(this.tool.fromDegreesArrayWithHeight(this.xoy)),this.planes.xoz=this.entityTool.addPloyline(this.tool.fromDegreesArrayWithHeight(this.xoz)),this.planes.yoz=this.entityTool.addPloyline(this.tool.fromDegreesArrayWithHeight(this.yoz)),this.planes.xoy.polyline.positions=new Cesium.CallbackProperty((function(){return t.tool.fromDegreesArrayWithHeight(t.xoy)}),!1),this.planes.xoz.polyline.positions=new Cesium.CallbackProperty((function(){return t.tool.fromDegreesArrayWithHeight(t.xoz)}),!1),this.planes.yoz.polyline.positions=new Cesium.CallbackProperty((function(){return t.tool.fromDegreesArrayWithHeight(t.yoz)}),!1),this.planes},e.prototype.update=function(t){this.box=t,this.destroy(),this.init(),this.show=!!this.show},e.prototype.clean=function(){},e.prototype.destroy=function(){for(var t=0,e=["xoy","xoz","yoz"];t<e.length;t++){var i=e[t];this.planes[i]&&this.viewer.entities.remove(this.planes[i])}},e.prototype.binding=function(t){this.vol=t},Object.defineProperty(e.prototype,"control",{get:function(){return this.sliceControl},set:function(t){this.sliceControl.destroy(),this.sliceControl=t},enumerable:!0,configurable:!0}),e.prototype._getScalePoint=function(t,e){var i=this.box,o=i.xmin,n=i.ymin,s=i.zmin,r=i.xmax,h=i.ymax,l=i.zmax,c=s+(l-s)*e,u=o+(r-o)*e,p=n+(h-n)*e,_=this.opt.sliceSize;return"xoy"===t?[o,n,c].concat(a.expansion([o,h,c],[r,h,c],_),a.expansion([r,n,c],[o,n,c],_)):"yoz"===t?[u,n,s].concat(a.expansion([u,n,l],[u,h,l],_),a.expansion([u,h,s],[u,n,s],_)):"xoz"===t?[o,p,s].concat(a.expansion([o,p,l],[r,p,l],_),a.expansion([r,p,s],[o,p,s],_)):void 0},Object.defineProperty(e.prototype,"offset",{get:function(){return this.planes},set:function(t){var e=this;["xoy_offset","xoz_offset","yoz_offset"].forEach((function(i){if(i in t){var o=Math.max(t[i],0);o=Math.min(t[i],1),e.planes[i]=o,e.resetPlane(i,o)}})),this.vol&&this.vol.setSlice({z:t.xoy_offset,y:t.xoz_offset,x:t.yoz_offset})},enumerable:!0,configurable:!0}),e.prototype.onShowChanged=function(t){var e=this;t=!!t,["xoy","xoz","yoz"].forEach((function(i){e.planes[i].show=t})),this.sliceControl&&document.querySelectorAll(".scroll-control3D").forEach((function(e){e.style.visibility=t?"visible":"hidden"}))},e.prototype.resetPlane=function(t,e){var i=t.slice(0,3);this[i]=this._getScalePoint(i,e)},e.prototype.showPlane=function(t,e){if(this.planes[t])return this.planes[t].show=e}}(r),function(t){function e(e,i,o){var n=t.call(this,e,i)||this;return n.opt=Object.assign({sliceSize:20},o),n.points=[],n.opt.style&&(n.style=n.opt.style),n.planes={},n.init(),n}__extends(e,t),Object.defineProperty(e.prototype,"style",{get:function(){return this.entityTool.getDefault()},set:function(t){this.entityTool.defaultOpt=t,this.update(this.box)},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this.box=t,this.destroy(),this.init(),this.show=!!this.show},e.prototype.clean=function(){},e.prototype.binding=function(t){this.vol=t},e.prototype.destroy=function(){var t=this.viewer.entities;for(var e in this.planes)t.remove(this.planes[e]);this.points&&this.points.forEach((function(e){t.remove(e)})),this.planes={},this.points=[]},e.prototype.init=function(){var t=this;this.height=Math.abs(this.box.zmax-this.box.zmin),this._getPoints();var e=this.eightPoint;return this.copy_to=this.tool.c3ByDegrees(this.box.to),this.copy_from=this.tool.c3ByDegrees(this.box.from),this.planes.p_top=this.entityTool.addPloyline(a.expansionC3(e.$001,e.$101,this.opt.sliceSize).concat(a.expansionC3(e.$111,e.$011,this.opt.sliceSize),[e.$001])),this.planes.p_left=this.entityTool.addPloyline([e.$000,e.$010,e.$011,e.$001,e.$000]),this.planes.p_right=this.entityTool.addPloyline([e.$100,e.$110,e.$111,e.$101,e.$100]),this.planes.p_bottom=this.entityTool.addPloyline(a.expansionC3(e.$000,e.$100,this.opt.sliceSize).concat(a.expansionC3(e.$110,e.$010,this.opt.sliceSize),[e.$000])),this.planes.p_front=this.entityTool.addPloyline(a.expansionC3(e.$000,e.$100,this.opt.sliceSize).concat(a.expansionC3(e.$101,e.$001,this.opt.sliceSize),[e.$000])),this.planes.p_behind=this.entityTool.addPloyline(a.expansionC3(e.$010,e.$110,this.opt.sliceSize).concat(a.expansionC3(e.$111,e.$011,this.opt.sliceSize),[e.$010])),this.planes.p_top.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return a.expansionC3(e.$001,e.$101,t.opt.sliceSize).concat(a.expansionC3(e.$111,e.$011,t.opt.sliceSize),[e.$001])}),!1),this.planes.p_left.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return[e.$000,e.$010,e.$011,e.$001,e.$000]}),!1),this.planes.p_right.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return a.expansionC3(e.$000,e.$100,t.opt.sliceSize).concat(a.expansionC3(e.$110,e.$010,t.opt.sliceSize),[e.$000])}),!1),this.planes.p_bottom.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return a.expansionC3(e.$000,e.$100,t.opt.sliceSize).concat(a.expansionC3(e.$110,e.$010,t.opt.sliceSize),[e.$000])}),!1),this.planes.p_front.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return a.expansionC3(e.$000,e.$100,t.opt.sliceSize).concat(a.expansionC3(e.$101,e.$001,t.opt.sliceSize),[e.$000])}),!1),this.planes.p_behind.polyline.positions=new Cesium.CallbackProperty((function(){var e=t.eightPoint;return a.expansionC3(e.$010,e.$110,t.opt.sliceSize).concat(a.expansionC3(e.$111,e.$011,t.opt.sliceSize),[e.$010])}),!1),this.points=this.entityTool.addPoint(this.sixPoint),this.handler(),this.planes},e.prototype._getPoints=function(t,e){t=t||this.box.from,e=e||this.box.to;var i=t.longitude,o=t.latitude,n=t.height,s=e.longitude,r=e.latitude,a=e.height,h=(s+i)/2,l=(r+o)/2,c=(a+n)/2,u=this._createLLH(i,o,n),p=this._createLLH(s,o,n),_=this._createLLH(s,r,n),m=this._createLLH(i,r,n),f=this._createLLH(i,o,a),d=this._createLLH(s,o,a),y=this._createLLH(i,r,a),g=this._createLLH(s,r,a),x=this._createLLH(h,l,a),C=this._createLLH(i,l,c),v=this._createLLH(s,l,c),b=this._createLLH(h,l,n),w=this._createLLH(h,o,c),P=this._createLLH(h,r,c);return this.eightPoint={$000:u,$100:p,$110:_,$010:m,$001:f,$101:d,$011:y,$111:g},this.sixPoint=[x,C,v,b,w,P],[f,d,g,y,u,p,_,m,x,C,v,b,w,P]},e.prototype._setPoints=function(t){var e,i,o=this,n=this.tool.c3ToCartographicDegrees(t);Cesium.Cartesian3.subtract(t,this.sixPoint[this.movingPointIndex],new Cesium.Cartesian3);switch(this.movingPointIndex){case 0:(e=this.tool.c3ToCartographicDegrees(this.copy_to)).height=Math.max(Math.min(n.height,this.box.to.height),this.box.from.height),this.copy_to=this.tool.c3ByDegrees(e);break;case 2:(e=this.tool.c3ToCartographicDegrees(this.copy_to)).longitude=Math.max(Math.min(n.longitude,this.box.to.longitude),this.box.from.longitude),this.copy_to=this.tool.c3ByDegrees(e);break;case 5:(e=this.tool.c3ToCartographicDegrees(this.copy_to)).latitude=Math.max(Math.min(n.latitude,this.box.to.latitude),this.box.from.latitude),this.copy_to=this.tool.c3ByDegrees(e);break;case 1:(i=this.tool.c3ToCartographicDegrees(this.copy_from)).longitude=Math.min(Math.max(n.longitude,this.box.from.longitude),this.box.to.longitude),this.copy_from=this.tool.c3ByDegrees(i);break;case 3:(i=this.tool.c3ToCartographicDegrees(this.copy_from)).height=Math.min(Math.max(n.height,this.box.from.height),this.box.to.height),this.copy_from=this.tool.c3ByDegrees(i);break;case 4:(i=this.tool.c3ToCartographicDegrees(this.copy_from)).latitude=Math.min(Math.max(n.latitude,this.box.from.latitude),this.box.to.latitude),this.copy_from=this.tool.c3ByDegrees(i)}var s=this.tool.c3ToCartographicDegrees(this.copy_from),r=this.tool.c3ToCartographicDegrees(this.copy_to),h=this._getPoints(s,r);if(this.points.forEach((function(t,e){t.position=o.sixPoint[e]})),this.vol){var l=this.tool.c3ByDegrees(this.box.from);this.vol.range={minHeight:s.height,minLongitude:Math.abs(a.pointPlaneInstance(h[4],h[5],l)),maxLatitude:Math.abs(a.pointPlaneInstance(h[7],h[4],l)),maxHeight:r.height,maxLongitude:Math.abs(a.pointPlaneInstance(h[5],h[4],l)),minLatitude:Math.abs(a.pointPlaneInstance(h[4],h[7],l))}}},e.prototype._createLLH=function(t,e,i){return Cesium.Cartesian3.fromDegrees(t,e,i)},e.prototype.handler=function(){var t=this;this.control=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);var e=this.control,i=(new Date).getTime();e.setInputAction((function(e){t.moving=!0,t.pointDraged=t.viewer.scene.pick(e.position),t.leftDownFlag=!0,t.pointDraged&&(t.movingPointIndex=t.points.indexOf(t.pointDraged.id),t.movingPointIndex>-1&&(t.viewer.scene.screenSpaceCameraController.enableRotate=!1))}),Cesium.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction((function(e){t.moving=!1,t.leftDownFlag=!1,t.pointDraged&&(t.pointDraged=null,t.viewer.scene.screenSpaceCameraController.enableRotate=!0)}),Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction((function(e){if(!(Date.now()-i<50)){if(t.hoverHandler(e),!0===t.leftDownFlag&&null!=t.pointDraged){var o=t.viewer.camera.getPickRay(e.endPosition),n=t.points[t.movingPointIndex];if(!n)return;var s=t.getPlaneIntersect(n.position._value,o),r=t._getAxisCarsian(t.tool.c3ToCartographicDegrees(n.position._value),s);t._setPoints(r)}i=Date.now()}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)},e.prototype.hoverHandler=function(t){var e=this;if(!this.leftDownFlag){this.viewer.camera.getPickRay(t.endPosition);var i=this.viewer.scene.pick(t.endPosition);i&&i.id&&i.id.point?i.id.point.pixelSize=1.5*this.style.pointSize:this.points.forEach((function(t){t.point.pixelSize=e.style.pointSize}))}},e.prototype.getPlaneIntersect=function(t,e){var i=this,o=t,n={},s=new Cesium.Cartesian3(0,0,0);return[{name:"xOz",PHR:{heading:90,pitch:0}},{name:"yOz",PHR:{heading:0,pitch:0}},{name:"xOy",PHR:{heading:0,pitch:90}}].forEach((function(t){var r=i.rotate(o,t.PHR),a=Cesium.Cartesian3.subtract(r,o,s),h=Cesium.Cartesian3.normalize(a,s),l=Cesium.Plane.fromPointNormal(o,h),c=Cesium.IntersectionTests.rayPlane(e,l);n[t.name]=i.tool.c3ToCartographicDegrees(c||o)})),n},e.prototype._getAxisCarsian=function(t,e){var i;switch(this.movingPointIndex){case 1:case 2:return i=e.xOz,Cesium.Cartesian3.fromDegrees(i.longitude,t.latitude,t.height);case 4:case 5:return i=e.yOz,Cesium.Cartesian3.fromDegrees(t.longitude,i.latitude,t.height);case 0:case 3:return i=e[this._viewerPlane()],Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,i.height)}},e.prototype._viewerPlane=function(){var t=this.viewer.scene.camera;return t.heading>.75*Math.PI&&t.heading<1.75*Math.PI?"xOz":"yOz"},e.prototype.rotate=function(t,e){var i=Cesium.Math.toRadians(e.heading),o=Cesium.Math.toRadians(e.pitch),n=new Cesium.HeadingPitchRoll(i,o,0),s=Cesium.Transforms.headingPitchRollToFixedFrame(t,n),r=new Cesium.Cartesian3(300,0,0);return Cesium.Matrix4.multiplyByPoint(s,r,new Cesium.Cartesian3)},e.prototype.onShowChanged=function(t){for(var e in this.points.forEach((function(e){e.show=t})),this.planes)this.planes[e].show=t}}(r),function(){function t(){}return t.c3ToCartographic=function(t){return Cesium.Cartographic.fromCartesian(t)},t.c3ToCartographicDegrees=function(t){var e=Cesium.Cartographic.fromCartesian(t);return this.cartographic2CartographicDegrees(e)},t.cartographic2CartographicDegrees=function(t){return o.formCartographic(t)},t.c3ByDegrees=function(t,e){return t.toCartesian3(e)},t.c3ByRadians=function(t){return Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height)},t.fromDegreesArrayWithHeight=function(t){for(var e=[],i=0;i<t.length;i+=3)e.push(Cesium.Cartesian3.fromDegrees(t[i],t[i+1],t[i+2]));return e},t.radians2Degrees=function(t){return Cesium.Math.toDegrees(t)},t.degrees2Radians=function(t){return Cesium.Math.toRadians(t)},t.cartographicAdd=function(t,e){return new o(t.longitude+e.longitude,t.latitude+e.latitude,Math.max(t.height,e.height))},t.expansion=function(t,e,i){for(var o=(e[0]-t[0])/i,n=(e[1]-t[1])/i,s=(e[2]-t[2])/i,r=[],a=0;a<i;a++)a===i-1?r.push.apply(r,e):r.push(t[0]+o*a,t[1]+n*a,t[2]+s*a);return r},t.expansionC3=function(e,i,o){var n=Cesium.Cartographic.fromCartesian(e),s=Cesium.Cartographic.fromCartesian(i),r=[Cesium.Math.toDegrees(n.longitude),Cesium.Math.toDegrees(n.latitude),n.height],a=[Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude),s.height];return Cesium.Cartesian3.fromDegreesArrayHeights(t.expansion(r,a,o))},t.mergeMax=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t[0].longitude,n=t[0].latitude,s=t[0].height,r=0,a=t.length;r<a;r++)i=Math.max(i,t[r].longitude),n=Math.max(n,t[r].latitude),s=Math.max(s,t[r].height);return new o(i,n,s)},t.mergeMin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t[0].longitude,n=t[0].latitude,s=t[0].height,r=0,a=t.length;r<a;r++)i=Math.min(i,t[r].longitude),n=Math.min(n,t[r].latitude),s=Math.min(s,t[r].height);return new o(i,n,s)},t.pointPlaneInstance=function(t,e,i){var o=Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3(0,0,0)),n=Cesium.Cartesian3.normalize(o,new Cesium.Cartesian3(0,0,0)),s=Cesium.Plane.fromPointNormal(t,n);return Cesium.Plane.getPointDistance(s,i)},t}()),h=function(){function t(t,e,i){this.slice=t,this.opt=i||{},"string"==typeof e?this.root=document.querySelector(e):"object"==typeof e&&e instanceof HTMLElement?this.root=e:this.root=this._createRoot(),this._createChild(),this.init(),this.bindingEvent(),this._x=.5,this._y=.5,this._z=.5}return t.prototype.init=function(){var t=this;this.inited||(this.root.classList.add("scroll-control3D"),this.root.setAttribute("data-allow","volume"),this.root.addEventListener("click",(function(e){if("span"===e.target.tagName.toLowerCase()){var i={X:"yoz",Y:"xoz",Z:"xoy"}[e.target.innerHTML];"active"===e.target.className?(e.target.className="",t.slice.showPlane(i,!0)):(e.target.className="active",t.slice.showPlane(i,!1)),"function"==typeof t.opt.buttonClick&&t.opt.buttonClick(e,i,"active"===e.target.className?"show":"hide")}e.stopPropagation()})),this.inited=!0)},t.prototype._createRoot=function(){var t=document.createElement("div");return document.body.appendChild(t),t},t.prototype._createChild=function(){this.root.innerHTML=this._createChildEle("X")+this._createChildEle("Y")+this._createChildEle("Z")},t.prototype._createChildEle=function(t){return'\n            <div class="control3D">\n                <span>'+t+'</span>\n                <div class="scroll" id="scrollBar'+t+'">\n                    <div class="bar"></div>\n                    <div class="mask"></div>\n                </div>\n            </div>\n'},t.prototype.bindingEvent=function(){var t=this;"function"!=typeof this.opt.move&&(this.opt.move=function(){}),this._createBar({el:"#scrollBarX",move:function(e){t._sliceOffset("_x",e),t.opt.move(e,"X","move")},end:function(e){t._sliceOffset("_x",e),t.opt.move(e,"X","end")}}),this._createBar({el:"#scrollBarY",move:function(e){t._sliceOffset("_y",e),t.opt.move(e,"Y","move")},end:function(e){t._sliceOffset("_y",e),t.opt.move(e,"Y","end")}}),this._createBar({el:"#scrollBarZ",move:function(e){t._sliceOffset("_z",e),t.opt.move(e,"Z","move")},end:function(e){t._sliceOffset("_z",e),t.opt.move(e,"Z","end")}})},t.prototype._sliceOffset=function(t,e){this[t]=e.scale,this.slice.offset={yoz_offset:this._x,xoz_offset:this._y,xoy_offset:this._z}},t.prototype._createBar=function(t){var e=this.root.querySelector(t.el),i=e.children[0],o=e.children[1],n=(new Date).getTime();i.onmousedown=function(i){var s=i.clientX-this.offsetLeft,r=this;document.onmousemove=function(i){var a=(new Date).getTime();if(!(a-n<17)){n=a,r.style.left=i.clientX-s+"px";var h=parseInt(r.style.left);h<0?r.style.left=0:h>382&&(r.style.left="382px"),o.style.width=r.style.left,"function"==typeof t.move&&t.move({type:"move",scrollBar:e,elText:t.el,scale:parseInt(r.style.left)/382})}},document.onmouseup=function(){"function"==typeof t.end&&t.end({type:"end",scrollBar:e,elText:t.el,scale:parseInt(r.style.left)/382}),document.onmousemove=null,document.onmouseup=null}}},t.prototype.destroy=function(){this.root.parentNode.removeChild(this.root),this.slice=null,this.opt=null},t}();!function(t){t[t.GLOBE=0]="GLOBE",t[t.BOX=1]="BOX"}(e||(e={})),function(t){t[t.GLOBE_VOLUME=1]="GLOBE_VOLUME",t[t.GLOBE_SLICE=2]="GLOBE_SLICE",t[t.BOX_VOLUME=3]="BOX_VOLUME",t[t.BOX_SLICE=4]="BOX_SLICE"}(i||(i={}));!function(t){function o(i,o,s,r){var a=t.call(this,i,n.fromStartEnd(o,s))||this;if(a._BoxSizeInMeter=new Cesium.Cartesian3,a._boxMatrix=new Cesium.Matrix4,a._boxMatrixInv=new Cesium.Matrix4,r=r||{},a._box=new n(a.box.from.longitude,a.box.from.latitude,a.box.from.height,a.box.to.longitude,a.box.to.latitude,a.box.to.height),a._name=r.name?r.name:"Volume_TimeStap_"+Date.now(),a._sliceNum=r.sliceNum?r.sliceNum:[8,8],a._scale=r.scale?r.scale:[1,1,1],a._offset=r.offset?r.offset:[0,0,0],a._url=r.url?r.url:"BaseWhite",a._color=r.colorMap,a._line=[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],a._bindings=[],a._handlers={},a._vol={pri:null,apprance:null,mat:null},a._sect={pri:[],apprance:null,mat:null},r.filterParam&&(a.filterParam=r.filterParam||{}),a._loadImage(a._url),a._sectpri=[],a._mode=r&&r.mode===e.GLOBE?e.GLOBE:e.BOX,l&&!a._filterControl){var h=Object.assign({split_X:4,split_Y:2,tolerance:3,min_X:0,max_X:1e3,max_Y:1e3,min_Y:0},a.filterParam||{}),c=document.createElement("div");c.className="analysis",c.setAttribute("data-allow","volume"),document.body.appendChild(c),a._filterControl=new l(c,h),a._filterControl.onchangestatus=function(t,e){},a._filterControl.onchangestatus_over=function(t,e){a.filterLine=e.flat().slice(0,16).map((function(t,e){return e%2==0?t/h.max_X:t/h.max_Y}))}}return a}__extends(o,t),Object.defineProperty(o.prototype,"visible",{get:function(){return this.show},set:function(t){this.show=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"box",{get:function(){return this._box},set:function(t){this._box=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this._calcParam(),this.update(this._rbox)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset=t,this._calcParam(),this.update(this._rbox)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"filterLine",{get:function(){return this._line},set:function(t){if(this._line=t,t.length>16&&(t.length=16),t.length<16)for(var e=t.length;e<16;++e)t[e]=16;Array.isArray(t)&&(this._vol.mat&&(this._vol.mat.uniforms.u_VolFilterLine=t),this._sect.mat&&(this._sect.mat.uniforms.u_VolFilterLine=t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sliceVisble",{set:function(t){this._sectpri.forEach((function(e){e.show=!!t}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sliceXVisble",{set:function(t){this._sectpri[0].show=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sliceYVisble",{set:function(t){this._sectpri[1].show=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sliceZVisble",{set:function(t){this._sectpri[2].show=!!t},enumerable:!0,configurable:!0}),o.prototype.initShader=function(){},o.prototype.update=function(t){var e=this;this._calcParam(),this._bindings.forEach((function(t){t.update(e._rbox)}))},o.prototype.clean=function(){},o.prototype._loadImage=function(t){var e=this;this._VolDataLoaded=!1,this._VolImage=this._VolImage||new Image,this._VolImage.src=t,this._VolImage.crossOrigin="anonymous",this._VolImage.onload=function(){return e._VolDataLoaded=!0},this._VolImage.onerror=function(){throw e._VolDataLoaded=!1,new Error("体数据模型地址无效")}},o.prototype.binding=function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];if(!(i instanceof r))throw Error("请传入实现_Comon接口的实例");this._bindings.push(i),i.binding(this)}},o.prototype.on=function(t,e){t in this._handlers||(this._handlers[t]=[]);var i=Date.now();return this._handlers[t].push({handler:e,id:i}),i},o.prototype.off=function(t,e){if(t)if(e){if(this._handlers[t])for(var i=this._handlers[t],o=0;o<i.length;o++)if(i[o].id===e){i.splice(o,1);break}}else this._handlers[t]=[];else this._handlers={}},o.prototype.emit=function(t,e){for(var i=this._handlers[t],o=0;o<i.length;o++)"function"==typeof i[o].handler&&i[o].handler(t,e)},o.prototype._DelayInvoke=function(t,i){for(var o=this,n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(this._VolDataLoaded)return this._mode===e.GLOBE?t.call(this,n):i.call(this,n);setTimeout((function(){return o._DelayInvoke(t,i)}))},o.prototype._createAppearance=function(t,e,o,n,s){var r={u_SliceNumXf:this._sliceNum[0],u_SliceNumYf:this._sliceNum[1],u_CubeTex:this._VolImage,u_ColorTex:this._color,u_InvWorldMat:Cesium.Matrix4.toArray(s),u_VolBoxMin:e,u_VolBoxMax:o,u_VolClipMin:new Cesium.Cartesian3(0,0,0),u_VolClipMax:new Cesium.Cartesian3(1,1,1),u_VolBoxRadius:n,u_VolFilterLine:this._line},a=t===i.BOX_SLICE||t===i.GLOBE_SLICE,h="#define ZMAP_MODE "+t+"\n\n#line 0"+this.shader.materialShader,l={material:new Cesium.Material({translucent:!0,fabric:{type:"ZMapVolume",source:h,uniforms:r}}),vertexShaderSource:this.shader.vertexShader,fragmentShaderSource:this.shader.fragmentShader,translucent:!0,faceForward:!0,closed:!1,renderState:{cull:{enabled:!a,face:Cesium.CullFace.BACK}}};return new Cesium.MaterialAppearance(l)},o.prototype.setVolume=function(){this._DelayInvoke(this._setVolumeOnGlobe,this._setVolumeOnBox)},o.prototype._setVolumeOnBox=function(){var t=this.viewer;this._calcParam(),this._vol.apprance=this._createAppearance(i.BOX_VOLUME,Cesium.Cartesian3.ZERO,this._BoxSizeInMeter,0,this._boxMatrixInv),this._vol.mat=this._vol.apprance.material;var e=new Cesium.BoxGeometry({maximum:this._BoxSizeInMeter,minimum:Cesium.Cartesian3.ZERO}),o=Cesium.BoxGeometry.createGeometry(e);this._vol.pri&&t.scene.primitives.remove(this._vol.pri),this._vol.pri=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:o,modelMatrix:this._boxMatrix,id:this._name}),asynchronous:!1,appearance:this._vol.apprance}),t.scene.primitives.add(this._vol.pri)},o.prototype._setVolumeOnGlobe=function(){var t=this.viewer,e=(this._calcParam(),this._rbox),o=e.xmin,n=e.xmax,s=e.ymin,r=e.ymax,a=e.zmin,h=e.zmax,l=new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(o,s,n,r),height:a,extrudedHeight:h}),c=Cesium.RectangleGeometry.createGeometry(l);this._vol.apprance=this._createAppearance(i.GLOBE_VOLUME,new Cesium.Cartesian3(o,s,a),new Cesium.Cartesian3(n,r,h),this._boundRadius,this._boxMatrixInv),this._vol.mat=this._vol.apprance.material,this._vol.pri&&t.scene.primitives.remove(this._vol.pri),this._vol.pri=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:c,id:this._name}),asynchronous:!1,appearance:this._vol.apprance}),t.scene.primitives.add(this._vol.pri)},o.prototype.setSlice=function(t){var e=this,i=this.viewer;this._vol.pri&&(this._vol.pri.show=!1),this._sectpri.forEach((function(t,o){t&&!1!==t.show&&(i.scene.primitives.remove(t),e._sectpri[o]=null)})),this._DelayInvoke(this.setSliceOnGlobe,this._setSliceOnBox,t)},o.prototype._setSliceOnBox=function(t){var e=this.viewer;this._calcParam();var o=this._BoxSizeInMeter,n=o.x,s=o.y,r=o.z;this._sect.apprance||(this._sect.apprance=this._createAppearance(i.BOX_SLICE,Cesium.Cartesian3.ZERO,this._BoxSizeInMeter,0,this._boxMatrixInv),this._sect.mat=this._sect.apprance.material);var a=new Uint32Array([0,1,3,3,2,0]),h=[];if(void 0!==t.x){var l=t.x*n;h[0]={position:new Float64Array([l,0,0,l,s,0,l,0,r,l,s,r]),normal:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),name:"lonSection"}}if(void 0!==t.y){var c=t.y*s;h[1]={position:new Float64Array([0,c,0,n,c,0,0,c,r,n,c,r]),normal:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),name:"latSection"}}if(void 0!==t.z){var u=t.z*r;h[2]={position:new Float64Array([0,0,u,n,0,u,0,s,u,n,s,u]),normal:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),name:"heiSection"}}for(var p=0;p<h.length;p++){var _=h[p],m=new Cesium.GeometryAttributes;m.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:_.position}),m.normal=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_.normal});var f=new Cesium.Geometry({attributes:m,indices:a,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(_.position)}),d=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:f,id:_.name,modelMatrix:this._boxMatrix}),asynchronous:!1,appearance:this._sect.apprance});this._sectpri[p]=d,e.scene.primitives.add(d)}},o.prototype.setSliceOnGlobe=function(t){var e=this.viewer;this._calcParam();var o=this._rbox,n=o.xmin,s=o.ymin,r=o.zmin,a=o.xmax,h=o.ymax,l=o.zmax,c=n+t.x*(a-n),u=s+t.y*(h-s),p=r+t.z*(l-r);this._sect.apprance||(this._sect.apprance=this._createAppearance(i.GLOBE_SLICE,new Cesium.Cartesian3(n,s,r),new Cesium.Cartesian3(a,h,l),0,this._boxMatrixInv),this._sect.mat=this._sect.apprance.material);var _=["lonSection","latSection","heiSection"],m=[null,null,null];if(!this._sectpri[0]){var f=Cesium.WallGeometry.fromConstantHeights({positions:Cesium.Cartesian3.fromDegreesArray([c,s,c,h]),minimumHeight:r,maximumHeight:l});m[0]=Cesium.WallGeometry.createGeometry(f)}if(!this._sectpri[1]){var d=Cesium.WallGeometry.fromConstantHeights({positions:Cesium.Cartesian3.fromDegreesArray([n,u,a,u]),minimumHeight:r,maximumHeight:l});m[1]=Cesium.WallGeometry.createGeometry(d)}if(!this._sectpri[2]){var y=new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(n,s,a,h),height:p});m[2]=Cesium.RectangleGeometry.createGeometry(y)}for(var g=0;g<3;g++)if(!this._sectpri[g]){var x=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:m[g],id:_[g],attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.TRANSPARENT)}}),asynchronous:!1,appearance:this._sect.apprance});this._sectpri[g]=x,e.scene.primitives.add(x)}},o.prototype.reset=function(){return this._scale=[1,1,1],this._offset=[0,0,0],this.setVolume()},o.prototype.onShowChanged=function(t){},o.prototype.destroy=function(){var t=this.viewer.scene.primitives;this._vol.pri&&(t.remove(this._vol.pri),this._vol.pri=null),this._sectpri.forEach((function(e){t.remove(e)})),this._sectpri=[]},Object.defineProperty(o.prototype,"colorMap",{set:function(t){this._vol.mat&&(this._vol.mat.uniforms.u_ColorTex=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"filter",{get:function(){return this._filterOpen},set:function(t){t?this._filterControl&&(this._filterControl.element.style.visibility="visible"):this._filterControl&&(this._filterControl.element.style.visibility="hidden"),this._filterOpen=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"range",{set:function(t){if(this._vol.mat){var e=this._rbox,i=this._vol.mat.uniforms,o=function(t){return Math.max(Math.min(t,.9999999),1e-6)};i.u_VolClipMin.x=o(t.xmin/e.xmin),i.u_VolClipMin.y=o(t.ymin/e.ymin),i.u_VolClipMin.z=o(t.zmin/e.zmin),i.u_VolClipMax.x=o(t.xmax/e.xmax),i.u_VolClipMax.y=o(t.ymax/e.ymax),i.u_VolClipMax.z=o(t.zmax/e.zmax)}},enumerable:!0,configurable:!0}),o.prototype.SetOffset=function(t){this._offset=t,this.setVolume()},o.prototype._calcScaleOffsetBox=function(){var t=this._box,e=this._offset,i=this._scale,o=e[0],s=e[1],r=e[2],a=i[0],h=i[1],l=i[2];this._rbox=new n(o+t.xmin*a,s+t.ymin*h,r+t.zmin*l,o+t.xmax*a,s+t.ymax*h,r+t.zmax*l)},o.prototype._calcParam=function(){this._calcScaleOffsetBox();var t=Cesium.Cartesian3.fromDegrees(this._rbox.xmin,this._rbox.ymax,this._rbox.zmin),e=Cesium.Cartesian3.fromDegrees(this._rbox.xmin,this._rbox.ymin,this._rbox.zmin),i=Cesium.Cartesian3.fromDegrees(this._rbox.xmax,this._rbox.ymax,this._rbox.zmin),o=Cesium.Cartesian3.distance(t,i),n=Cesium.Cartesian3.distance(t,e),s=this._rbox.size[2];Cesium.BoundingSphere.fromCornerPoints,Cesium.Cartesian3.fromElements(o,n,s,this._BoxSizeInMeter),this._boundRadius=Math.sqrt(o*o+n*n),Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(this._rbox.xmin,this._rbox.ymin,this._rbox.zmin),void 0,this._boxMatrix),Cesium.Matrix4.inverse(this._boxMatrix,this._boxMatrixInv)},o.prototype.getSecPri=function(t){for(var e=this._sectpri,i=null,o=0;o<e.length;o++)if(e[o]._instanceIds[0]==t){i=e[o];break}return i}}(r);var l=function(){function t(t,e){if(!(t instanceof Element))throw new Error("请传入一个正确的页面元素");this.element=t,e=Object.assign({name_X:"属性值",split_X:4,max_X:1e3,min_X:0,name_Y:"透明度",split_Y:5,max_Y:1e3,min_Y:0,tolerance:3,bkColor:"#22344C",axisColor:"#C6CDCC",lineColor:"#FF0000",fontColor:"#C6CDCC",textSpace:2},e),this._name_X=e.name_X,this._split_X=e.split_X,this._min_X=e.min_X,this._max_X=e.max_X,this._name_Y=e.name_Y,this._split_Y=e.split_Y,this._min_Y=e.min_Y,this._max_Y=e.max_Y,this._tolerance=e.tolerance,this._bkColor=e.bkColor,this._axisColor=e.axisColor,this._lineColor=e.lineColor,this._fontColor=e.fontColor,this._textSpace=e.textSpace,this.x_axis=30,this.y_axis=40,this._line=e.line?e.line:[[0,0],[this._max_X,this._max_Y]],this._init(this.element)}return t.prototype._init=function(t){var e=this;this._width=t.offsetWidth,this._height=t.offsetHeight,this._painter=document.createElement("canvas"),this._painter.width=this._width,this._painter.height=this._height,t.appendChild(this._painter),this._context=this._painter.getContext("2d"),this._toDrawCoord();var i=-1;this._painter.addEventListener("mousedown",(function(t){i<0&&(i=-i,e._trans_line.splice(i,0,[t.offsetX,t.offsetY]),e._draw(i),e._toLoginCoord())})),this._painter.addEventListener("mousemove",(function(t){if(1==(1&t.button)){var o=void 0;if(o=t.offsetY<=50?50:t.offsetY>e._height-e.x_axis?e._height-e.x_axis:t.offsetY,0==i)e._trans_line[i]=[e.y_axis,o];else if(i==e._trans_line.length-1)e._trans_line[i]=[e._width-50,o];else{e._trans_line[i]=[t.offsetX,o];for(var n=1;n<e._trans_line.length-1-i;n++)e._trans_line[i+n][0]<=t.offsetX&&(e._trans_line[i+n][0]=t.offsetX);for(n=0;n<i;n++)e._trans_line[n][0]>=t.offsetX&&(e._trans_line[n][0]=t.offsetX);t.offsetX>=e._width-50&&(e._trans_line.splice(i+1,e._trans_line.length-1-i),e._trans_line[i]=[e._width-50,o]),t.offsetX<=e.y_axis&&(e._trans_line.splice(0,i),i=0,e._trans_line[0]=[e.y_axis,o])}e._draw(i),e._toLoginCoord(),e.onchangestatus(i,e._line)}else{var s=[t.offsetX,t.offsetY];i=e._getSelectedPoint(s),e._draw(),i>0&&e.highlight(i)}})),this._painter.addEventListener("mouseup",(function(t){e.onchangestatus_over(i,e._line)})),this._painter.addEventListener("mouseout",(function(t){e.onchangestatus_over(i,e._line)})),this._draw()},t.prototype._reset=function(){this._line=[[0,0],[this._max_X,this._max_Y]],this._toDrawCoord(),this._draw()},t.prototype._resetMax=function(){this._line=[[0,this._max_Y],[this._max_X,this._max_Y]],this._toDrawCoord(),this._draw()},t.prototype._resetPoints=function(t){this._line=t,this._toDrawCoord(),this._draw()},t.prototype._draw=function(t){this.clearCanvas(),this._draw_arrow(),this._draw_line(t)},t.prototype._draw_arrow=function(){var t=this._context;t.beginPath(),t.lineWidth=1,t.strokeStyle=this._axisColor,t.font="10px Courier New",t.fillStyle=this._fontColor,t.moveTo(this.y_axis,this._height-this.x_axis),t.lineTo(this.y_axis,30),t.lineTo(this.y_axis-4,34),t.moveTo(this.y_axis,30),t.lineTo(this.y_axis+4,34),t.moveTo(this.y_axis,this._height-this.x_axis),t.lineTo(this._width-30,this._height-this.x_axis),t.lineTo(this._width-34,this._height-this.x_axis-4),t.moveTo(this._width-30,this._height-this.x_axis),t.lineTo(this._width-34,this._height-this.x_axis+4);for(var e=(this._width-50-this.y_axis)/this._split_X,i=Math.floor((this._max_X-this._min_X)/this._split_X),o=1;o<=this._split_X;o++)t.moveTo(e*o+this.y_axis,this._height-this.x_axis),o%this._textSpace==1?(t.lineTo(e*o+this.y_axis,this._height-this.x_axis+5),t.fillText((this._min_X+i*o).toFixed(0),e*o+this.y_axis-5,this._height-this.x_axis+15)):t.lineTo(e*o+this.y_axis,this._height-this.x_axis+3);t.moveTo(this._width-50,this._height-30),t.lineTo(this._width-50,50),t.fillText(this._name_X,this._width-45,this._height-this.x_axis-11),t.fillText(this._name_Y,this.y_axis-15,30),t.stroke(),t.beginPath(),t.strokeStyle=this._axisColor,t.lineWidth=1;var n=(this._height-this.x_axis-50)/this._split_Y,s=Math.floor((this._max_Y-this._min_Y)/this._split_Y);for(o=0;o<this._split_Y;o++)t.moveTo(this.y_axis,n*o+50),t.lineTo(this._width-50,n*o+50),t.fillText((this._max_Y-s*o).toFixed(0),this.y_axis-30,n*o+53);t.stroke()},t.prototype._draw_line=function(t){var e=this._context;e.lineWidth=1,e.strokeStyle=this._lineColor,e.beginPath(),e.moveTo(this._trans_line[0][0],this._trans_line[0][1]);for(var i=1;i<this._trans_line.length;i++)e.lineTo(this._trans_line[i][0],this._trans_line[i][1]);e.stroke(),e.lineWidth=1,e.fillStyle=this._lineColor;for(i=0;i<this._trans_line.length;i++)e.beginPath(),e.arc(this._trans_line[i][0],this._trans_line[i][1],4,0,2*Math.PI),e.fill();void 0!==t&&this.highlight(t)},t.prototype.highlight=function(t){var e=this._context;e.lineWidth=1,e.fillStyle=this._lineColor,e.beginPath(),e.arc(this._trans_line[t][0],this._trans_line[t][1],5,0,2*Math.PI),e.fill()},t.prototype.clearCanvas=function(){var t=this._context;t.fillStyle=this._bkColor,t.fillRect(0,0,this._width,this._height)},t.prototype._toDrawCoord=function(){this._trans_line=[];for(var t=0;t<this._line.length;t++){var e=[0,0];e[0]=(this._line[t][0]-this._min_X)/(this._max_X-this._min_X)*(this._width-this.y_axis-50)+this.y_axis,e[1]=this._height-this.x_axis-(this._line[t][1]-this._min_Y)/(this._max_Y-this._min_Y)*(this._height-this.x_axis-50),this._trans_line.push(e)}},t.prototype._toLoginCoord=function(){this._line=[];for(var t=0;t<this._trans_line.length;t++){var e=[0,0];e[0]=(this._trans_line[t][0]-this.y_axis)/(this._width-this.y_axis-50)*(this._max_X-this._min_X)+this._min_X,e[1]=(this._height-this.x_axis-this._trans_line[t][1])/(this._height-this.x_axis-50)*(this._max_Y-this._min_Y)+this._min_Y,this._line.push(e)}},t.prototype.onchangestatus=function(t,e){},t.prototype.onchangestatus_over=function(t,e){},t._squareDistance=function(t,e){var i=t[0]-e[0],o=t[1]-e[1];return i*i+o*o},t.prototype._getSelectedPoint=function(e){for(var i=this._trans_line,o=this._tolerance,n=o*o,s=0;s<i.length;s++){if(t._squareDistance(e,i[s])<=n)return s}for(s=0;s<i.length;s++)if(e[0]>=i[s][0])return-s;return 999},t}()}(Volumn||(Volumn={}));
