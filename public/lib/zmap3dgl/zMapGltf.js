var ZMAPGLTF=function(e){this.map3dTool=e,this.viewer=e.GetView(),this.dviewer=e.GetCegore()};function initModel(e,t,o){var a=t.entities.getById(e.modelID);null==a&&null==a||t.entities.removeById(e.modelID);var i=[];if(e.startPosition){var n=e.startPosition;i[0]=parseFloat(n[0]),i[1]=parseFloat(n[1]),i[2]=n[2]?parseFloat(n[2]):0}else i=[110.05254,25.002073,0];var r=GmMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2]),l=e.rotate[0]?GmMap3D.Math.toRadians(90+e.rotate[0]):GmMap3D.Math.toRadians(90),s=e.rotate[1]?e.rotate[1]*Math.PI/180:0,m=e.rotate[2]?e.rotate[2]*Math.PI/180:0,d=new GmMap3D.HeadingPitchRoll(l,s,m),p=GmMap3D.Transforms.headingPitchRollQuaternion(r,d),M=t.entities.add({position:r,shadows:!0,id:e.modelID?e.modelID:"testModel",name:e.modelID?e.modelID:"testModel",orientation:p,model:{uri:e.url?e.url:"./gltf/test.gltf",scale:e.fscale?e.fscale:1,minimumPixelSize:e.fminimumPixelSize?e.fminimumPixelSize:1,maximumScale:e.fmaximumScale?e.fmaximumScale:1,runAnimations:!e.frunAnimations||e.frunAnimations,clampAnimations:!0,color:e.fcolor?o.colorTransform(e.fcolor):GmMap3D.Color.WHITE,colorBlendMode:e.fcolorBlendMode?GmMap3D.ColorBlendMode[e.fcolorBlendMode.toUpperCase()]:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:e.fcolorBlendAmount?e.fcolorBlendAmount:.5}});return M.isLoad=!1,setTimeout((function(){var t=o.getParimitive(e.modelID?e.modelID:"testModel");t&&t.readyPromise.then((function(){M.isLoad=!0})).otherwise((function(e){throw e}))}),1e3),M.callfun=e.callfun,M}function initAssistModel(e,t,o,a){var i=t.entities.getById(e.modelID);null==i&&null==i||t.entities.removeById(e.modelID);var n=[];if(e.startPosition){var r=e.startPosition;n[0]=parseFloat(r[0]),n[1]=parseFloat(r[1]),n[2]=r[2]?parseFloat(r[2]):0}else n=[110.05254,25.002073,0];var l=GmMap3D.Cartesian3.fromDegrees(n[0],n[1],n[2]),s=e.rotate[0]?e.rotate[0]*Math.PI/180:0,m=e.rotate[1]?e.rotate[1]*Math.PI/180:0,d=e.rotate[2]?e.rotate[2]*Math.PI/180:0,p=new GmMap3D.HeadingPitchRoll(s,m,d),M=GmMap3D.Quaternion.fromHeadingPitchRoll(p,new GmMap3D.Quaternion),u=GmMap3D.Quaternion.multiply(o,M,new GmMap3D.Quaternion),h=t.entities.add({position:l,shadows:!0,id:e.modelID?e.modelID:"testModel",name:e.modelID?e.modelID:"testModel",orientation:u,model:{uri:e.url?e.url:"./gltf/test.gltf",scale:e.fscale?e.fscale:1,minimumPixelSize:e.fminimumPixelSize?e.fminimumPixelSize:1,maximumScale:e.fmaximumScale?e.fmaximumScale:1,runAnimations:!e.frunAnimations||e.frunAnimations,clampAnimations:!0,color:e.fcolor?a.colorTransform(e.fcolor):GmMap3D.Color.WHITE,colorBlendMode:e.fcolorBlendMode?GmMap3D.ColorBlendMode[e.fcolorBlendMode.toUpperCase()]:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:e.fcolorBlendAmount?e.fcolorBlendAmount:.5}});return h.isLoad=!1,setTimeout((function(){var t=a.getParimitive(e.modelID?e.modelID:"testModel");t&&t.readyPromise.then((function(){h.isLoad=!0})).otherwise((function(e){throw e}))}),1e3),h.callfun=e.callfun,h}function calculateAssistModelPosition(e,t,o){var a=GmMap3D.Matrix3.fromQuaternion(e),i=new GmMap3D.Cartesian3(o[0],o[1],o[2]),n=GmMap3D.Matrix3.multiplyByVector(a,i,new GmMap3D.Cartesian3);return GmMap3D.Cartesian3.add(n,t,new GmMap3D.Cartesian3)}ZMAPGLTF.prototype.getModel=function(e){if(null==e||""==e)return null;var t=this.viewer.entities.getById(e);return t&&null!=t&&null!=t||(t=null),t},ZMAPGLTF.prototype.removeModel=function(e){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?this.removeModelById(e._id):" The model is useless ":" The model doesn't exist  "},ZMAPGLTF.prototype.removeModelById=function(e){if(!e||null==e||""==e)return" The modelId doesn't exist  ";var t=this.getModel(e);return t&&null!=t&&""!=t?this.viewer.entities.removeById(t._id):" The model doesn't exist  "},ZMAPGLTF.prototype.removeAll=function(){this.viewer.entities.removeAll()},ZMAPGLTF.prototype.addModel=function(e,t,o,a){if(!e.modelid)return"you have to give a id ";var i=this.getModel(e.modelid);if(null!=i||null!=i)return" The id already exists ";if(null==e.url||null==e.url||""==e.url)return"you have to give a url ";var n=e.drotate?e.drotate:[0,0,0],r=[];if(e.position){var l=e.position;r[0]=parseFloat(l[0]),r[1]=parseFloat(l[1]),r[2]=l[2]?parseFloat(l[2]):0}else r=[110.05254,25.002073,0];var s,m=GmMap3D.Cartesian3.fromDegrees(r[0],r[1],r[2]),d=GmMap3D.Math.toRadians(parseFloat(n[0])),p=GmMap3D.Math.toRadians(parseFloat(n[1])),M=GmMap3D.Math.toRadians(parseFloat(n[2])),u=new GmMap3D.HeadingPitchRoll(d,p,M);s=e.initq?ZMAP3D.defaultValue(e.initq,ZMAP3D.Quaternion.IDENTITY):GmMap3D.Transforms.headingPitchRollQuaternion(m,u);var h=this.viewer.entities.add({position:m,shadows:!0,show:null==e.show||e.show,id:e.modelid,name:e.name?e.name:e.modelid,orientation:s,model:{uri:e.url,scale:e.dscale?e.dscale:1,minimumPixelSize:e.dminimumPixelSize?e.dminimumPixelSize:1,maximumScale:e.dmaximumScale?e.dmaximumScale:1,runAnimations:!e.drunAnimations||e.drunAnimations,clampAnimations:!0,color:e.dcolor?this.map3dTool.colorTransform(e.dcolor):GmMap3D.Color.WHITE,colorBlendMode:e.dcolorBlendMode?GmMap3D.ColorBlendMode[e.dcolorBlendMode]:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:e.dcolorBlendAmount?e.dcolorBlendAmount:.5,distanceDisplayCondition:e.fdistanceDisplayCondition?new GmMap3D.DistanceDisplayCondition(e.fdistanceDisplayCondition[0],e.fdistanceDisplayCondition[1]):new Cesium.DistanceDisplayCondition(0,1e8)}});t&&this.viewer.camera.flyTo({destination:GmMap3D.Cartesian3.fromDegrees(r[0],r[1],r[2]+1e3)}),o&&(this.viewer.trackedEntity=h),h.isLoad=!1;var c=this;return setTimeout((function(){var t=c.map3dTool.getParimitive(e.modelid);t&&t.readyPromise.then((function(){h.isLoad=!0,a&&a(h)})).otherwise((function(e){throw e}))}),1e3),h.callfun=e.callfun,h.scaleBase=e.scaleBase,h},ZMAPGLTF.prototype.changePosition=function(e,t,o){if(!e||null==e||""==e)return" The model doesn't exist  ";this.viewer.entities.contains(e);if(!t)return" The position is useless ";var a=GmMap3D.Cartesian3.fromDegrees(t[0],t[1],t[2]);e.position=a,o&&this.viewer.camera.flyTo({destination:GmMap3D.Cartesian3.fromDegrees(t[0],t[1],t[2]+1e3)})},ZMAPGLTF.prototype.getModelPosition=function(e,t){if(!e||null==e||""==e)return" The model doesn't exist  ";if(!this.viewer.entities.contains(e))return" The model doesn't exist  ";var o=e.position._value;return t?o:this.map3dTool.cartesianTo2MapCoord(o)},ZMAPGLTF.prototype.lookModel=function(e,t){if(this.viewer.trackedEntity=e,!e||null==e||""==e)return console.log("模型不存在")," The model doesn't exist  ";if(!this.viewer.entities.contains(e))return console.log("模型不存在")," The model doesn't exist  ";for(var o=this.viewer.scene.primitives._primitives,a=null,i=0;i<o.length;i++){var n=o[i];if(n.id&&n.id._id===e._id){a=n;break}}var r=null,l=null,s=a._scaledBoundingSphere.radius;t?((r=t.viewingAngle)||(r=[0,90]),(l=t.viewDis)||(l=50*s)):(r=[0,90],l=50*s);var m=e._position._value,d=this.deviationCalculate(m,GmMap3D.Math.toRadians(r[0]),GmMap3D.Math.toRadians(r[1]),l);this.map3dTool.calculatehp(this.map3dTool.cartesianTo2MapCoord(d),this.map3dTool.cartesianTo2MapCoord(m)),this.map3dTool.cartesianTo2MapCoord(d);cpositon1=GmMap3D.Cartographic.fromCartesian(d),cpositon2=GmMap3D.Cartographic.fromCartesian(m),this.dviewer.camera.lookAtFromTo(cpositon1,cpositon2),this.viewer.trackedEntity=null},ZMAPGLTF.prototype.deviationCalculate=function(e,t,o,a){var i=new GmMap3D.HeadingPitchRoll(t,o,0),n=GmMap3D.Transforms.headingPitchRollToFixedFrame(e,i,GmMap3D.Ellipsoid.WGS84,GmMap3D.Transforms.eastNorthUpToFixedFrame,new GmMap3D.Matrix4),r=new GmMap3D.Cartesian3(a,0,0);return GmMap3D.Matrix4.multiplyByPoint(n,r,new GmMap3D.Cartesian3)},ZMAPGLTF.prototype.getModelOrientation=function(e){if(!e||null==e||""==e)return" The model doesn't exist  ";if(!this.viewer.entities.contains(e))return" The model doesn't exist  ";var t=GmMap3D.Transforms.eastNorthUpToFixedFrame(e.position._value,Cesium.Ellipsoid.WGS84,new Cesium.Matrix4),o=GmMap3D.Matrix4.multiply(GmMap3D.Matrix4.inverse(t,new GmMap3D.Matrix4),e._orientation._value,new GmMap3D.Matrix4),a=GmMap3D.Matrix4.getRotation(o,new Cesium.Matrix3),i=GmMap3D.Quaternion.fromRotationMatrix(a);Cesium.HeadingPitchRoll.fromQuaternion(i)},ZMAPGLTF.prototype.changeOrientation=function(e,t){if(!e||null==e||""==e)return" The model doesn't exist  ";this.viewer.entities.contains(e);if(!t)return" The rotate is useless  ";var o=e.position._value,a=GmMap3D.Math.toRadians(parseFloat(t[0])),i=GmMap3D.Math.toRadians(parseFloat(t[1])),n=GmMap3D.Math.toRadians(parseFloat(t[2])),r=new GmMap3D.HeadingPitchRoll(a,i,n),l=GmMap3D.Transforms.headingPitchRollQuaternion(o,r);e.orientation=l},ZMAPGLTF.prototype.changeColor=function(e,t){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?t?void(e.model.color=this.map3dTool.colorTransform(t)):" The color is useless  ":" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.getModelcolor=function(e,t){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?e.color:" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.changeScale=function(e,t){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?t?(e.model.maximumScale=parseFloat(t),void(e.model.scale=parseFloat(t))):" The scale is useless  ":" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.getModelScale=function(e){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?e.model._scale._value:" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.changePixelSize=function(e,t){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?t?(e.model.maximumScale=parseInt(t),void(e.model.minimumPixelSize=parseInt(t))):" The PixelSize is useless  ":" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.show=function(e){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?void(e.show=!0):" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.unshow=function(e){return e&&null!=e&&""!=e?this.viewer.entities.contains(e)?void(e.show=!1):" The model doesn't exist  ":" The model is undefined  "},ZMAPGLTF.prototype.computationTime=function(e){if(e){var t=e.path;e.path[0].time=1;for(var o=1;o<t.length;o++){var a=t[o-1],i=t[o],n=a.cameraPoint,r=i.cameraPoint,l=a.speed,s=i.speed;lat1=Math.PI/180*n[1],lat2=Math.PI/180*r[1],lon1=Math.PI/180*n[0],lon2=Math.PI/180*r[0];var m=Math.cos(lat1)*Math.cos(lat2)*Math.cos(lon1-lon2)+Math.sin(lat1)*Math.sin(lat2);m>1&&(m=1),m<-1&&(m=-1);var d=6378137*Math.acos(m),p=parseFloat(d/((l+s)/2));e.path[o].time=p}return e}},ZMAPGLTF.rotateModel=function(e,t,o){var a=e.entities.contains(t);var i=!1,n=0,r=0,l=0,s=o[0]?o[0]:0,m=o[1]?o[1]:0,d=o[2]?o[2]:0;function p(){var e=t._position._value;n+=s*Math.PI/180,r+=m*Math.PI/180,l=d*Math.PI/180;var o=GmMap3D.Math.toRadians(parseFloat(n)),a=GmMap3D.Math.toRadians(parseFloat(l)),i=GmMap3D.Math.toRadians(parseFloat(r)),p=new GmMap3D.HeadingPitchRoll(o,a,i),M=GmMap3D.Transforms.headingPitchRollQuaternion(e,p);t.orientation=M}this.play=function(){!i&&a&&(i=!0,0!==s||0!==m||0!==d?e.scene.postRender.addEventListener(p):i=!1)},this.stop=function(){i=!1,e.scene.postRender.removeEventListener(p)}},ZMAPGLTF.singelMoveAndrotateModel=function(e,t,o,a){for(var i=e.viewer,n=!0,r=!0,l=0,s=0,m=0,d=0,p=null,M=null,u=null,h=[],c=0;c<t.path.length;c++)t.path[c].cameraPoint=t.path[c].targetPoint;e.computationTime(t);var D=new GmMap3D.JulianDate,f=new GmMap3D.JulianDate,G=new GmMap3D.JulianDate,v=0,w=0,P=0,T=t.rotate[0]?t.rotate[0]:0,g=t.rotate[1]?t.rotate[1]:0,R=t.rotate[2]?t.rotate[2]:0,y=null;!function(e){var t=e.path;y=new GmMap3D.SampledPositionProperty;for(var o=0;o<t.length;o++){var a=t[o],i=a.targetPoint,n=a.time+s;s+=a.time;var r=GmMap3D.JulianDate.addSeconds(D,n,new GmMap3D.JulianDate),l=GmMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2]);y.addSample(r,l)}}(t),y.setInterpolationOptions({interpolationDegree:t.finterpolationDegree?t.finterpolationDegree:10,interpolationAlgorithm:t.finterpolationAlgorithm?GmMap3D[t.finterpolationAlgorithm]:GmMap3D.LinearApproximation});for(var I,A,C=new GmMap3D.VelocityOrientationProperty(y),x=0;x<y._property._values.length;x++)h.push(y._property._values[x]);I=t.trackPath,A=i.entities.add({id:I.id?I.id:"trackid",show:!I.dshow||I.dshow,polyline:{positions:GmMap3D.Cartesian3.unpackArray(h),width:I.dwidth?I.dwidth:1,material:new Cesium.PolylineOutlineMaterialProperty({color:I.dcolor?e.map3dTool.colorTransform(I.dcolor):GmMap3D.Color.WHITE,outlineWidth:I.doutlineWidth?I.doutlineWidth:1,outlineColor:I.doutlineColor?e.map3dTool.colorTransform(I.dcolor):GmMap3D.Color.WHITE})}}),u=A,this.showTrack=function(){u.show=!0},this.unshowTrack=function(){u.show=!1};var F=i.entities.getById(t.modelID);null==F&&null==F||i.entities.removeById(t.modelID);var L=[];if(t.path[0].targetPoint){var B=t.path[0].targetPoint;L[0]=parseFloat(B[0]),L[1]=parseFloat(B[1]),L[2]=B[2]?parseFloat(B[2]):0}else L=[110.05254,25.002073,0];var H=GmMap3D.Cartesian3.fromDegrees(L[0],L[1],L[2]),Q=new GmMap3D.HeadingPitchRoll(0,0,0),S=GmMap3D.Transforms.headingPitchRollQuaternion(H,Q),_=i.entities.add({position:H,shadows:!0,id:t.modelID?t.modelID:"testModel",name:t.modelID?t.modelID:"testModel",orientation:S,model:{uri:t.url?t.url:"./gltf/test.gltf",scale:t.fscale?t.fscale:1,minimumPixelSize:t.fminimumPixelSize?t.fminimumPixelSize:1,maximumScale:t.fmaximumScale?t.fmaximumScale:1,runAnimations:!t.frunAnimations||t.frunAnimations,clampAnimations:!0,color:t.fcolor?GmMap3D.Color[t.fcolor.toUpperCase()]:GmMap3D.Color.WHITE,colorBlendMode:t.fcolorBlendMode?GmMap3D.ColorBlendMode[t.fcolorBlendMode.toUpperCase()]:GmMap3D.ColorBlendMode.HIGHLIGHT,colorBlendAmount:t.fcolorBlendAmount?t.fcolorBlendAmount:.5}});function E(e,t){if("function"==typeof a&&a(M),f.equals(G))t.clone(f);else{var o=GmMap3D.JulianDate.secondsDifference(t,f);if(m=o,o+d>=s)return f=new GmMap3D.JulianDate,D=new GmMap3D.JulianDate,d=0,void(m=0);D=new GmMap3D.JulianDate,GmMap3D.JulianDate.addSeconds(D,o+d,D);var i=null,l=null;r||(i=y.getValue(D),l=C.getValue(D));var u=null;if(!n){v+=T*Math.PI/180,w+=g*Math.PI/180,P=R*Math.PI/180;var h=GmMap3D.Math.toRadians(parseFloat(v)),c=GmMap3D.Math.toRadians(parseFloat(P)),I=GmMap3D.Math.toRadians(parseFloat(w)),A=null;if(A=r?p||H:i){var x=new GmMap3D.HeadingPitchRoll(h,c,I);u=GmMap3D.Transforms.headingPitchRollQuaternion(A,x)}}i&&(M.position=i,M.orientation=l),u&&(M.orientation=u)}}_.isLoad=!1,setTimeout((function(){var o=e.map3dTool.getParimitive(t.modelID?t.modelID:"testModel");o&&o.readyPromise.then((function(){_.isLoad=!0})).otherwise((function(e){throw e}))}),1e3),_.callfun=t.callfun,M=_,o&&(i.trackedEntity=M),this.playRotate=function(){n&&(n=!1,0!==T||0!==g||0!==R?0===l&&(i.scene.postRender.addEventListener(E),l=1):n=!0)},this.playMove=function(){r&&(r=!1,0===l&&(i.scene.postRender.addEventListener(E),l=1))},this.stopRotate=function(){n=!0,v=0,w=0,P=0,r&&n&&(l=0,i.scene.postRender.removeEventListener(E))},this.stopMove=function(){r=!0,f=new GmMap3D.JulianDate,m=0,d=0,n&&r&&(l=0,i.scene.postRender.removeEventListener(E))},this.pauseMove=function(){d+=m,f=new GmMap3D.JulianDate,r=!0,D=new GmMap3D.JulianDate,GmMap3D.JulianDate.addSeconds(D,d,D),p=y.getValue(D),n&&n&&(l=0,i.scene.postRender.removeEventListener(E))}},ZMAPGLTF.shieldMachineMoveAndrotateModel=function(e,t,o,a){for(var i,n=e.viewer,r=!0,l=!0,s=0,m=0,d=0,p=0,M=null,u=null,h=null,c=null,D=[],f=null,G=new GmMap3D.JulianDate,v=new GmMap3D.JulianDate,w=new GmMap3D.JulianDate,P=0,T=0,g=0,R=t.otherModel.rotateDate[0]?t.otherModel.rotateDate[0]*Math.PI/180:0,y=t.otherModel.rotateDate[1]?t.otherModel.rotateDate[1]*Math.PI/180:0,I=t.otherModel.rotateDate[2]?t.otherModel.rotateDate[2]*Math.PI/180:0,A=t.mainModel.moverotate[0]?t.mainModel.moverotate[0]*Math.PI/180:0,C=t.mainModel.moverotate[2]?t.mainModel.moverotate[2]*Math.PI/180:0,x=t.mainModel.moverotate[1]?t.mainModel.moverotate[1]*Math.PI/180:0,F=t.otherModel.rotate[0]?t.otherModel.rotate[0]*Math.PI/180:0,L=t.otherModel.rotate[2]?t.otherModel.rotate[2]*Math.PI/180:0,B=t.otherModel.rotate[1]?t.otherModel.rotate[1]*Math.PI/180:0,H=t.otherModel.vector,Q=0;Q<t.mainModel.path.length;Q++)t.mainModel.path[Q].cameraPoint=t.mainModel.path[Q].targetPoint;var S=computationTime({path:t.mainModel.path});t.mainModel.path=S.path;var _=null;!function(e){var t=e.mainModel.path;_=new GmMap3D.SampledPositionProperty;for(var o=0;o<t.length;o++){var a=t[o],i=a.targetPoint,n=a.time+m;m+=a.time;var r=GmMap3D.JulianDate.addSeconds(G,n,new GmMap3D.JulianDate),l=GmMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2]);_.addSample(r,l)}}(t),_.setInterpolationOptions({interpolationDegree:t.finterpolationDegree?t.finterpolationDegree:10,interpolationAlgorithm:t.finterpolationAlgorithm?GmMap3D[t.finterpolationAlgorithm]:GmMap3D.LinearApproximation});for(var E,J,Z=new GmMap3D.VelocityOrientationProperty(_),k=0;k<_._property._values.length;k++)D.push(_._property._values[k]);E=t.trackPath,J=n.entities.add({id:E.id?E.id:"trackid",show:!E.dshow||E.dshow,polyline:{positions:GmMap3D.Cartesian3.unpackArray(D),width:E.dwidth?E.dwidth:1,material:new Cesium.PolylineOutlineMaterialProperty({color:E.dcolor?e.map3dTool.colorTransform(E.dcolor):GmMap3D.Color.WHITE,outlineWidth:E.doutlineWidth?E.doutlineWidth:1,outlineColor:E.doutlineColor?e.map3dTool.colorTransform(E.dcolor):GmMap3D.Color.WHITE})}}),f=J,this.showTrack=function(){f.show=!0},this.unshowTrack=function(){f.show=!1};var W=calculateAssistModelPosition((h=initModel(t.mainModel,n,e.map3dTool))._orientation._value,h.position._value,H);i=h._orientation._value;var z=map3dView.cartesianTo2MapCoord(W);function V(e,t){if("function"==typeof a&&a(h),v.equals(w))t.clone(v);else{var o=GmMap3D.JulianDate.secondsDifference(t,v);if(d=o,o+p>=m)return v=new GmMap3D.JulianDate,G=new GmMap3D.JulianDate,p=0,void(d=0);G=new GmMap3D.JulianDate,GmMap3D.JulianDate.addSeconds(G,o+p,G);var n=null,s=null,D=null;if(!l){n=_.getValue(G);var f=Z.getValue(G),Q=new GmMap3D.HeadingPitchRoll(A,C,x),S=GmMap3D.Quaternion.fromHeadingPitchRoll(Q,new GmMap3D.Quaternion);s=calculateAssistModelPosition(D=GmMap3D.Quaternion.multiply(f,S,new GmMap3D.Quaternion),n,H)}var E=null,J=null;if(r){if(J=l?M?u:i:D){O=new GmMap3D.HeadingPitchRoll(F,L,B);var k=GmMap3D.Quaternion.fromHeadingPitchRoll(O,new GmMap3D.Quaternion);E=S=GmMap3D.Quaternion.multiply(J,k,new GmMap3D.Quaternion)}}else{P+=R,g+=y,T+=I;var W=GmMap3D.Math.toRadians(parseFloat(P)),z=GmMap3D.Math.toRadians(parseFloat(g)),V=GmMap3D.Math.toRadians(parseFloat(T));if(J=l?M?u:i:D){var O=new GmMap3D.HeadingPitchRoll(F,L,B),U=GmMap3D.Quaternion.fromHeadingPitchRoll(O,new GmMap3D.Quaternion),q=GmMap3D.Quaternion.multiply(J,U,new GmMap3D.Quaternion),N=new GmMap3D.HeadingPitchRoll(W,z,V),b=GmMap3D.Quaternion.fromHeadingPitchRoll(N,new GmMap3D.Quaternion);E=GmMap3D.Quaternion.multiply(q,b,new GmMap3D.Quaternion)}}n&&s&&(h.position=n,h.orientation=D,c.position=s),E&&(c.orientation=E)}}t.otherModel.startPosition=z,c=initAssistModel(t.otherModel,n,h._orientation._value,e.map3dTool),o&&(n.trackedEntity=h),this.playRotate=function(){r&&(r=!1,0!==R||0!==y||0!==I?0===s&&(n.scene.postRender.addEventListener(V),s=1):r=!0)},this.playMove=function(){l&&(l=!1,0===s&&(n.scene.postRender.addEventListener(V),s=1))},this.stopRotate=function(){r?r=!0:(r=!0,P=0,T=0,g=0,l&&r&&(s=0,n.scene.postRender.removeEventListener(V)))},this.stopMove=function(){l=!0,v=new GmMap3D.JulianDate,d=0,p=0,r&&l&&(s=0,n.scene.postRender.removeEventListener(V))},this.pauseMove=function(){if(r)l=!0;else{p+=d,v=new GmMap3D.JulianDate,l=!0,G=new GmMap3D.JulianDate,GmMap3D.JulianDate.addSeconds(G,p,G),M=_.getValue(G);var e=new GmMap3D.HeadingPitchRoll(A,C,x),t=GmMap3D.Quaternion.fromHeadingPitchRoll(e,new GmMap3D.Quaternion);u=GmMap3D.Quaternion.multiply(Z.getValue(G),t,new GmMap3D.Quaternion),r&&r&&(s=0,n.scene.postRender.removeEventListener(V))}}},ZMAPGLTF.shieldMachinejumpAndrotateModel=function(e,t,o,a){var i=e.viewer,n=!0,r=null,l=null,s=null,m=0,d=0,p=0,M=0,u=0,h=0,c=t.otherModel.rotateDate[0]?GmMap3D.Math.toRadians(t.otherModel.rotateDate[0]):0,D=t.otherModel.rotateDate[1]?GmMap3D.Math.toRadians(t.otherModel.rotateDate[1]):0,f=t.otherModel.rotateDate[2]?GmMap3D.Math.toRadians(t.otherModel.rotateDate[2]):0,G=t.mainModel.rotate[0]?GmMap3D.Math.toRadians(t.mainModel.rotate[0]+90):GmMap3D.Math.toRadians(90),v=t.mainModel.rotate[1]?GmMap3D.Math.toRadians(t.mainModel.rotate[2]):0,w=t.mainModel.rotate[2]?GmMap3D.Math.toRadians(t.mainModel.rotate[1]):0,P=t.otherModel.rotate[0]?GmMap3D.Math.toRadians(t.otherModel.rotate[0]):0,T=t.otherModel.rotate[2]?GmMap3D.Math.toRadians(t.otherModel.rotate[2]):0,g=t.otherModel.rotate[1]?GmMap3D.Math.toRadians(t.otherModel.rotate[1]):0,R=t.otherModel.vector;r=initModel(t.mainModel,i,e.map3dTool),s=r._orientation._value;var y=calculateAssistModelPosition(r._orientation._value,r.position._value,R),I=map3dView.cartesianTo2MapCoord(y);function A(e,t){var o=null;if(!n){M+=c,h+=D,u+=f;var a=GmMap3D.Math.toRadians(parseFloat(M)),i=GmMap3D.Math.toRadians(parseFloat(h)),r=GmMap3D.Math.toRadians(parseFloat(u));if(s){var m=new GmMap3D.HeadingPitchRoll(P,T,g),d=GmMap3D.Quaternion.fromHeadingPitchRoll(m,new GmMap3D.Quaternion),p=GmMap3D.Quaternion.multiply(s,d,new GmMap3D.Quaternion),G=new GmMap3D.HeadingPitchRoll(a,i,r),v=GmMap3D.Quaternion.fromHeadingPitchRoll(G,new GmMap3D.Quaternion);o=GmMap3D.Quaternion.multiply(p,v,new GmMap3D.Quaternion)}}o&&(l.orientation=o)}t.otherModel.startPosition=I,l=initAssistModel(t.otherModel,i,r._orientation._value,e.map3dTool),o&&(i.trackedEntity=r),this.playRotate=function(){n&&(n=!1,0!==c||0!==D||0!==f?i.scene.postRender.addEventListener(A):n=!0)},this.stopRotate=function(){n?n=!0:(n=!0,M=0,u=0,h=0,i.scene.postRender.removeEventListener(A))},this.alterPosition=function(e){if(i.scene.postRender.removeEventListener(A),e.position){e.mrotate&&(m=e.mrotate[0]?G+GmMap3D.Math.toRadians(e.mrotate[0]):G,d=e.mrotate[1]?v+GmMap3D.Math.toRadians(e.mrotate[1]):v,p=e.mrotate[2]?__intMainrollRotate+GmMap3D.Math.toRadians(e.mrotate[1]):w);var t=GmMap3D.Cartesian3.fromDegrees(e.position[0],e.position[1],e.position[2]),o=new GmMap3D.HeadingPitchRoll(m,d,p),a=GmMap3D.Transforms.headingPitchRollQuaternion(t,o);s=a;var M=calculateAssistModelPosition(a,t,R),u=(o=new GmMap3D.HeadingPitchRoll(P,T,g),GmMap3D.Quaternion.fromHeadingPitchRoll(o,new GmMap3D.Quaternion)),h=GmMap3D.Quaternion.multiply(a,u,new GmMap3D.Quaternion);r.position=t,r.orientation=a,l.position=M,l.orientation=h,n||i.scene.postRender.addEventListener(A)}}};