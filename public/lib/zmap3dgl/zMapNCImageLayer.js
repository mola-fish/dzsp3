var Cegore;!function(e){var t=function(){function t(t){if(!e.TypeCheck.isObject(t))throw"Invalid iamge info";var r=this.createProvider(t);if(!e.TypeCheck.isDefined(r))throw'Can not create image layer by type : "'+t.type+'"';this._name=e.AutoNames.genName(t.name,"NetCDFImageLayer"),this._type=t.type,this._czLayer=new GmMap3D.ImageryLayer(r),this._czLayer._ZMapLayer=this,this._params=e.TypeCheck.defaultValue(t.params,{}),this.visible=e.TypeCheck.defaultValue(t.visible,!0),this.alpha=e.TypeCheck.defaultValue(t.alpha,1)}return Object.defineProperty(t.prototype,"_czlayer",{get:function(){return this._czLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,this._czLayer.show=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e,this._czLayer.alpha=e},enumerable:!0,configurable:!0}),t.prototype.createProvider=function(t){var r={};for(var i in t)this.hasOwnProperty(i)||(r[i]=t[i]);return e.Providers.ImageProviders.createProvider(t.type,r)},t}();e.NetCDFImageLayer=t}(Cegore||(Cegore={})),function(e){var t=function(){function t(t){this._layers=new e.HashMap,this._globe=t,this._czLayers=this._globe._czglobe.imageryLayers}return Object.defineProperty(t.prototype,"length",{get:function(){return this._czLayers.length},enumerable:!0,configurable:!0}),t.prototype.add=function(t,r){if(e.TypeCheck.isInstanceOf(t,e.NetCDFImageLayer)||(t=new e.NetCDFImageLayer(t)),this._layers.exist(t.name))throw"image layer named :"+t.name+" allready exist.";this._czLayers.add(t._czlayer,r),this._layers.put(t.name,t)},t.prototype.get=function(t){if(e.TypeCheck.isNumber(t)){var r=this._czLayers.get(t);if(r)return r._ZMapLayer}else if(e.TypeCheck.isString(t))return this._layers.get(t);throw"id must be string or number"},t.prototype.remove=function(t){if(e.TypeCheck.isNumber(t)&&e.TypeCheck.isString(t))this.remove(this.get(t));else if(e.TypeCheck.isInstanceOf(t,e.NetCDFImageLayer)){var r=t;this._czLayers.remove(r._czlayer),this._layers.remove(t.name)}throw"id must be string or number or NetCDFImageLayer"},t.prototype.removeAll=function(){this._czLayers.removeAll(),this._layers.removeAll()},t.prototype.clear=function(){this.removeAll()},t}();e.NetCDFImageLayerCollection=t}(Cegore||(Cegore={})),function(e){var t=function(){function e(t){this.getTileCredits=function(e,t,r){},this.requestImage=function(t,r,i){if(!this._ready)throw new GmMap3D.DeveloperError("requestImage must not be called before the imagery provider is ready.");var n=e.buildImageUrl(this,t,r,i);return GmMap3D.ImageryProvider.loadImage(this,n)};var r=new GmMap3D.Credit("WMTS");t=GmMap3D.defaultValue(t,{});var i=GmMap3D.defaultValue(t.url,"http://localhost:88/wmts");/\/$/.test(i),this._initurl=t.url,this._url=i,this._params=t.params,this._proxy=t.proxy,this._tileDiscardPolicy=t.tileDiscardPolicy,this._scheme=GmMap3D.defaultValue(t.scheme,"Geographic"),"WebMercator"===this._scheme?this._tilingScheme=new GmMap3D.WebMercatorTilingScheme({ellipsoid:t.ellipsoid}):this._scheme.indexOf("level-0")>0?this._tilingScheme=new GmMap3D.GeographicTilingScheme({ellipsoid:t.ellipsoid}):this._tilingScheme=new GmMap3D.GeographicTilingScheme({ellipsoid:t.ellipsoid,numberOfLevelZeroTilesX:8,numberOfLevelZeroTilesY:4}),this._tileWidth=256,this._tileHeight=256,this._minimumLevel=GmMap3D.defaultValue(t.minimumLevel,0),this._maximumLevel=GmMap3D.defaultValue(t.maximumLevel,18),this._extent=GmMap3D.defaultValue(t.extent,this._tilingScheme.extent),this._rectangle=GmMap3D.defaultValue(t.rectangle,this._tilingScheme.rectangle),this._errorEvent=new GmMap3D.Event,this._ready=!0;var n=GmMap3D.defaultValue(t.credit,r);"string"==typeof n&&(n=new GmMap3D.Credit(n)),this._credit=n}return Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasAlphaChannel",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumLevel",{get:function(){return this._maximumLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minimumLevel",{get:function(){return this._minimumLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilingScheme",{get:function(){return this._tilingScheme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rectangle",{get:function(){return this._rectangle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ileDiscardPolicy",{get:function(){return this._tileDiscardPolicy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorEvent",{get:function(){return this._errorEvent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"credit",{get:function(){return this._credit},enumerable:!0,configurable:!0}),e.getRealUrl=function(e){var t=e;if(e.indexOf("catalogws")<0)return e;var r=this;return t=(t=e.replace("/catalogws","")).replace("/tile/map","")+"?f=json",$.ajax({url:t,dataType:"json",async:!1,success:function(i){t=r.JudgePower(i)<2?i.attributes.url:e},error:function(r){t=e}}),t},e.JudgePower=function(e){return"公开"==e.descriptions.保密模式||""==e.descriptions.保密模式?1:"普通保密"==e.descriptions.保密模式?2:3},e.buildImageUrl=function(e,t,r,i){var n=e._proxy;"WebMercator"!==e._scheme&&(e._scheme.indexOf("level-0")>0?i+=1:i=i),null==e.realUrl&&(e.realUrl=this.getRealUrl(e._initurl));var a=e._tilingScheme.tileXYToRectangle(t,r,i-1),o=[GmMap3D.Math.toDegrees(a.west),GmMap3D.Math.toDegrees(a.south),GmMap3D.Math.toDegrees(a.east),GmMap3D.Math.toDegrees(a.north)],l=e.realUrl+"?lvl="+i+"&col="+r+"&row="+t+"&west="+o[0]+"&south="+o[1]+"&east="+o[2]+"&north="+o[3],s=e._params;for(var u in s)l+="&"+u+"="+s[u];return GmMap3D.defined(n)&&(l=n.getURL(l)),l},e}(),r=function(){function e(){}return e.prototype.createProvider=function(e){return new t(e)},e}();e.Providers.ImageProviders.regFactory("ZMapNetCDFImage",new r)}(Cegore||(Cegore={}));