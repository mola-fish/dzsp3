var ip=window.location.origin,ModelCut=function(t,e){this._cutTool=t,this._modelTool=e,this._models=[],this._modelentities=[],this._cutmodel=[],this.htmlid="movex",this._cutlinePlane=null,this._cutAxisPlane=null,this.trackflag=!1,this.appWizard=null};ModelCut.prototype.cutModelAdd=function(t){if(this.cutModelDele(),t.baseFile)this._cutTool.AddModel(t.id,t,!0),this._models.push(t);else{this._cutTool.urlTransform(t,(function(o){t.id==o.modelid&&(e._models.push(o),o.drotate=[0,0,0],e._cutTool.AddModel(t.id,o,!0))}));var e=this}},ModelCut.prototype.cutModelDele=function(){for(var t=0;t<this._models.length;t++)this._modelTool.removeModelById(this._models[t].modelid)},ModelCut.prototype.unshow=function(t){var e=this._modelTool.getModel(t);this._modelTool.unshow(e)},ModelCut.prototype.show=function(t){var e=this._modelTool.getModel(t);this._modelTool.show(e)},ModelCut.prototype.cutStart=function(){this._modelentities=[];for(var t=0;t<this._models.length;t++){var e=this._modelTool.getModel(this._models[t].modelid);this._modelentities.push(e)}},ModelCut.prototype.cutAxle=function(t){this.appWizard||(this.appWizard=new APPWZARD(this._cutTool,this._modelentities)),this.appWizard&&this.updateAxiePosition(this.htmlid,t)},ModelCut.prototype.updateAxiePosition=function(t,e){this.htmlid=t;var o=this.getNewPlane(e),i=this._cutTool.GetView();if(this._cutAxisPlane)return this._cutAxisPlane.position=o.offsetPoint,this._cutAxisPlane.plane.plane=o.plane,void(this._cutAxisPlane.plane.dimensions=new Cesium.Cartesian2(o.length,o.width));var l=i.entities.add({id:"testplane",name:"testplane",position:o.offsetPoint,plane:{plane:o.plane,dimensions:new GmMap3D.Cartesian2(o.length,o.width),material:GmMap3D.Color.RED.withAlpha(.5),fill:!0,outline:!0,outlineColor:GmMap3D.Color.PURPLE.withAlpha(.5),outlineWidth:1}});this._cutAxisPlane=l},ModelCut.prototype.getNewPlane=function(t){var e,o=null,i=0,l=null;"movex"==this.htmlid&&(o="x",l="-x",(e=t.x)>=0&&(l="x"),i=Math.abs(this.appWizard._ballRadius/1e3*e));"movey"==this.htmlid&&(o="y",l="-y",(e=t.y)>=0&&(l="y"),i=Math.abs(this.appWizard._ballRadius/1e3*e));"movez"==this.htmlid&&(o="z",l="-z",(e=t.z)>=0&&(l="z"),i=Math.abs(this.appWizard._ballRadius/1e3*e));var s={dparallelPlane:o,doffsetSize:i,doffsetCoordinate:l};return this.appWizard.createProfilePlane(s)},ModelCut.prototype.onDrawLine=function(t){this.appWizard||(this.appWizard=new APPWZARD(this._cutTool,this._modelentities)),this._cutlinePlane&&this._modelTool.removeModel(this._cutlinePlane),this.appWizard.drawplane(t,(function(t){e._cutlinePlane=t}));var e=this},ModelCut.prototype.reductionModel=function(){this._cutAxisPlane&&(this._modelTool.removeModel(this._cutAxisPlane),this._cutAxisPlane=null),cutplane._cutlinePlane&&(this._modelTool.removeModel(this._cutlinePlane),this._cutlinePlane=null);for(var t=0;t<this._cutmodel.length;t++){var e=this._modelTool.getModel(this._cutmodel[t].modelid);e&&this._modelTool.removeModel(e)}this._cutmodel=[];for(var o=0;o<this._modelentities.length;o++)this.show(this._modelentities[o]._id)},ModelCut.prototype.lineCutModel=function(t){var e=this,o={method:t.method,name:t.name,pathlist:JSON.stringify(this.appWizard._createWallPoint)};t.axis&&t.axisparam&&(o.axis=t.axis,o.axisparam=t.axisparam),null!=t.process&&(o.process=!!t.process,null==t.workname&&o.process)?alert("process为true是需传入workname!"):(t.workname&&(o.workname=t.workname),$.ajax({url:t.url,dataType:"json",data:o,success:function(o){if(o.success){if(o.status&&"prcessing"==o.status)return void setTimeout(e.lineCutModel(t),500);var i=o.format,l=ip+i.substring(i.indexOf("ip:port")+7,i.length),s=o.position.split(",");3==s.length&&(s[0]=parseFloat(s[0]),s[1]=parseFloat(s[1]),s[2]=parseFloat(s[2]));for(var a={modelid:t.id,position:t.position?t.position:s,url:l,drotate:[0,0,0],initq:new ZMAP3D.Quaternion(-.5,-.5,-.5,.5)},n=0;n<e._modelentities.length;n++)e.unshow(e._modelentities[n]._id);e._cutmodel.push(a),e._cutTool.AddModel(t.id,a,!0)}else console.log("切割失败！")}}))},ModelCut.prototype.axieCutModel=function(t){var e=this;$.ajax({url:t.url,dataType:"json",data:{method:t.method,name:t.name,pathlist:JSON.stringify(this.appWizard._createWallPoint)},success:function(o){if(o.success){var i=o.format,l=ip+i.substring(i.indexOf("ip:port")+7,i.length),s=o.position.split(",");3==s.length&&(s[0]=parseFloat(s[0]),s[1]=parseFloat(s[1]),s[2]=parseFloat(s[2]));for(var a={modelid:t.id,position:t.position?t.position:s,url:l,drotate:[0,0,0],initq:new ZMAP3D.Quaternion(-.5,-.5,-.5,.5)},n=0;n<e._modelentities.length;n++)e.unshow(e._modelentities[n]._id);e._cutmodel.push(a),e._modelTool.addModel(a,!0)}else console.log("切割失败！")}})};